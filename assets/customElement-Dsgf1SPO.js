import{L as I,c as E,q as S,u as B,r as O,_ as x,a as d,D,$ as C,a0 as y,o as G,a1 as A,m as M,O as P,s as h,x as g,i as H,b as $}from"./index-Bkom2Sdc.js";/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.3.3 */function u(c){return c.tagName==="CALCITE-BLOCK"}const p={container:"container",groupContainer:"group-container",scrim:"scrim",assistiveText:"assistive-text"},b="calcite-block-group",f="calcite-block",T=H`:host{--calcite-internal-color-focus: var( --calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)) )}:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:block}.container{position:relative}.assistive-text{position:absolute;inline-size:1px;block-size:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}:host([hidden]){display:none}[hidden]{display:none}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}`;function w(c){c.forEach(e=>{e.setPosition=c.indexOf(e)+1,e.setSize=c.length})}const m=class m extends I{constructor(){super(),this.dragSelector=f,this.handleSelector="calcite-sort-handle",this.mutationObserver=E("mutation",()=>{this.updateBlockItemsDebounced()}),this.blockAndGroups=[],this.cancelable=S()(this),this.focusSetter=B()(this),this.updateBlockItemsDebounced=O(this.updateBlockItems,x.nextTick),this.sortHandleMenuItems=[],this.disabled=!1,this.dragEnabled=!1,this.loading=!1,this.scale="m",this.sortDisabled=!1,this.calciteBlockGroupDragEnd=d({cancelable:!1}),this.calciteBlockGroupDragStart=d({cancelable:!1}),this.calciteBlockGroupOrderChange=d({cancelable:!1}),this.calciteBlockGroupMoveHalt=d({cancelable:!1}),this.listen("calciteInternalAssistiveTextChange",this.handleCalciteInternalAssistiveTextChange),this.listen("calciteBlockSortHandleBeforeOpen",this.updateBlockItemsDebounced),this.listen("calciteSortHandleReorder",this.handleSortReorder),this.listen("calciteSortHandleMove",this.handleSortMove),this.listen("calciteSortHandleAdd",this.handleSortAdd)}async setFocus(e){return this.focusSetter(()=>this.el,e)}emitOrderChangeEvent(e){this.calciteBlockGroupOrderChange.emit(e)}connectedCallback(){super.connectedCallback(),this.connectObserver(),this.updateBlockItemsDebounced(),this.setUpSorting(),this.setParentBlockGroup(),this.cancelable.add(this.updateBlockItemsDebounced)}willUpdate(e){(e.has("group")||e.has("canPull")&&this.hasUpdated||e.has("canPut")&&this.hasUpdated||e.has("dragEnabled")&&(this.hasUpdated||this.dragEnabled!==!1)||e.has("sortDisabled")&&(this.hasUpdated||this.sortDisabled!==!1))&&this.updateBlockItemsDebounced(),e.has("scale")&&this.hasUpdated&&this.updateBlockAndGroupScale()}updated(){D(this)}disconnectedCallback(){super.disconnectedCallback(),this.disconnectObserver(),C(this)}updateBlockItems(){this.updateGroupItems();const{dragEnabled:e,el:a,sortDisabled:t,sortHandleMenuItems:n}=this,s=Array.from(this.el.querySelectorAll(f)),l=a,o=Array.from(l.children).filter(u);s.forEach(r=>{r.closest(b)===a&&(r.moveToItems=n.filter(i=>this.validateSortMenuItem({type:"move",fromEl:l,toEl:i.element,dragEl:r,newIndex:0,oldIndex:o.indexOf(r)})),r.addToItems=this.sortHandleMenuItems.filter(i=>this.validateSortMenuItem({type:"add",fromEl:l,toEl:i.element,dragEl:r,newIndex:0,oldIndex:o.indexOf(r)})),r.dragHandle=e,r.sortDisabled=t)}),this.setUpSorting()}updateGroupItems(){const{el:e,group:a}=this,t=y(e),n=a?Array.from(t.querySelectorAll(`${b}[group="${a}"]`)).filter(s=>!s.disabled&&s.dragEnabled):[];this.sortHandleMenuItems=n.map(s=>({element:s,label:s.label??s.id,id:G()}))}handleCalciteInternalAssistiveTextChange(e){this.assistiveText=e.detail.message,e.stopPropagation()}handleSortReorder(e){this.parentBlockGroupEl||e.defaultPrevented||(e.preventDefault(),this.handleReorder(e))}handleSortAdd(e){this.parentBlockGroupEl||e.defaultPrevented||(e.preventDefault(),this.handleAdd(e))}handleSortMove(e){this.parentBlockGroupEl||e.defaultPrevented||(e.preventDefault(),this.handleMove(e))}connectObserver(){this.mutationObserver?.observe(this.el,{childList:!0,subtree:!0})}disconnectObserver(){this.mutationObserver?.disconnect()}setUpSorting(){const{dragEnabled:e}=this;e&&A(this)}onGlobalDragStart(){this.disconnectObserver()}onGlobalDragEnd(){this.connectObserver()}onDragEnd(e){this.calciteBlockGroupDragEnd.emit(e)}onDragStart(e){e.dragEl.sortHandleOpen=!1,this.calciteBlockGroupDragStart.emit(e)}onDragSort(e){this.setParentBlockGroup(),this.updateBlockItemsDebounced(),this.calciteBlockGroupOrderChange.emit(e)}setParentBlockGroup(){this.parentBlockGroupEl=this.el.parentElement?.closest(b)}handleDefaultSlotChange(e){const a=[];this.blockAndGroups=M(e).filter(t=>(t.matches(f)&&a.push(t),t.matches(f)||t.matches(b))),w(a),this.updateBlockAndGroupScale()}updateBlockAndGroupScale(){this.blockAndGroups.forEach(e=>{e.scale=this.scale})}validateSortMenuItem({fromEl:e,toEl:a,dragEl:t,newIndex:n,oldIndex:s,type:l}){if(!e||!a||a===e||t.contains(a))return!1;const o=e.canPull?.({toEl:a,fromEl:e,dragEl:t,newIndex:n,oldIndex:s})??!0,r=a.canPut?.({toEl:a,fromEl:e,dragEl:t,newIndex:n,oldIndex:s})??!0;return(l==="add"?o==="clone":o===!0)&&r}handleAdd(e){const{addTo:a}=e.detail,t=e.target,n=t?.parentElement,s=a.element,o=Array.from(n.children).filter(u).indexOf(t),r=0;if(!this.validateSortMenuItem({type:"add",fromEl:n,toEl:s,dragEl:t,newIndex:r,oldIndex:o}))return;t.sortHandleOpen=!1,this.disconnectObserver();const i=t.cloneNode();s.prepend(i),this.updateBlockItemsDebounced(),this.connectObserver();const k={dragEl:t,fromEl:n,toEl:s,newIndex:r,oldIndex:o};this.calciteBlockGroupOrderChange.emit(k),s.emitOrderChangeEvent(k)}handleMove(e){const{moveTo:a}=e.detail,t=e.target,n=t?.parentElement,s=a.element,o=Array.from(n.children).filter(u).indexOf(t),r=0;if(!this.validateSortMenuItem({type:"move",fromEl:n,toEl:s,dragEl:t,newIndex:r,oldIndex:o}))return;t.sortHandleOpen=!1,this.disconnectObserver(),s.prepend(t),this.updateBlockItemsDebounced(),this.connectObserver();const i={dragEl:t,fromEl:n,toEl:s,newIndex:r,oldIndex:o};this.calciteBlockGroupOrderChange.emit(i),s.emitOrderChangeEvent(i)}handleReorder(e){const{reorder:a}=e.detail,t=e.target,n=t?.parentElement;if(!n)return;t.sortHandleOpen=!1;const s=Array.from(n.children).filter(u),l=s.length-1,o=s.indexOf(t);let r=o;switch(a){case"top":r=0;break;case"bottom":r=l;break;case"up":r=o===0?0:o-1;break;case"down":r=o===l?l:o+1;break}this.disconnectObserver();const i=a==="up"||a==="top"?s[r]:s[r].nextSibling;n.insertBefore(t,i),this.updateBlockItemsDebounced(),this.connectObserver(),this.calciteBlockGroupOrderChange.emit({dragEl:t,fromEl:n,toEl:n,newIndex:r,oldIndex:o})}render(){const{loading:e,label:a}=this;return P({disabled:this.disabled,children:g`<div class=${h(p.container)}>${this.dragEnabled?g`<span aria-live=assertive class=${h(p.assistiveText)}>${this.assistiveText}</span>`:null}${e?g`<calcite-scrim class=${h(p.scrim)} .loading=${e}></calcite-scrim>`:null}<div .ariaBusy=${e} .ariaLabel=${a||""} class=${h(p.groupContainer)} role=group><slot @slotchange=${this.handleDefaultSlotChange}></slot></div></div>`})}};m.properties={assistiveText:[16,{},{state:!0}],sortHandleMenuItems:[16,{},{state:!0}],canPull:[0,{},{attribute:!1}],canPut:[0,{},{attribute:!1}],disabled:[7,{},{reflect:!0,type:Boolean}],dragEnabled:[7,{},{reflect:!0,type:Boolean}],group:[3,{},{reflect:!0}],label:1,loading:[7,{},{reflect:!0,type:Boolean}],scale:[3,{},{reflect:!0}],sortDisabled:[7,{},{reflect:!0,type:Boolean}]},m.styles=T;let v=m;$("calcite-block-group",v);export{v as BlockGroup};
