import{jf as ut,jg as rt,b7 as bt}from"./index-Bkom2Sdc.js";import{c as _}from"./PixelBlock-CD7TNHcL.js";const st=9,Ut="PixelID";function C(t){return t!=null&&t.pixels?.length>0}function Ot(t){if(!t?.length||t.some(a=>!C(a)))return null;if(t.length===1)return t[0]?.clone()??null;const n=t,{width:e,height:i,pixelType:r}=n[0];if(n.some(a=>a.width!==e||a.height!==i))return null;const l=n.map(({mask:a})=>a).filter(a=>a!=null);let s=null;l.length&&(s=new Uint8Array(e*i),s.set(l[0]),l.length>1&&mt(l.slice(1),s));const p=[];n.forEach(({pixels:a})=>p.push(...a));const f=n.map(({statistics:a})=>a).filter(a=>a?.length),o=[];return f.forEach(a=>o.push(...a)),new _({pixelType:r,width:e,height:i,mask:s,pixels:p,statistics:o.length?o:null})}function jt(t){if(!t)return;const n=t.colormap;if(!n||n.length===0)return;const e=n.sort((f,o)=>f[0]-o[0]),i=e[0][0]<0?e[0][0]:0,r=Math.max(256,e[e.length-1][0]-i+1),l=new Uint8Array(4*r),s=[],p=e[0].length===5;if(r>65536)return e.forEach(f=>{s[f[0]-i]=p?f.slice(1):f.slice(1).concat([255])}),{indexed2DColormap:s,offset:i,alphaSpecified:p};if(t.fillUnspecified){let f=e[0];for(let o=f[0]-i,a=0;o<r;o++)l[4*o]=f[1],l[4*o+1]=f[2],l[4*o+2]=f[3],l[4*o+3]=p?f[4]:255,o===f[0]-i&&(f=a===e.length-1?f:e[++a])}else for(let f=0;f<e.length;f++){const o=e[f],a=4*(o[0]-i);l[a]=o[1],l[a+1]=o[2],l[a+2]=o[3],l[a+3]=p?o[4]:255}return{indexedColormap:l,offset:i,alphaSpecified:p}}function qt(t,n){if(!C(t)||!n||!n.indexedColormap&&!n.indexed2DColormap)return t;const e=t.clone(),i=e.pixels;let r=e.mask;const l=e.width*e.height;if(i.length!==1)return t;const{indexedColormap:s,indexed2DColormap:p,offset:f,alphaSpecified:o}=n,a=i[0],h=new Uint8Array(a.length),m=new Uint8Array(a.length),u=new Uint8Array(a.length);let c,d=0;if(s){const x=s.length-1;if(r!=null)for(let g=0;g<l;g++)r[g]&&(d=4*(a[g]-f),d<f||d>x?r[g]=0:(h[g]=s[d],m[g]=s[d+1],u[g]=s[d+2],r[g]=s[d+3]));else{r=new Uint8Array(l);for(let g=0;g<l;g++)d=4*(a[g]-f),d<f||d>x?r[g]=0:(h[g]=s[d],m[g]=s[d+1],u[g]=s[d+2],r[g]=s[d+3]);e.mask=r}}else if(p)if(r!=null)for(let x=0;x<l;x++)r[x]&&(c=p[a[x]],h[x]=c[0],m[x]=c[1],u[x]=c[2],r[x]=c[3]);else{r=new Uint8Array(l);for(let x=0;x<l;x++)c=p[a[x]],h[x]=c[0],m[x]=c[1],u[x]=c[2],r[x]=c[3];e.mask=r}return e.pixels=[h,m,u],e.statistics=null,e.pixelType="u8",e.maskIsAlpha=o,e}function Jt(t,n){if(!C(t))return null;const{pixels:e,mask:i}=t,r=e.length;let l=n.lut;const{offset:s}=n;l&&l[0].length===1&&(l=e.map(()=>l));const p=[],f=n.outputPixelType||"u8";for(let a=0;a<r;a++){const h=pt(e[a],i,l[a],s||0,f);p.push(h)}const o=new _({width:t.width,height:t.height,pixels:p,mask:i,pixelType:f});return o.updateStatistics(),o}function pt(t,n,e,i,r){const l=t.length,s=_.createEmptyBand(r,l);if(n)for(let p=0;p<l;p++)n[p]&&(s[p]=e[t[p]-i]);else for(let p=0;p<l;p++)s[p]=e[t[p]-i];return s}function Vt(t,n,e){if(!C(t))return;const{width:i,height:r,pixels:l,mask:s}=t,p=i*r,f=new Uint8Array(p);for(let h=1;h<=e.length;h++){const{bandId:m,ranges:u}=e[h-1],c=l[m];if(!c)continue;const d=u.length===1,[x,g]=u[0];for(let y=0;y<p;y++)if(!s||s[y]){const k=c[y];if(d)k>=x&&k<=g&&(f[y]=h);else for(let M=0;M<u.length;M++){const[w,v]=u[M];if(k>=w&&k<=v){f[y]=h;break}}}}const{pixels:o}=n;o.length===1&&(o[1]=o[0].slice(),o[2]=o[0].slice());const a=e.map(h=>h.color);if(n.mask){const h=n.mask;for(let m=0;m<p;m++)if(h[m]){h[m]=255;const u=f[m];if(u){const c=a[u-1];o[0][m]=c[0],o[1][m]=c[1],o[2][m]=c[2],h[m]=c[3]}}}else{const h=new Uint8Array(p).fill(255);for(let m=0;m<p;m++){const u=f[m];if(u){const c=a[u-1];o[0][m]=c[0],o[1][m]=c[1],o[2][m]=c[2],h[m]=c[3]}}n.mask=h}n.maskIsAlpha=!0}function zt(t,n){if(!C(t))return null;const e=t.clone(),{pixels:i}=e,r=e.width*e.height,l=n.length,s=Math.floor(l/2),p=n[Math.floor(s)],f=i[0],o=new Uint8Array(r),a=new Uint8Array(r),h=new Uint8Array(r);let m=e.mask;const u=n[0].mappedColor.length===4;m||(m=new Uint8Array(r),m.fill(u?255:1),e.mask=m);for(let c=0;c<r;c++)if(m[c]){const d=f[c];let x=!1,g=s,y=p,k=0,M=l-1;for(;M-k>1;){if(d===y.value){x=!0;break}d>y.value?k=g:M=g,g=Math.floor((k+M)/2),y=n[Math.floor(g)]}x||(d===n[k].value?(y=n[k],x=!0):d===n[M].value?(y=n[M],x=!0):d<n[k].value?x=!1:d>n[k].value&&(d<n[M].value?(y=n[k],x=!0):M===l-1?x=!1:(y=n[M],x=!0))),x?(o[c]=y.mappedColor[0],a[c]=y.mappedColor[1],h[c]=y.mappedColor[2],m[c]=y.mappedColor[3]):o[c]=a[c]=h[c]=m[c]=0}return e.pixels=[o,a,h],e.mask=m,e.pixelType="u8",e.maskIsAlpha=u,e}function Lt(t,n,e=!1){const r=new Float32Array(3*st),l=n.length;for(let s=0;s<st;s++)r[3*s]=t[2*s]??rt-1,r[3*s+1]=t[2*s+1]??rt,r[3*s+2]=n[s]??0,s<l&&(s>0&&(r[3*s]-=1e-5),t[2*s+1]!==t[2*s]&&(s<l-1||!e)&&(r[3*s+1]-=1e-5));return r}function Xt(t,n){if(!C(t))return null;const{width:e,height:i}=t,{inputRanges:r,outputValues:l,outputPixelType:s,noDataRanges:p,allowUnmatched:f,replacementValue:o,isLastInputRangeInclusive:a}=n,h=t.pixels[0],m=_.createEmptyBand(s,h.length),u=t.mask,c=new Uint8Array(e*i);u?c.set(u):c.fill(255);const d=t.pixelType.startsWith("f")?1e-6:0,x=r.map(w=>w-d);x[0]=r[0],x[x.length-1]=r[r.length-1]+(a?1e-6:0);const g=r.length/2,[y,k]=ut(s);for(let w=0;w<i;w++)for(let v=0;v<e;v++){const P=w*e+v;if(c[P]){const U=h[P];let $=!1;for(let b=g-1;b>=0;b--)if(U===r[2*b]||U>x[2*b]&&U<x[2*b+1]){m[P]=l[b],$=!0;break}$||(f?m[P]=U>k?k:U<y?y:o??U:c[P]=0)}}const M=p?.length;if(M)for(let w=0;w<i;w++)for(let v=0;v<e;v++){const P=w*e+v;if(!u||u[P]){const U=h[P];for(let $=0;$<M;$+=2)if(U>=p[$]&&U<=p[$+1]){m[P]=0,c[P]=0;break}}}return new _({width:e,height:i,pixelType:s,pixels:[m],mask:c})}function at(t,n,e,i){const r=e!=null&&e.length>=2?new Set(e):null,l=e?.length===1?e[0]:null,s=!!n?.length;for(let p=0;p<t.length;p++)if(i[p]){const f=t[p];if(s){let o=!1;for(let a=0;a<n.length;a+=2)if(f>=n[a]&&f<=n[a+1]){o=!0;break}o||(i[p]=0)}i[p]&&(f===l||r?.has(f))&&(i[p]=0)}}function ht(t,n){const e=t[0].length;for(let i=0;i<e;i++)if(n[i]){let r=!1;for(let l=0;l<t.length;l++)if(t[l][i]){r=!0;break}r||(n[i]=0)}}function mt(t,n){const e=t[0].length;for(let i=0;i<e;i++)if(n[i]){let r=!1;for(let l=0;l<t.length;l++)if(t[l][i]===0){r=!0;break}r&&(n[i]=0)}}function Ht(t,n){if(!C(t))return null;const{width:e,height:i,pixels:r}=t,l=e*i,s=new Uint8Array(l);t.mask?s.set(t.mask):s.fill(255);const p=r.length,{includedRanges:f,noDataValues:o,outputPixelType:a,matchAll:h,lookups:m}=n;if(m){const u=[];for(let c=0;c<p;c++){const d=m[c],x=pt(r[c],s,d.lut,d.offset||0,"u8");u.push(x)}u.length===1?s.set(u[0]):h?ht(u,s):mt(u,s)}else if(h){const u=[];for(let c=0;c<p;c++){const d=new Uint8Array(l);d.set(s),at(r[c],f?.slice(2*c,2*c+2),o?.[c],d),u.push(d)}u.length===1?s.set(u[0]):ht(u,s)}else for(let u=0;u<p;u++)at(r[u],f?.slice(2*u,2*u+2),o?.[u],s);return new _({width:e,height:i,pixelType:a,pixels:r,mask:s})}function Kt(t){const{srcPixelType:n,inputRanges:e,outputValues:i,allowUnmatched:r,noDataRanges:l,isLastInputRangeInclusive:s,outputPixelType:p}=t;if(n!=="u8"&&n!=="s8"&&n!=="u16"&&n!=="s16")return null;const f=n.includes("16")?65536:256,o=n.includes("s")?-f/2:0,a=_.createEmptyBand(p,f),h=new Uint8Array(f);r&&h.fill(255);const[m,u]=ut(p);if(e?.length&&i?.length){const d=e.map(x=>x-1e-6);d[0]=e[0],s&&(d[d.length-1]=e[e.length-1]);for(let x=0;x<d.length;x++){const g=i[x]>u?u:i[x]<m?m:i[x],y=Math.ceil(d[2*x]-o),k=e[2*x+1]===e[2*x]?y:Math.floor(d[2*x+1]-o);for(let M=y;M<=k;M++)a[M]=g,h[M]=255}}if(l?.length)for(let c=0;c<l.length;c++){const d=Math.ceil(l[2*c]-o),x=Math.floor(l[2*c+1]-o);for(let g=d;g<=x;g++)h[g]=0}return{lut:a,offset:o,mask:h}}function Gt(t,n,e){if(t!=="u8"&&t!=="s8"&&t!=="u16"&&t!=="s16")return null;const i=t.includes("16")?65536:256,r=t.includes("s")?-i/2:0,l=new Uint8Array(i);if(n)for(let s=0;s<n.length;s++){const p=Math.ceil(n[2*s]-r),f=Math.floor(n[2*s+1]-r);for(let o=p;o<=f;o++)l[o]=255}else l.fill(255);if(e)for(let s=0;s<e.length;s++)l[e[s]-r]=0;return{lut:l,offset:r}}function Pt(t,n,e,i,r,l,s,p){return{xmin:r<=e*t?0:r<e*t+t?r-e*t:t,ymin:l<=i*n?0:l<i*n+n?l-i*n:n,xmax:r+s<=e*t?0:r+s<e*t+t?r+s-e*t:t,ymax:l+p<=i*n?0:l+p<i*n+n?l+p-i*n:n}}function Qt(t,n){if(!t||t.length===0)return null;const e=t.find(c=>c.pixelBlock);if(e?.pixelBlock==null)return null;const i=(e.extent.xmax-e.extent.xmin)/e.pixelBlock.width,r=(e.extent.ymax-e.extent.ymin)/e.pixelBlock.height,l=.01*Math.min(i,r),s=t.sort((c,d)=>Math.abs(c.extent.ymax-d.extent.ymax)>l?d.extent.ymax-c.extent.ymax:Math.abs(c.extent.xmin-d.extent.xmin)>l?c.extent.xmin-d.extent.xmin:0),p=Math.min.apply(null,s.map(c=>c.extent.xmin)),f=Math.min.apply(null,s.map(c=>c.extent.ymin)),o=Math.max.apply(null,s.map(c=>c.extent.xmax)),a=Math.max.apply(null,s.map(c=>c.extent.ymax)),h={x:Math.round((n.xmin-p)/i),y:Math.round((a-n.ymax)/r)},m={width:Math.round((o-p)/i),height:Math.round((a-f)/r)},u={width:Math.round((n.xmax-n.xmin)/i),height:Math.round((n.ymax-n.ymin)/r)};return Math.round(m.width/e.pixelBlock.width)*Math.round(m.height/e.pixelBlock.height)!==s.length||h.x<0||h.y<0||m.width<u.width||m.height<u.height?null:{extent:n,pixelBlock:vt(s.map(c=>c.pixelBlock),m,{clipOffset:h,clipSize:u})}}function et(t,n,e,i,r,l){const{width:s,height:p}=e.block,{x:f,y:o}=e.offset,{width:a,height:h}=e.mosaic,m=Pt(s,p,i,r,f,o,a,h);let u=0,c=0;if(l){const d=l.hasGCSSShiftTransform?360:l.halfWorldWidth??0,x=s*l.resolutionX,g=l.startX+i*x;g<d&&g+x>d?c=l.rightPadding:g>=d&&(u=l.leftMargin-l.rightPadding,c=0)}if(m.xmax-=c,typeof n!="number")for(let d=m.ymin;d<m.ymax;d++){const x=(r*p+d-o)*a+(i*s-f)+u,g=d*s;for(let y=m.xmin;y<m.xmax;y++)t[x+y]=n[g+y]}else for(let d=m.ymin;d<m.ymax;d++){const x=(r*p+d-o)*a+(i*s-f)+u;for(let g=m.xmin;g<m.xmax;g++)t[x+g]=n}}function vt(t,n,e={}){const{clipOffset:i,clipSize:r,alignmentInfo:l,blockWidths:s}=e;if(s)return St(t,n,{blockWidths:s});const p=t.find(b=>C(b));if(p==null)return null;const f=r?r.width:n.width,o=r?r.height:n.height,a=p.width,h=p.height,m=n.width/a,u=n.height/h,c={offset:i||{x:0,y:0},mosaic:r||n,block:{width:a,height:h}},d=p.pixelType,x=_.getPixelArrayConstructor(d),g=p.pixels.length,y=[];let k,M;for(let b=0;b<g;b++){M=new x(f*o);for(let S=0;S<u;S++)for(let A=0;A<m;A++){const T=t[S*m+A];C(T)&&(k=T.pixels[b],et(M,k,c,A,S,l))}y.push(M)}const w=t.some(b=>b==null||b.mask!=null&&b.mask.length>0),v=t.some(b=>b?.bandMasks&&b.bandMasks.length>1),P=w?new Uint8Array(f*o):void 0,U=v?[]:void 0;if(P){for(let b=0;b<u;b++)for(let S=0;S<m;S++){const A=t[b*m+S],T=A!=null?A.mask:null;et(P,T??(A?255:0),c,S,b,l)}if(U)for(let b=0;b<g;b++){const S=new Uint8Array(f*o);for(let A=0;A<u;A++)for(let T=0;T<m;T++){const D=t[A*m+T],B=D?.bandMasks?.[b]??D?.mask;et(S,B??(D?255:0),c,T,A,l)}U.push(S)}}const $=new _({width:f,height:o,pixels:y,pixelType:d,bandMasks:U,mask:P});return $.updateStatistics(),$}function St(t,n,e){const i=t.find(x=>x!=null);if(i==null)return null;const r=t.some(x=>x==null||!!x.mask),{width:l,height:s}=n,p=r?new Uint8Array(l*s):null,{blockWidths:f}=e,o=[],a=i.getPlaneCount(),h=_.getPixelArrayConstructor(i.pixelType);if(r)for(let x=0,g=0;x<t.length;g+=f[x],x++){const y=t[x];if(!C(y))continue;const k=y.mask;for(let M=0;M<s;M++)for(let w=0;w<f[x];w++)p[M*l+w+g]=k==null?255:k[M*y.width+w]}const m=t.some(x=>x?.bandMasks&&x.bandMasks.length>1),u=m?[]:void 0,c=l*s;for(let x=0;x<a;x++){const g=new h(c),y=m?new Uint8Array(c):void 0;for(let k=0,M=0;k<t.length;M+=f[k],k++){const w=t[k];if(!C(w))continue;const v=w.pixels[x];if(v!=null){for(let P=0;P<s;P++)for(let U=0;U<f[k];U++)g[P*l+U+M]=v[P*w.width+U];if(y){const P=w.bandMasks?.[x]??w.mask;for(let U=0;U<s;U++)for(let $=0;$<f[k];$++)y[U*l+$+M]=P?P[U*w.width+$]:255}}}o.push(g),u&&y&&u.push(y)}const d=new _({width:l,height:s,mask:p,bandMasks:u,pixels:o,pixelType:i.pixelType});return d.updateStatistics(),d}function Yt(t,n,e){if(!C(t))return null;const{width:i,height:r}=t,l=n.x,s=n.y,p=e.width+l,f=e.height+s;if(l<0||s<0||p>i||f>r||l===0&&s===0&&p===i&&f===r)return t;t.mask||(t.mask=new Uint8Array(i*r));const o=t.mask;for(let a=0;a<r;a++){const h=a*i;for(let m=0;m<i;m++)o[h+m]=a<s||a>=f||m<l||m>=p?0:1}return t.updateStatistics(),t}function Tt(t){if(!C(t))return null;const n=t.clone(),{width:e,height:i,pixels:r}=t,l=r[0],s=n.pixels[0],p=t.mask;for(let f=2;f<i-1;f++){const o=new Map;for(let h=f-2;h<f+2;h++)for(let m=0;m<4;m++){const u=h*e+m;X(o,l[u],p?p[u]:1)}s[f*e]=ft(o),s[f*e+1]=s[f*e+2]=s[f*e];let a=3;for(;a<e-1;a++){let h=(f-2)*e+a+1;X(o,l[h],p?p[h]:1),h=(f-1)*e+a+1,X(o,l[h],p?p[h]:1),h=f*e+a+1,X(o,l[h],p?p[h]:1),h=(f+1)*e+a+1,X(o,l[h],p?p[h]:1),h=(f-2)*e+a-3,K(o,l[h],p?p[h]:1),h=(f-1)*e+a-3,K(o,l[h],p?p[h]:1),h=f*e+a-3,K(o,l[h],p?p[h]:1),h=(f+1)*e+a-3,K(o,l[h],p?p[h]:1),s[f*e+a]=ft(o)}s[f*e+a+1]=s[f*e+a]}for(let f=0;f<e;f++)s[f]=s[e+f]=s[2*e+f],s[(i-1)*e+f]=s[(i-2)*e+f];return n.updateStatistics(),n}function ft(t){if(t.size===0)return 0;let n=0,e=-1,i=0;const r=t.keys();let l=r.next();for(;!l.done;)i=t.get(l.value),i>n&&(e=l.value,n=i),l=r.next();return e}function K(t,n,e){if(e===0)return;const i=t.get(n);i===1?t.delete(n):t.set(n,i-1)}function X(t,n,e){e!==0&&t.set(n,t.has(n)?t.get(n)+1:1)}function xt(t,n,e){let{x:i,y:r}=n;const{width:l,height:s}=e;if(i===0&&r===0&&s===t.height&&l===t.width)return t;const{width:p,height:f}=t,o=Math.max(0,r),a=Math.max(0,i),h=Math.min(i+l,p),m=Math.min(r+s,f);if(h<0||m<0||!C(t))return null;i=Math.max(0,-i),r=Math.max(0,-r);const{pixels:u}=t,c=l*s,d=u.length,x=[];for(let M=0;M<d;M++){const w=u[M],v=_.createEmptyBand(t.pixelType,c);for(let P=o;P<m;P++){const U=P*p;let $=(P+r-o)*l+i;for(let b=a;b<h;b++)v[$++]=w[U+b]}x.push(v)}const g=new Uint8Array(c),y=t.mask;for(let M=o;M<m;M++){const w=M*p;let v=(M+r-o)*l+i;for(let P=a;P<h;P++)g[v++]=y?y[w+P]:1}const k=new _({width:e.width,height:e.height,pixelType:t.pixelType,pixels:x,mask:g});return k.updateStatistics(),k}function dt(t,n=!0){if(!C(t))return null;const{pixels:e,width:i,height:r,mask:l,pixelType:s}=t,p=[],f=Math.round(i/2),o=Math.round(r/2),a=r-1,h=i-1;for(let u=0;u<e.length;u++){const c=e[u],d=_.createEmptyBand(s,f*o);let x=0;for(let g=0;g<r;g+=2)for(let y=0;y<i;y+=2){const k=c[g*i+y];if(n){const M=y===h?k:c[g*i+y+1],w=g===a?k:c[g*i+y+i],v=y===h?w:g===a?M:c[g*i+y+i+1];d[x++]=(k+M+w+v)/4}else d[x++]=k}p.push(d)}let m=null;if(l!=null){m=new Uint8Array(f*o);let u=0;for(let c=0;c<r;c+=2)for(let d=0;d<i;d+=2){const x=l[c*i+d];if(n){const g=d===h?x:l[c*i+d+1],y=c===a?x:l[c*i+d+i],k=d===h?y:c===a?g:l[c*i+d+i+1];m[u++]=x*g*y*k?1:0}else m[u++]=x}}return new _({width:f,height:o,pixelType:s,pixels:p,mask:m})}function Zt(t,n,e=0,i=!0){if(!C(t))return null;const{width:r,height:l}=n;let{width:s,height:p}=t;const f=new Map,o={x:0,y:0},a=1+e;let h=t;for(let m=0;m<a;m++){const u=Math.ceil(s/r),c=Math.ceil(p/l);for(let d=0;d<c;d++){o.y=d*l;for(let x=0;x<u;x++){o.x=x*r;const g=xt(h,o,n);f.set(`${m}/${d}/${x}`,g)}}m<a-1&&(h=dt(h,i)),s=Math.round(s/2),p=Math.round(p/2)}return f}function te(t){const{pixelBlock:n,tileSize:e,level:i,row:r,col:l,useBilinear:s}=t;if(!C(n))return null;const{width:p,height:f}=e,o=2**i,a=o*p,h=o*f;let m=xt(n,{y:r*h,x:l*a},{width:a,height:h});if(!m)return null;for(let u=i;u>0;u--)m=dt(m,s);return m}function gt(t,n,e,i,r=0){const{width:l,height:s}=t,{width:p,height:f}=n,o=i.cols,a=i.rows,h=Math.ceil(p/o-.1/o),m=Math.ceil(f/a-.1/a);let u,c,d,x,g,y,k;const M=h*o,w=M*m*a,v=new Float32Array(w),P=new Float32Array(w),U=new Uint32Array(w),$=new Uint32Array(w);let b,S,A=0;for(let T=0;T<m;T++)for(let D=0;D<h;D++){u=12*(T*h+D),c=e[u],d=e[u+1],x=e[u+2],g=e[u+3],y=e[u+4],k=e[u+5];for(let B=0;B<a;B++){A=(T*a+B)*M+D*o,S=(B+.5)/a;for(let I=0;I<B;I++)b=(I+.5)/o,v[A+I]=(c*b+d*S+x)*l+r,P[A+I]=(g*b+y*S+k)*s+r,U[A+I]=Math.floor(v[A+I]),$[A+I]=Math.floor(P[A+I])}u+=6,c=e[u],d=e[u+1],x=e[u+2],g=e[u+3],y=e[u+4],k=e[u+5];for(let B=0;B<a;B++){A=(T*a+B)*M+D*o,S=(B+.5)/a;for(let I=B;I<o;I++)b=(I+.5)/o,v[A+I]=(c*b+d*S+x)*l+r,P[A+I]=(g*b+y*S+k)*s+r,U[A+I]=Math.floor(v[A+I]),$[A+I]=Math.floor(P[A+I])}}return{offsets_x:v,offsets_y:P,offsets_xi:U,offsets_yi:$,gridWidth:M}}function ee(t,n){const{coefficients:e,spacing:i}=n,{offsets_x:r,offsets_y:l,gridWidth:s}=gt(t,t,e,{rows:i[0],cols:i[1]}),{width:p,height:f}=t,o=new Float32Array(p*f),a=180/Math.PI;for(let h=0;h<f;h++)for(let m=0;m<p;m++){const u=h*s+m,c=h===0?u:u-s,d=h===f-1?u:u+s,x=r[c]-r[d],g=l[d]-l[c];if(isNaN(x)||isNaN(g))o[h*p+m]=90;else{let y=Math.atan2(g,x)*a;y=(360+y)%360,o[h*p+m]=y}}return o}function ne(t,n,e,i,r="nearest"){if(!C(t))return null;r==="majority"&&(t=Tt(t));const{pixels:l,mask:s,bandMasks:p,pixelType:f}=t,o=t.width,a=t.height,h=_.getPixelArrayConstructor(f),m=l.length,{width:u,height:c}=n;let d=!1;for(let A=0;A<e.length;A+=3)e[A]===-1&&e[A+1]===-1&&e[A+2]===-1&&(d=!0);const{offsets_x:x,offsets_y:g,offsets_xi:y,offsets_yi:k,gridWidth:M}=gt({width:o,height:a},n,e,i,r==="majority"?.5:0);let w;const v=(A,T,D,B)=>{const I=A instanceof Float32Array||A instanceof Float64Array?0:.5;for(let N=0;N<c;N++){w=N*M;for(let R=0;R<u;R++){if(x[w]<0||g[w]<0)A[N*u+R]=0;else if(B)A[N*u+R]=T[y[w]+k[w]*o];else{const W=Math.floor(x[w]),O=Math.floor(g[w]),J=Math.ceil(x[w]),V=Math.ceil(g[w]),E=x[w]-W,z=g[w]-O;if(!D||D[W+O*o]&&D[J+O*o]&&D[W+V*o]&&D[J+V*o]){const H=(1-E)*T[W+O*o]+E*T[J+O*o],L=(1-E)*T[W+V*o]+E*T[J+V*o];A[N*u+R]=(1-z)*H+z*L+I}else A[N*u+R]=T[y[w]+k[w]*o]}w++}}},P=[];let U;const $=p?.length===m,b=[];for(let A=0;A<m;A++){if($){const T=new Uint8Array(u*c);v(T,p[A],p[A],!0),b.push(T)}U=new h(u*c),v(U,l[A],$?p[A]:s,r==="nearest"||r==="majority"),P.push(U)}const S=new _({width:u,height:c,pixelType:f,pixels:P,bandMasks:$?b:void 0});if(s!=null)S.mask=new Uint8Array(u*c),v(S.mask,s,s,!0);else if(d){S.mask=new Uint8Array(u*c);for(let A=0;A<u*c;A++)S.mask[A]=x[A]<0||g[A]<0?0:1}return S.updateStatistics(),S}function le(t){const{pixelBlock:n,extent:e,fieldNames:i,skipFactor:r,skipSpatialReference:l=!1,pixelIdOffset:s=0}=t,p=[],{width:f,height:o,pixels:a,mask:h}=n,m=t.imageRowSize??f,u=e.width/f,c=e.height/o,d=a.length,x=Math.floor(r/2),{xmin:g,ymax:y}=e,k=l?void 0:e.spatialReference.toJSON();for(let M=x;M<o;M+=r)for(let w=x;w<f;w+=r){const v=M*f+w;if(!h||h[v]){const P={x:g+(w+.5)*u,y:y-(M+.5)*c,spatialReference:k},U={[Ut]:s+M*m+w};for(let $=0;$<d;$++)U[i[$+1]]=a[$][v];p.push({geometry:P,attributes:U})}}return p}const q=new Map;q.set("meter-per-second",1),q.set("kilometer-per-hour",.277778),q.set("knots",.514444),q.set("feet-per-second",.3048),q.set("mile-per-hour",.44704);const lt=180/Math.PI,it=5,Q=new bt({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"});function ot(t,n){return q.get(t)/q.get(n)||1}function wt(t){return(450-t)%360}function yt(t,n="geographic"){const[e,i]=t,r=Math.sqrt(e*e+i*i);let l=Math.atan2(i,e)*lt;return l=(360+l)%360,n==="geographic"&&(l=wt(l)),[r,l]}function $t(t,n="geographic"){let e=t[1];n==="geographic"&&(e=wt(e)),e%=360;const i=t[0];return[i*Math.cos(e/lt),i*Math.sin(e/lt)]}function ie(t,n,e,i="geographic"){if(!C(t)||e==null)return t;const r=n==="vector-magdir"?t.clone():ct(t,n),l=r.pixels[1];for(let s=0;s<l.length;s++)l[s]=i==="geographic"?(l[s]+e[s]+270)%360:(l[s]+360-e[s])%360;return n==="vector-magdir"?r:ct(r,"vector-magdir")}function ct(t,n,e="geographic",i=1){if(!C(t))return t;const{pixels:r,width:l,height:s}=t,p=l*s,f=r[0],o=r[1],a=t.pixelType.startsWith("f")?t.pixelType:"f32",h=_.createEmptyBand(a,p),m=_.createEmptyBand(a,p);let u=0;for(let d=0;d<s;d++)for(let x=0;x<l;x++)n==="vector-uv"?([h[u],m[u]]=yt([f[u],o[u]],e),h[u]*=i):([h[u],m[u]]=$t([f[u],o[u]],e),h[u]*=i,m[u]*=i),u++;const c=new _({pixelType:a,width:t.width,height:t.height,mask:t.mask,validPixelCount:t.validPixelCount,maskIsAlpha:t.maskIsAlpha,pixels:[h,m]});return c.updateStatistics(),c}function oe(t,n,e=1){if(e===1||!C(t))return t;const i=t.clone(),{pixels:r,width:l,height:s}=i,p=r[0];r[1];let f=0;for(let o=0;o<s;o++)for(let a=0;a<l;a++)p[f]*=e,f++;return i.updateStatistics(),i}function re(t,n,e,i,r){if(r==null||!r.spatialReference.equals(t.spatialReference))return{extent:t,width:Math.round(n/i),height:Math.round(e/i),resolution:t.width/n};const l=r.xmin,s=r.ymax,p=(t.xmax-t.xmin)/n*i,f=(t.ymax-t.ymin)/e*i,o=(p+f)/2;return t.xmin=l+Math.floor((t.xmin-l)/p)*p,t.xmax=l+Math.ceil((t.xmax-l)/p)*p,t.ymin=s+Math.floor((t.ymin-s)/f)*f,t.ymax=s+Math.ceil((t.ymax-s)/f)*f,{extent:t,width:Math.round(t.width/p),height:Math.round(t.height/f),resolution:o}}const It=kt(0,0,0);function kt(t=0,n=0,e=Math.PI,i=!0){i&&(e=(2*Math.PI-e)%(2*Math.PI));const r=i?-1:1,l=13*r,s=-7*r,p=-2*r,f=-16*r,o=21.75,[a,h]=F(0,n+l,e,o),[m,u]=F(t-5.5,n+s,e,o),[c,d]=F(t+5.5,n+s,e,o),[x,g]=F(t-1.5,n+p,e,o),[y,k]=F(t+1.5,n+p,e,o),[M,w]=F(t-1.5,n+f,e,o),[v,P]=F(t+1.5,n+f,e,o);return[a,h,m,u,x,g,y,k,c,d,M,w,v,P]}function _t(t=0,n=Math.PI,e=!0){e&&(n=(2*Math.PI-n)%(2*Math.PI));const i=10,r=e?-1:1,l=5*r,s=20*r,p=25*r,f=45,o=0,a=0,h=2,m=0,u=h*r,c=e?1:-1,d=i/2*c;let[x,g]=[o+d,a-s],[y,k]=[x+h*c,g],[M,w]=[y-m*c,k+u],[v,P]=[o-d,a-p],[U,$]=[v+m*c,P-u],b=Math.ceil(t/it),S=Math.floor(b/10);b-=8*S;const A=[],T=[];for(let E=0;E<b/2;E++,S--){S<=0&&b%2==1&&E===(b-1)/2&&(v=o,U=v+m*c,P=(P+g)/2,$=P-u);const[z,H]=F(v,P,n,f);if(S>0){const[L,Y]=F(y,P,n,f),[Z,tt]=F(x,g,n,f);A.push(L),A.push(Y),A.push(z),A.push(H),A.push(Z),A.push(tt)}else{const[L,Y]=F(y,k,n,f),[Z,tt]=F(M,w,n,f),[Mt,At]=F(U,$,n,f);T.push(z),T.push(H),T.push(Mt),T.push(At),T.push(Z),T.push(tt),T.push(L),T.push(Y)}P+=l,g+=l,k+=l,w+=l,$+=l}const[D,B]=F(o+d,a+s,n,f),I=(i/2+h)*c,[N,R]=F(o+I,a+s,n,f),[W,O]=F(o+d,a-p,n,f),[J,V]=F(o+I,a-p,n,f);return{pennants:A,barbs:T,shaft:[D,B,N,R,W,O,J,V]}}function F(t,n,e,i=1){const r=Math.sqrt(t*t+n*n)/i,l=(2*Math.PI+Math.atan2(n,t))%(2*Math.PI);return[r,(2*Math.PI+l-e)%(2*Math.PI)]}const G=[0,1,3,6,10,16,21,27,33,40,47,55,63],Ct=[0,.5,1,1.5,2],Bt=[0,.25,.5,1,1.5,2,2.5,3,3.5,4];function j(t,n,e,i){const r=ot(i||"knots",e);let l;for(l=1;l<n.length;l++)if(l===n.length-1){if(t<n[l]*r)break}else if(t<=n[l]*r)break;return Math.min(l-1,n.length-2)}function Dt(t,n,e,i,r){let l=0;switch(n){case"beaufort_kn":l=j(t,G,"knots",e);break;case"beaufort_km":l=j(t,G,"kilometer-per-hour",e);break;case"beaufort_ft":l=j(t,G,"feet-per-second",e);break;case"beaufort_m":l=j(t,G,"meter-per-second",e);break;case"classified_arrow":l=j(t,r??[],i,e);break;case"ocean_current_m":l=j(t,Ct,"meter-per-second",e);break;case"ocean_current_kn":l=j(t,Bt,"knots",e)}return l}function Ft(t,n){const{style:e,inputUnit:i,outputUnit:r,breakValues:l}=n,s=Q.fromJSON(i),p=Q.fromJSON(r),f=42,o=15;let a=0,h=0;const{width:m,height:u,mask:c}=t,d=t.pixels[0],x=t.pixels[1],g=c!=null?c.filter(w=>w>0).length:m*u,y=new Float32Array(g*f),k=new Uint32Array(o*g),M=n.invertDirection?kt(0,0,0,!1):It;for(let w=0;w<u;w++)for(let v=0;v<m;v++){const P=w*m+v;if(!c||c[w*m+v]){const U=(x[P]+360)%360/180*Math.PI,$=Dt(d[P],e,s,p,l);for(let S=0;S<M.length;S+=2)y[a++]=(v+.5)/m,y[a++]=(w+.5)/u,y[a++]=M[S],y[a++]=M[S+1]+U,y[a++]=$,y[a++]=d[P];const b=7*(a/f-1);k[h++]=b,k[h++]=b+1,k[h++]=b+2,k[h++]=b+0,k[h++]=b+4,k[h++]=b+3,k[h++]=b+0,k[h++]=b+2,k[h++]=b+3,k[h++]=b+2,k[h++]=b+5,k[h++]=b+3,k[h++]=b+5,k[h++]=b+6,k[h++]=b+3}}return{vertexData:y,indexData:k}}const nt=[];function Nt(t,n){if(nt.length===0)for(let u=0;u<30;u++)nt.push(_t(5*u,0,!n.invertDirection));const e=ot(Q.fromJSON(n.inputUnit),"knots"),{width:i,height:r,mask:l}=t,s=t.pixels[0],p=t.pixels[1],f=6,o=[],a=[];let h=0,m=0;for(let u=0;u<r;u++)for(let c=0;c<i;c++){const d=u*i+c,x=s[d]*e;if((!l||l[u*i+c])&&x>=it){const g=(p[d]+360)%360/180*Math.PI,{pennants:y,barbs:k,shaft:M}=nt[Math.min(Math.floor(x/5),29)];if(y.length+k.length===0)continue;let w=o.length/f;const v=(c+.5)/i,P=(u+.5)/r;for(let U=0;U<y.length;U+=2)o[h++]=v,o[h++]=P,o[h++]=y[U],o[h++]=y[U+1]+g,o[h++]=0,o[h++]=x;for(let U=0;U<k.length;U+=2)o[h++]=v,o[h++]=P,o[h++]=k[U],o[h++]=k[U+1]+g,o[h++]=0,o[h++]=x;for(let U=0;U<M.length;U+=2)o[h++]=v,o[h++]=P,o[h++]=M[U],o[h++]=M[U+1]+g,o[h++]=0,o[h++]=x;for(let U=0;U<y.length/6;U++)a[m++]=w,a[m++]=w+1,a[m++]=w+2,w+=3;for(let U=0;U<k.length/8;U++)a[m++]=w,a[m++]=w+1,a[m++]=w+2,a[m++]=w+1,a[m++]=w+2,a[m++]=w+3,w+=4;a[m++]=w+0,a[m++]=w+1,a[m++]=w+2,a[m++]=w+1,a[m++]=w+3,a[m++]=w+2,w+=4}}return{vertexData:new Float32Array(o),indexData:new Uint32Array(a)}}function Rt(t,n){let i=0,r=0;const{width:l,height:s,mask:p}=t,f=t.pixels[0],o=[],a=[],h=ot(Q.fromJSON(n.inputUnit),"knots"),m=n.style==="wind_speed"?it:Number.MAX_VALUE;for(let u=0;u<s;u++)for(let c=0;c<l;c++){const d=f[u*l+c]*h;if((!p||p[u*l+c])&&d<m){for(let g=0;g<4;g++)o[i++]=(c+.5)/l,o[i++]=(u+.5)/s,o[i++]=g<2?-.5:.5,o[i++]=g%2==0?-.5:.5,o[i++]=0,o[i++]=d;const x=4*(i/24-1);a[r++]=x,a[r++]=x+1,a[r++]=x+2,a[r++]=x+1,a[r++]=x+2,a[r++]=x+3}}return{vertexData:new Float32Array(o),indexData:new Uint32Array(a)}}function se(t,n){return n.style==="simple_scalar"?Rt(t,n):n.style==="wind_speed"?Nt(t,n):Ft(t,n)}function ae(t,n,e,i=[0,0],r=.5){const{width:l,height:s,mask:p}=t,[f,o]=t.pixels,[a,h]=i,m=Math.round((l-a)/e),u=Math.round((s-h)/e),c=m*u,d=new Float32Array(c),x=new Float32Array(c),g=new Uint8Array(c);for(let k=0;k<u;k++)for(let M=0;M<m;M++){let w=0;const v=k*m+M,P=Math.max(0,k*e+h),U=Math.max(0,M*e+a),$=Math.min(s,P+e),b=Math.min(l,U+e);for(let S=P;S<$;S++)for(let A=U;A<b;A++){const T=S*l+A;if(!p||p[T]){w++;const D=[f[T],o[T]],[B,I]=D;d[v]+=B,x[v]+=I}}if(w>=($-P)*(b-U)*(1-r)){g[v]=1;const[S,A]=yt([d[v]/w,x[v]/w]);d[v]=S,x[v]=A}else g[v]=0,d[v]=0,x[v]=0}const y=new _({width:m,height:u,pixels:[d,x],mask:g});return y.updateStatistics(),y}export{ee as D,te as E,xt as I,Gt as M,ne as N,ae as S,vt as T,Qt as U,Zt as W,Rt as _,ie as a,se as b,ot as c,zt as d,Jt as e,ct as f,jt as g,qt as h,st as i,le as j,Kt as k,yt as l,re as m,pt as n,C as o,oe as p,Xt as q,Ot as r,Q as s,Vt as u,Yt as v,Ht as w,Lt as x};
