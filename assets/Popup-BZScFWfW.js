const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-fCyVu-Lb.js","assets/index-C2z3vZ9k.js","assets/index-DaKHjF4b.css","assets/keyed-BknSWaOu.js","assets/index-C9frQNG8.js","assets/customElement-DBzB66DM.js","assets/floating-ui-F_Mcs0Qf.js","assets/debounce-DbkufipY.js","assets/openCloseComponent-CrcdiPNk.js","assets/Heading-rEtMpBI1.js","assets/FloatingArrow-iooIS6H5.js","assets/useFocusTrap-C9eFDrJm.js","assets/customElement-Dkp4Qx3D.js","assets/array-CaayCXLe.js","assets/resources2-IF-Ysl0u.js","assets/customElement-CsrCDuf0.js","assets/resources7-CMDVPKCU.js","assets/customElement-BDxIjEOt.js","assets/ExpandToggle-Di5t70K6.js","assets/index-BQDJMAIu.js","assets/index-BnX99nvA.js","assets/customElement-BhDKHUy4.js","assets/resources3-DY1Vjnne.js","assets/customElement-C9VXxSXx.js","assets/intersectsOperator-x_2vesFK.js","assets/ProjectionTransformation-BRAx5GYC.js","assets/Envelope2D-CLx0zf4a.js","assets/Point2D-l7nV1LsO.js","assets/Transformation2D-CVTPK6Pf.js","assets/SimpleGeometryCursor-B92kdZ15.js","assets/OperatorDefinitions-DP7_WWTp.js","assets/jsonConverter-BvPb5ebA.js","assets/OperatorIntersects-osx_1L8P.js","assets/apiConverter-COA75KDK.js","assets/proximityOperator-C2C6gNCC.js","assets/OperatorProximity-BM8eyQOe.js","assets/index-BDa6x1zr.js","assets/index-BKejzhBw.js","assets/customElement-7O9OpP2O.js","assets/resources-DRBlqAoC.js","assets/index-DkhLNdTl.js","assets/customElement-6WrW2A_U.js","assets/customElement-BhHt2eON.js","assets/live-CMYV2fZD.js","assets/locale-CwRicNcW.js","assets/Validation-D9miKc_u.js","assets/input-JZYDWdEe.js","assets/customElement-CscSCl0j.js","assets/filter-u1EU2O6n.js","assets/escapeRegExp-CdLjXKbf.js","assets/customElement-DB6hbG9r.js","assets/utils-BfRXXPiF.js","assets/sortableComponent-DaXvZJyv.js","assets/index-CgvyjIJ6.js","assets/index-B2-W3Q6C.js","assets/dynamicClasses-CzRtqdyb.js","assets/index-Dzuzt_7g.js","assets/resources6-Ot02loHz.js","assets/index-4N4FHzO3.js","assets/customElement-BwIa92CH.js","assets/customElement-CC0IBWr6.js","assets/_sortable-D1vt3o_R.js","assets/resources5-BmgbyHGX.js","assets/index-C8QhtbYw.js"])))=>i.map(i=>d[i]);
import{fh as Te,ef as U,aO as c,h9 as Oe,bb as s,bc as n,bd as T,me as ie,mj as g,b2 as ye,bG as be,o8 as K,o7 as Me,o9 as De,ru as oe,rv as Fe,mi as Ce,al as C,ne as $e,rw as Ee,jB as le,nb as $,mo as Y,ay as L,b5 as O,dV as ue,mB as Be,rx as Ne,bp as Ve,gI as Re,aN as We,g6 as Se,gO as He,hy as ze,ry as je,aw as Ge,n2 as pe,rz as Ze,fw as Ue,be as qe,b7 as Ke,eK as Ie,rA as Qe,rB as Je,ea as I,rC as Xe,mk as X,nc as Q,rD as Ye,rE as et,rF as tt,rG as it,ik as de,rH as ke,ml as ot,mp as Ae,e7 as st,dn as nt,rI as ge}from"./index-C2z3vZ9k.js";import{t as rt}from"./ReactiveSet-DP-vhgEW.js";import{n as at}from"./layerViewUtils-DH0dJCjx.js";function ce(e){var t;switch(e==null?void 0:e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return(t=e.extent)==null?void 0:t.center;default:return null}}let N=class extends Te.EventedAccessor{constructor(t){super(t),this.location=null,this.screenLocationEnabled=!1,this.view=null,this.addHandles([U((()=>{const i=this.screenLocationEnabled?this.view:null;return i?[i.size,i.type==="3d"?i.camera:i.viewpoint]:null}),(()=>this.notifyChange("screenLocation"))),c((()=>this.screenLocation),((i,o)=>{i!=null&&o!=null&&this.emit("view-change")}))])}destroy(){this.view=null}get screenLocation(){const{location:t,view:i,screenLocationEnabled:o}=this,r=i==null?void 0:i.spatialReference,a=r?Oe(t,r).geometry:null;return o&&a&&(i!=null&&i.ready)?i.toScreen(a):null}};s([n()],N.prototype,"location",void 0),s([n()],N.prototype,"screenLocation",null),s([n()],N.prototype,"screenLocationEnabled",void 0),s([n()],N.prototype,"view",void 0),N=s([T("esri.widgets.support.AnchorElementViewModel")],N);let q=class extends N{constructor(t){super(t),this.visible=!1}};s([n()],q.prototype,"visible",void 0),q=s([T("esri.widgets.Spinner.SpinnerViewModel")],q);const se="esri-spinner",ne={base:se,spinnerStart:`${se}--start`,spinnerFinish:`${se}--finish`};let H=class extends ie{constructor(t,i){super(t,i),this._animationDelay=500,this._animationPromise=null,this.viewModel=new q}initialize(){this.addHandles(c((()=>this.visible),(t=>this._visibleChange(t))))}destroy(){this._animationPromise=null}get location(){return this.viewModel.location}set location(t){this.viewModel.location=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}get visible(){return this.viewModel.visible}set visible(t){this.viewModel.visible=t}show(t){const{location:i,promise:o}=t??{};i&&(this.viewModel.location=i),this.visible=!0;const r=()=>this.hide();o&&o.catch((()=>{})).then(r)}hide(){this.visible=!1}render(){const{visible:t}=this,{screenLocation:i}=this.viewModel,o=!!i,r=t&&o,a=!t&&o,l={[ne.spinnerStart]:r,[ne.spinnerFinish]:a},u=this._getPositionStyles();return g("div",{class:this.classes(ne.base,l),styles:u})}_visibleChange(t){if(t)return void(this.viewModel.screenLocationEnabled=!0);const i=ye(this._animationDelay);this._animationPromise=i,i.catch((()=>{})).then((()=>{this._animationPromise===i&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)}))}_getPositionStyles(){const{screenLocation:t,view:i}=this.viewModel;if(i==null||t==null)return{};const{padding:o}=i;return{left:t.x-o.left+"px",top:t.y-o.top+"px"}}};s([n()],H.prototype,"location",null),s([n()],H.prototype,"view",null),s([n({type:q})],H.prototype,"viewModel",void 0),s([n()],H.prototype,"visible",null),H=s([T("esri.widgets.Spinner")],H);const F="esri-features",y={icon:`${F}__icon`,actionImage:`${F}__action-image`,base:F,container:`${F}__container`,contentContainer:`${F}__content-container`,contentFeature:`${F}__content-feature`,flowItemCollapsed:`${F}__flow-item--collapsed`,header:`${F}__header`,footer:`${F}__footer`,featureMenuObserver:`${F}__feature-menu-observer`,actionExit:`${F}__action--exit`,loader:`${F}__loader`,featuresHeading:`${F}__heading`,paginationText:`${F}__pagination-text`,paginationActionBar:`${F}__pagination-action-bar`,paginationMenuButton:`${F}__pagination-menu-button`,paginationPrevious:`${F}__pagination-previous`},j=be.ofType({key:"type",defaultKeyValue:"button",base:De,typeMap:{button:K,toggle:Me}}),R=new K({icon:"magnifying-glass-plus",id:"zoom-to-feature",title:"{messages.zoom}",className:oe.zoomInMagnifyingGlass}),ve=new K({icon:"trash",id:"remove-selected-feature",title:"{messages.remove}",className:oe.trash}),G=new K({icon:"magnifying-glass-plus",id:"zoom-to-clustered-features",title:"{messages.zoom}",className:oe.zoomInMagnifyingGlass}),V=new Me({icon:"table",id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:oe.table,value:!1}),J=R.clone();let B=class extends ie{constructor(t,i){super(t,i),this.flowItems=null,this.messages=null,this.closed=!1,this.closable=!0,this.selectLastFlowItem=!0,this._handleOpenFeature=o=>{this.emit("open-feature",{feature:o})},this._handleZoomToFeature=o=>{this.emit("zoom-to-feature",{featureWidget:o})}}loadDependencies(){return Promise.all([Fe(),Ce({action:()=>C(()=>import("./index-fCyVu-Lb.js").then(t=>t.i),__vite__mapDeps([0,1,2,3])),"action-bar":()=>C(()=>import("./index-C9frQNG8.js"),__vite__mapDeps([4,1,2,0,3,5,6,7,8,9,10,11,12,13,14,15,16,17,18])),"action-group":()=>C(()=>import("./index-BQDJMAIu.js"),__vite__mapDeps([19,1,2,0,3,5,6,7,8,9,10,11,12,13,14,15,16])),"flow-item":()=>C(()=>import("./index-BnX99nvA.js"),__vite__mapDeps([20,1,2,0,3,5,6,7,8,9,10,11,12,13,14,21,22,23]))})])}render(){const{flowItems:t}=this,i=t==null?void 0:t.toArray();return g($e,null,i==null?void 0:i.map(((o,r)=>this._renderFlowItem(o,this.selectLastFlowItem&&r===i.length-1))))}_handleCloseClick(){this.emit("close")}_handleExitClick(){this.emit("exit")}_handleDrillInBackClick(){const{flowItems:t}=this,i=t==null?void 0:t.pop();i&&("activeCategory"in i.viewModel?(i.viewModel.activeCategory=null,t!=null&&t.length||(i.viewModel.showAllEnabled=!1)):"showAllEnabled"in i.viewModel&&(i.viewModel.showAllEnabled=!1),i&&(i.viewModel=null,i.destroy()))}_getExitMessage(t){switch(t.flowType){case"feature":case"feature-association":return"";case"feature-relationship":return this.messages.exitRelatedRecords;case"feature-utility-network-associations":case"feature-utility-network-association-type":return this.messages.exitAssociations}}_renderFlowItem(t,i){const{messages:o,closable:r,closed:a}=this,l="graphic"in t&&!t.isTable,u=t.flowType==="feature-association",d=this._getExitMessage(t),p=o.selectFeature;return g("calcite-flow-item",{bind:this,closable:r,closed:a,description:le(this._getDrillInFlowItemDescription(t)??""),heading:le(t.title??""),key:`flow-item-${t.viewModel.uid}`,selected:i,onCalciteFlowItemBack:w=>{w.preventDefault(),this._handleDrillInBackClick()},onCalciteFlowItemClose:this._handleCloseClick},g("calcite-action",{appearance:"transparent",bind:this,class:y.actionExit,icon:"move-up",key:"exit-action",onclick:this._handleExitClick,slot:"header-actions-start",text:d,title:d}),l?g("calcite-action",{appearance:"transparent",bind:this,icon:"zoom-to-object",key:"open-feature-action",onclick:()=>this._handleOpenFeature(t),slot:"header-actions-end",text:p,title:p}):null,u?g("calcite-action-bar",{expandDisabled:!0,expanded:!0,key:"header-action-bar",scale:"s",slot:"action-bar"},g("calcite-action-group",{overlayPositioning:"fixed",scale:"s"},Ee(J,{key:`action-${J.uid}`,title:this._getActionTitle(J),text:this._getActionTitle(J),textEnabled:!0,onclick:()=>this._handleZoomToFeature(t),bind:this}))):null,g("div",{class:y.container},t.render()))}_getActionTitle(t){const{messages:i}=this,o=t.title??"";return t.id==="zoom-to-feature"?$(o,{messages:i}):o}_getDrillInFlowItemDescription(t){switch(t.flowType){case"feature":case"feature-association":case"feature-utility-network-associations":return t.viewModel.description??"";case"feature-relationship":return t.allItemsDescription;case"feature-utility-network-association-type":return t.description??""}}};s([n()],B.prototype,"flowItems",void 0),s([n(),Y("esri/widgets/Features/t9n/Features")],B.prototype,"messages",void 0),s([n()],B.prototype,"closed",void 0),s([n()],B.prototype,"closable",void 0),s([n()],B.prototype,"selectLastFlowItem",void 0),B=s([T("esri.widgets.Features.FeaturesDrillIn")],B);const lt="OBJECTID",ut="esri.widgets.Popup.PopupViewModel",ee=()=>O.getLogger(ut),dt=e=>{const{event:t,view:i,viewModel:o}=e,{action:r}=t;if(!r)return Promise.reject(new L("trigger-action:missing-arguments","Event has no action"));const{disabled:a,id:l}=r;if(!l)return Promise.reject(new L("trigger-action:invalid-action","action.id is missing"));if(a)return Promise.reject(new L("trigger-action:invalid-action","Action is disabled"));if(l===R.id)return xe(o).catch(Be);if(l===G.id)return ht(o);if(l===V.id)return o.browseClusterEnabled=!o.browseClusterEnabled,o.featureMenuOpen=o.browseClusterEnabled,Promise.resolve();if(l===ve.id){o.visible=!1;const{selectedFeature:u}=o;if(!u)return Promise.reject(new L(`trigger-action:${ve.id}`,"selectedFeature is required",{selectedFeature:u}));const{sourceLayer:d}=u;return d?d.remove(u):i==null||i.graphics.remove(u),Promise.resolve()}return Promise.resolve()};function Pe(e){const{selectedFeature:t,location:i,view:o}=e;return o?t??i??null:null}function z(e){var t,i;return!!e&&e.isAggregate&&((i=(t=e.sourceLayer)==null?void 0:t.featureReduction)==null?void 0:i.type)==="cluster"}async function ct(e,t){if((t==null?void 0:t.type)!=="3d"||!e||e.declaredClass!=="esri.Graphic")return!0;const i=t.getViewForGraphic(e);if(i&&"whenGraphicBounds"in i){let o=null;try{o=await i.whenGraphicBounds(e,{useViewElevation:!0})}catch{}return!o||!o.boundingBox||o.boundingBox[0]===o.boundingBox[3]&&o.boundingBox[1]===o.boundingBox[4]&&o.boundingBox[2]===o.boundingBox[5]}return!0}async function xe(e,t){var M,b;const{location:i,selectedFeature:o,view:r,zoomFactor:a}=e;await((M=t==null?void 0:t.viewModel)==null?void 0:M.updateGeometry());const l=t==null?void 0:t.graphic,u=l!=null&&l.geometry?l:Pe(e);if(!r||!u){const _=new L("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:u,view:r});throw ee().error(_),_}const d=r.scale/a,p=(l==null?void 0:l.geometry)??((b=e.selectedFeature)==null?void 0:b.geometry)??i,w=p!=null&&p.type==="point"&&await ct(l??o,r);R.active=!0,R.disabled=!0;try{await e.zoomTo({target:{target:u,scale:w?d:void 0}})}catch(_){if(ue(_))return;const P=new L("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:l??o});ee().error(P)}finally{R.active=!1,R.disabled=!1,e.zoomToLocation=null,w&&(e.location=p)}}async function ht(e){const{selectedFeature:t,view:i}=e;if((i==null?void 0:i.type)!=="2d"){const l=new L("zoomToCluster:invalid-view","View must be 2d MapView.",{view:i});throw ee().error(l),l}if(!t||!z(t)){const l=new L("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw ee().error(l),l}const[o,r]=await he(i,t);G.active=!0,G.disabled=!0;const{extent:a}=await o.queryExtent(r);a&&await e.zoomTo({target:a}),G.active=!1,G.disabled=!1}async function pt(e){const{view:t,selectedFeature:i}=e;if(!t||!i)return;const[o,r]=await he(t,i),{extent:a}=await o.queryExtent(r);e.selectedClusterBoundaryFeature.geometry=a,t.graphics.add(e.selectedClusterBoundaryFeature)}async function gt(e){const{selectedFeature:t,view:i}=e;if(!i||!t)return;const[o,r]=await he(i,t);V.active=!0,V.disabled=!0;const{features:a}=await o.queryFeatures(r);V.active=!1,V.disabled=!1,V.value=!0;const l={features:[t].concat(a)};(e==null?void 0:e.initialDisplayMode)==="feature"&&(l.featureMenuOpen=!0),e==null||e.open(l)}async function he(e,t){const i=await e.whenLayerView(t.sourceLayer),o=i.createQuery(),r=t.getObjectId();return o.aggregateIds=r!=null?[r]:[],[i,o]}function vt(e){V.value=!1;const t=e.features.filter((i=>z(i)));t.length&&(e.features=t)}const re="location-scale-handle",ft=()=>[R.clone()],wt=()=>[G.clone(),V.clone()];let ae=null;function _t(e,t){return e==="building-scene"||e==="map-image"||e==="tile"||e==="imagery"||t==="2d"&&e==="imagery-tile"}let h=class extends Ne(N){constructor(e){super(e),this._pendingPromises=new rt,this._fetchFeaturesController=null,this._highlightPromises={"highlight-active-feature":null,"highlight-selected-feature":null},this._selectedClusterFeature=null,this.actions=new j,this.activeFeature=null,this.autoCloseEnabled=!1,this.browseClusterEnabled=!1,this.content=null,this.defaultPopupTemplateEnabled=!1,this.featurePage=null,this.featuresPerPage=20,this.featureMenuOpen=!1,this.featureMenuTitle=null,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.initialDisplayMode="feature",this.selectedClusterBoundaryFeature=new Ve({symbol:new Re({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null,this._debouncedLocationUpdate=We((async t=>{var a,l,u,d;const{spatialReference:i}=this,o=(l=(a=this.selectedFeature)==null?void 0:a.geometry)==null?void 0:l.type,r=this.location??t;if(o&&o!=="mesh"&&i&&r&&this.selectedFeature)if(o!=="point")try{const p=this.selectedFeature;let w=p.geometry;const M=this._getHighlightLayer(p),b=p.getObjectId();if(!M||!this.view)return;if(b){const E=(u=this.view)==null?void 0:u.allLayerViews.find((Z=>Z.layer.uid===M.uid));if(!E||!("queryFeatures"in E))return;const D=E.createQuery();D.outSpatialReference=i,D.objectIds=[b],D.returnGeometry=!0;const{features:W}=await E.queryFeatures(D);w=(d=W[0])==null?void 0:d.geometry}if(!w||w.type==="mesh")return;w=Se(w,i),ae||(ae=await Promise.all([await C(()=>import("./intersectsOperator-x_2vesFK.js").then(E=>E.i),__vite__mapDeps([24,25,26,27,28,29,1,2,30,31,32,33])),await C(()=>import("./proximityOperator-C2C6gNCC.js").then(E=>E.p),__vite__mapDeps([34,27,26,25,28,29,1,2,30,31,35,33]))]));const[_,P]=ae;if(!_.execute(w,r)){const E=P.getNearestCoordinate(w,r).coordinate??r;this.selectedFeature===p&&(this.location=E)}}catch(p){ue(p)||O.getLogger(this).error(p)}else this.location=ce(this.selectedFeature.geometry)??r}))}initialize(){this.addHandles([this.on("view-change",(()=>this._autoClose())),c((()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view]),(()=>this._highlightSelectedFeature())),c((()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view]),(()=>this._highlightActiveFeature())),c((()=>{var e,t;return(t=(e=this.view)==null?void 0:e.animation)==null?void 0:t.state}),(e=>this._animationStateChange(e))),c((()=>this.location),(e=>this._locationChange(e))),c((()=>this.selectedFeature),(e=>this._selectedFeatureChange(e))),c((()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage]),(()=>this._selectedFeatureIndexChange())),c((()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels]),(()=>this._setGraphicOnFeatureViewModels())),c((()=>this.featureViewModels),(()=>this._featureViewModelsChange())),this.on("trigger-action",(e=>dt({event:e,viewModel:this,view:this.view}))),U((()=>!this.waitingForResult),(()=>this._waitingForResultChange()),He),c((()=>[this.features,this.map,this.spatialReference,this.timeZone]),(()=>this._updateFeatureVMs())),c((()=>{var e;return(e=this.view)==null?void 0:e.scale}),(()=>this._viewScaleChange())),U((()=>!this.visible),(()=>this.browseClusterEnabled=!1)),c((()=>this.browseClusterEnabled),(e=>e?this.enableClusterBrowsing():this.disableClusterBrowsing()))])}destroy(){this._cancelFetchingFeatures(),this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null,this.map=null,this.spatialReference=null,this.timeZone=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const e=this._get("allActions")||new j;e.removeAll();const{actions:t,defaultActions:i,defaultPopupTemplateEnabled:o,includeDefaultActions:r,selectedFeature:a}=this,l=r?i.concat(t):t,u=a&&(typeof a.getEffectivePopupTemplate=="function"&&a.getEffectivePopupTemplate(o)||a.popupTemplate),d=u==null?void 0:u.actions,p=u!=null&&u.overwriteActions?d:(d==null?void 0:d.concat(l))??l;return p==null||p.filter(Boolean).forEach((w=>e.add(w))),e}get defaultActions(){const e=this._get("defaultActions")||new j;return e.removeAll(),e.addMany(z(this.selectedFeature)?wt():ft()),e}get featureCount(){return this.features.length}set features(e){const t=e||[];this._set("features",t);const{pendingPromisesCount:i,promiseCount:o,selectedFeatureIndex:r}=this,a=o&&t.length;this.initialDisplayMode!=="list"?a&&i&&r===-1?this.selectedFeatureIndex=0:a&&r!==-1||(this.selectedFeatureIndex=t.length?0:-1):(!a||a&&i===o)&&(this.selectedFeatureIndex=-1)}set location(e){var r,a;let t=e;const i=(r=this.spatialReference)==null?void 0:r.isWebMercator;((a=e==null?void 0:e.spatialReference)==null?void 0:a.isWGS84)&&i&&(t=ze(e)),this._set("location",t)}get map(){var e;return((e=this.view)==null?void 0:e.map)??null}set map(e){this._override("map",e)}get pendingPromisesCount(){return this._pendingPromises.size}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){this._pendingPromises.clear(),this.features=[],Array.isArray(e)&&e.length?(this._set("promises",e),(e=e.slice()).forEach((t=>this._pendingPromises.add(t))),e.reduce(((t,i)=>t.finally((()=>i.then((o=>{this._pendingPromises.has(i)&&this._updateFeatures(o)})).finally((()=>this._pendingPromises.delete(i))).catch((()=>{}))))),Promise.resolve())):this._set("promises",[])}get selectedFeature(){const{features:e,selectedFeatureIndex:t}=this;return t===-1?null:e[t]||null}get selectedFeatureIndex(){const e=this._get("selectedFeatureIndex");return typeof e=="number"?e:-1}set selectedFeatureIndex(e){const{featureCount:t}=this;(isNaN(e)||e<0||!t)&&(e=-1),this.activeFeature=null,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get spatialReference(){var e;return((e=this.view)==null?void 0:e.spatialReference)??null}set spatialReference(e){this._override("spatialReference",e)}get state(){const{view:e,map:t}=this;return e?e.ready?"ready":"disabled":t?"ready":"disabled"}get timeZone(){var e;return((e=this.view)==null?void 0:e.timeZone)??je}set timeZone(e){this._overrideIfSome("timeZone",e)}get waitingForContents(){return this.featureViewModels.some((e=>e.waitingForContent))}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||this.featureCount!==0)}centerAtLocation(){const{view:e}=this,t=Pe(this);return t&&e?this.callGoTo({target:{target:t,scale:e.scale}}):Promise.reject(new L("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e}))}zoomTo(e){return this.callGoTo(e)}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(e,t){var o;const{view:i}=this;if(!i||!e)throw new L("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:i});return i.fetchPopupFeatures(e,{pointerType:(o=t==null?void 0:t.event)==null?void 0:o.pointerType,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:t==null?void 0:t.signal})}open(e){const t={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...e,visible:!0},{fetchFeatures:i}=t;delete t.fetchFeatures,i&&this._setFetchFeaturesPromises(t.location);const o=["actionsMenuOpen","collapsed"];for(const r of o)delete t[r];this.set(t)}triggerAction(e){const t=this.allActions.at(e);t&&!t.disabled&&this.emit("trigger-action",{action:t})}next(){return this.selectedFeatureIndex=this._getRoundRobinIndex(this.selectedFeatureIndex+1,this.featureCount),this}previous(){return this.selectedFeatureIndex=this._getRoundRobinIndex(this.selectedFeatureIndex-1,this.featureCount),this}disableClusterBrowsing(){vt(this),this._clearBrowsedClusterGraphics()}async enableClusterBrowsing(){const{view:e,selectedFeature:t}=this;(e==null?void 0:e.type)==="2d"?z(t)?(await pt(this),await gt(this)):O.getLogger(this).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",t):O.getLogger(this).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",t)}handleViewClick(e){this._fetchFeaturesAndOpen(e)}_getRoundRobinIndex(e,t){return(e+t)%t}_animationStateChange(e){this.zoomToLocation||(R.disabled=e==="waiting-for-target")}_clearBrowsedClusterGraphics(){var t,i;const e=[this.selectedClusterBoundaryFeature,this._selectedClusterFeature].filter(Ge);(i=(t=this.view)==null?void 0:t.graphics)==null||i.removeMany(e),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(z(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=this.selectedFeature?[this.selectedFeature]:[])}_locationChange(e){const{selectedFeature:t,updateLocationEnabled:i,view:o}=this;o&&i&&e&&(!t||t.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>0?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>0?1:null}_setGraphicOnFeatureViewModels(){const{features:e,featureCount:t,featurePage:i,featuresPerPage:o,featureViewModels:r}=this;if(i==null)return;const a=((i-1)*o+t)%t,l=a+o;r.slice(a,l).forEach(((u,d)=>{u&&(u.graphic??(u.graphic=e[a+d]))}))}async _selectedFeatureChange(e){var a,l;const{location:t,updateLocationEnabled:i,view:o}=this;if(!e||!o)return;if(this.browseClusterEnabled)return this._selectedClusterFeature&&(o.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),z(e)?void 0:(e.symbol=await pe(e),this._selectedClusterFeature=e,void o.graphics.add(this._selectedClusterFeature));const r=(a=e.sourceLayer)==null?void 0:a.type;if(r!=="map-image"&&r!=="imagery"&&r!=="imagery-tile"||(e.symbol=await pe(e)),!i&&t||!e.geometry){if(i&&!e.geometry){await this.centerAtLocation();const u=(l=o.center)==null?void 0:l.clone();u&&(this.location=u)}}else this.location=ce(e.geometry)}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}async _setFetchFeaturesPromises(e){const{pendingFeatures:t}=await this._fetchFeaturesWithController({mapPoint:e});this.promises=t}_destroyFeatureVMs(){this.featureViewModels.forEach((e=>e&&!e.destroyed&&e.destroy())),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:e,features:t,featureViewModels:i,view:o,spatialReference:r,map:a,timeZone:l,location:u}=this;if(z(t[0])||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!(t!=null&&t.length))return;const d=i.slice(),p=[];t.forEach(((w,M)=>{if(!w)return;let b=null;if(d.some(((_,P)=>(_&&_.graphic===w&&(b=_,d.splice(P,1)),!!b))),b)p[M]=b;else{const _=new Ze({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:r,graphic:w===e?w:null,location:u,map:a,view:o,timeZone:l});p[M]=_}})),d.forEach((w=>w&&!w.destroyed&&w.destroy())),this._set("featureViewModels",p)}async _getScreenPoint(e,t){const{spatialReference:i,view:o}=this;if(!o)return null;await(o==null?void 0:o.when());const r=e==null?void 0:e.spatialReference;return r&&i?(await Ue(r,i,null,t),o.toScreen(e)):null}_cancelFetchingFeatures(){const e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null}async _projectScreenPointAndFetchFeatures({mapPoint:e,screenPoint:t,event:i,signal:o}){return this.fetchFeatures(t??await this._getScreenPoint(e??this.location,{signal:o}),{signal:o,event:i})}_fetchFeaturesWithController({mapPoint:e,screenPoint:t,event:i}){this._cancelFetchingFeatures();const o=new AbortController,{signal:r}=o;this._fetchFeaturesController=o;const a=this._projectScreenPointAndFetchFeatures({mapPoint:e,screenPoint:t,signal:r,event:i});return a.catch((()=>{})).then((()=>{this._fetchFeaturesController=null})),a}async _fetchFeaturesAndOpen(e){const{mapPoint:t,screenPoint:i}=e,{view:o}=this;this.removeHandles(re),this.addHandles([c((()=>{var a;return(a=this.view)==null?void 0:a.scale}),(()=>this._debouncedLocationUpdate(t).catch((a=>{ue(a)||O.getLogger(this).error(a)})))),U((()=>!this.visible),(()=>{this.removeHandles(re)}),{once:!0})],re);const{pendingFeatures:r}=await this._fetchFeaturesWithController({mapPoint:t,screenPoint:i,event:e});o!=null&&o.popup&&"open"in o.popup&&o.popup.open({location:t??void 0,promises:r})}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}async _getLayerView(e,t){return await e.when(),e.whenLayerView(t)}_getHighlightLayer(e){const{layer:t,sourceLayer:i}=e;return i&&"layer"in i&&i.layer?i.layer:(i==null?void 0:i.type)==="map-notes"||(i==null?void 0:i.type)==="subtype-group"?i:t??i}_getHighlightLayerView(e,t){return t.type==="subtype-sublayer"&&t.parent&&this._mapIncludesLayer(t.parent)?this._getLayerView(e,t.parent):t&&this._mapIncludesLayer(t)?this._getLayerView(e,t):null}_getHighlightTarget(e,t,i){if(_t(t.type,i))return e;const o=e.getObjectId();if(o!=null)return o;const r=t.type==="imagery"?void 0:"objectIdField"in t?t.objectIdField||lt:null,a=e.attributes;return a&&r&&a[r]||e}_mapIncludesLayer(e){var t,i;return!!((i=(t=this.map)==null?void 0:t.allLayers)!=null&&i.includes(e))}async _highlightFeature(e,t){this.removeHandles(e);const i=this[t];if(!i)return;const{highlightEnabled:o,view:r,visible:a}=this;if(!r||!o||!a)return;const l=this._getHighlightLayer(i);if(!l)return;const u=this._getHighlightLayerView(r,l);if(!u)return;this._highlightPromises[e]=u;const d=await u;if(!(d&&at(d)&&this._highlightPromises[e]===u&&this[t]&&this.highlightEnabled))return;const p=d.highlight(this._getHighlightTarget(i,l,r.type));this.addHandles(p,e)}async _highlightActiveFeature(){return this._highlightFeature("highlight-active-feature","activeFeature")}async _highlightSelectedFeature(){return this._highlightFeature("highlight-selected-feature","selectedFeature")}_updateFeatures(e){const{features:t}=this,i=e.filter((o=>!t.includes(o)));i!=null&&i.length&&(this.features=t.concat(i))}};s([n()],h.prototype,"_fetchFeaturesController",void 0),s([n({type:j})],h.prototype,"actions",void 0),s([n({readOnly:!0})],h.prototype,"active",null),s([n()],h.prototype,"activeFeature",void 0),s([n({readOnly:!0})],h.prototype,"allActions",null),s([n()],h.prototype,"autoCloseEnabled",void 0),s([n()],h.prototype,"browseClusterEnabled",void 0),s([n()],h.prototype,"content",void 0),s([n({type:j,readOnly:!0})],h.prototype,"defaultActions",null),s([n({type:Boolean})],h.prototype,"defaultPopupTemplateEnabled",void 0),s([n({readOnly:!0})],h.prototype,"featureCount",null),s([n()],h.prototype,"featurePage",void 0),s([n({value:[]})],h.prototype,"features",null),s([n()],h.prototype,"featuresPerPage",void 0),s([n()],h.prototype,"featureMenuOpen",void 0),s([n()],h.prototype,"featureMenuTitle",void 0),s([n()],h.prototype,"featureViewModelAbilities",void 0),s([n({readOnly:!0})],h.prototype,"featureViewModels",void 0),s([n()],h.prototype,"highlightEnabled",void 0),s([n()],h.prototype,"includeDefaultActions",void 0),s([n()],h.prototype,"initialDisplayMode",void 0),s([n({type:qe})],h.prototype,"location",null),s([n()],h.prototype,"map",null),s([n({readOnly:!0})],h.prototype,"pendingPromisesCount",null),s([n({readOnly:!0})],h.prototype,"promiseCount",null),s([n()],h.prototype,"promises",null),s([n({readOnly:!0})],h.prototype,"selectedClusterBoundaryFeature",void 0),s([n({value:null,readOnly:!0})],h.prototype,"selectedFeature",null),s([n({value:-1})],h.prototype,"selectedFeatureIndex",null),s([n({readOnly:!0})],h.prototype,"selectedFeatureViewModel",null),s([n({type:Ke})],h.prototype,"spatialReference",null),s([n({readOnly:!0})],h.prototype,"state",null),s([n()],h.prototype,"timeZone",null),s([n()],h.prototype,"title",void 0),s([n()],h.prototype,"updateLocationEnabled",void 0),s([n()],h.prototype,"view",void 0),s([n()],h.prototype,"visible",void 0),s([n({readOnly:!0})],h.prototype,"waitingForContents",null),s([n({readOnly:!0})],h.prototype,"waitingForResult",null),s([n()],h.prototype,"zoomFactor",void 0),s([n()],h.prototype,"zoomToLocation",void 0),s([n()],h.prototype,"centerAtLocation",null),h=s([T("esri.widgets.Features.FeaturesViewModel")],h);let A=class extends Ie{constructor(){super(...arguments),this.actionBar=!0,this.closeButton=!0,this.collapseButton=!1,this.featureMenuHeading=!0,this.featureNavigation=!0,this.featureListLayerTitle=!0,this.flow=!0,this.heading=!0,this.spinner=!0}};s([n({type:Boolean,nonNullable:!0})],A.prototype,"actionBar",void 0),s([n({type:Boolean,nonNullable:!0})],A.prototype,"closeButton",void 0),s([n({type:Boolean,nonNullable:!0})],A.prototype,"collapseButton",void 0),s([n({type:Boolean,nonNullable:!0})],A.prototype,"featureMenuHeading",void 0),s([n({type:Boolean,nonNullable:!0})],A.prototype,"featureNavigation",void 0),s([n({type:Boolean,nonNullable:!0})],A.prototype,"featureListLayerTitle",void 0),s([n({type:Boolean,nonNullable:!0})],A.prototype,"flow",void 0),s([n({type:Boolean,nonNullable:!0})],A.prototype,"heading",void 0),s([n({type:Boolean,nonNullable:!0})],A.prototype,"spinner",void 0),A=s([T("esri.widgets.Features.FeaturesVisibleElements")],A);const fe="selected-index",mt=0,we="features-spinner";function _e(e){return(e==null?void 0:e.declaredClass.startsWith("esri.layers."))??!1}let v=class extends Qe(ie){constructor(e,t){super(e,t),this._featureMenuIntersectionObserverCallback=([i])=>{i!=null&&i.isIntersecting&&this.viewModel.featurePage!=null&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._featureMenuIntersectionObserverNode=null,this._spinner=null,this._feature=null,this._focusAbortController=null,this._drillInFlowItems=new be,this._drillInWidget=new B({flowItems:this._drillInFlowItems}),this._rootNode=null,this._rootFlowItemNode=null,this._featureMenuViewportNode=null,this._actionBarMenuNode=null,this.collapsed=!1,this.featureNavigationTop=!1,this.headerActions=new j,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.responsiveActionsEnabled=!1,this.viewModel=new h,this.visibleElements=new A,this._previousFeature=()=>{this.viewModel.previous()},this._nextFeature=()=>{this.viewModel.next()},this._handleFeatureBack=()=>{this.initialDisplayMode==="list"?(this.selectedFeatureIndex=-1,this._focusFlowItemNode()):this._openFeatureMenu()},this._handleFeatureMenuBack=()=>{this.initialDisplayMode==="list"?(this.selectedFeatureIndex=-1,this._focusFlowItemNode()):this.featureMenuOpen&&this._closeFeatureMenu()},this._storeRootNode=i=>{this._rootNode=i},this._displaySpinnerThrottled=Je((()=>this._displaySpinner()),mt),this._addSelectedFeatureIndexHandle(),this.addHandles([this._displaySpinnerThrottled,c((()=>{var i;return(i=this.viewModel)==null?void 0:i.active}),(()=>this._toggleScreenLocationEnabled())),c((()=>{var i;return(i=this.viewModel)==null?void 0:i.active}),(i=>this._drillInWidget.closed=!i)),c((()=>{var i;return(i=this.visibleElements)==null?void 0:i.closeButton}),(i=>this._drillInWidget.closable=i)),c((()=>{var i;return(i=this.visibleElements)==null?void 0:i.spinner}),(i=>this._spinnerEnabledChange(i))),c((()=>{var i;return(i=this.viewModel)==null?void 0:i.view}),((i,o)=>this._viewChange(i,o))),c((()=>{var i,o;return(o=(i=this.viewModel)==null?void 0:i.view)==null?void 0:o.ready}),((i,o)=>this._viewReadyChange(i??!1,o??!1))),c((()=>{var i,o;return[(i=this.viewModel)==null?void 0:i.waitingForResult,(o=this.viewModel)==null?void 0:o.location]}),(()=>{this._hideSpinner(),this._displaySpinnerThrottled()})),c((()=>{var i;return(i=this.viewModel)==null?void 0:i.screenLocation}),(()=>this._closeOpenActionMenu())),c((()=>{var i;return(i=this.selectedFeatureWidget)==null?void 0:i.viewModel}),(()=>this._destroyDrillInFlowItemWidgets())),c((()=>this.featureMenuOpen),(()=>this._drillInWidget.selectLastFlowItem=this.initialDisplayMode==="list"||!this.featureMenuOpen),I),c((()=>{var o;const i=(o=this.selectedFeatureWidget)==null?void 0:o.viewModel;return[i==null?void 0:i.title,i==null?void 0:i.state]}),(()=>this._setTitleFromFeatureWidget())),c((()=>{var o;const i=(o=this.selectedFeatureWidget)==null?void 0:o.viewModel;return[i==null?void 0:i.content,i==null?void 0:i.state]}),(()=>this._setContentFromFeatureWidget())),c((()=>{var i;return(i=this.viewModel)==null?void 0:i.featureViewModels}),(()=>this._featureMenuViewportScrollTop())),c((()=>this._drillInFlowItems.length),(()=>this._focusFlowItemNode())),this._drillInWidget.on("close",(()=>this.close())),this._drillInWidget.on("exit",(()=>this._destroyDrillInFlowItemWidgets())),this._drillInWidget.on("open-feature",(({feature:i})=>this._openRelatedFeature(i))),this._drillInWidget.on("zoom-to-feature",(({featureWidget:i})=>xe(this.viewModel,i)))])}loadDependencies(){return Promise.all([Fe(),Ce({action:()=>C(()=>import("./index-fCyVu-Lb.js").then(e=>e.i),__vite__mapDeps([0,1,2,3])),"action-bar":()=>C(()=>import("./index-C9frQNG8.js"),__vite__mapDeps([4,1,2,0,3,5,6,7,8,9,10,11,12,13,14,15,16,17,18])),"action-group":()=>C(()=>import("./index-BQDJMAIu.js"),__vite__mapDeps([19,1,2,0,3,5,6,7,8,9,10,11,12,13,14,15,16])),button:()=>C(()=>import("./index-C2z3vZ9k.js").then(e=>e.yo),__vite__mapDeps([1,2])),icon:()=>C(()=>import("./index-C2z3vZ9k.js").then(e=>e.ym),__vite__mapDeps([1,2])),flow:()=>C(()=>import("./index-BDa6x1zr.js").then(e=>e.i),__vite__mapDeps([36,1,2])),"flow-item":()=>C(()=>import("./index-BnX99nvA.js"),__vite__mapDeps([20,1,2,0,3,5,6,7,8,9,10,11,12,13,14,21,22,23])),list:()=>C(()=>import("./index-BKejzhBw.js"),__vite__mapDeps([37,1,2,38,3,39,40,41,42,43,44,45,46,47,48,49,7,50,51,52])),"list-item":()=>C(()=>import("./index-CgvyjIJ6.js"),__vite__mapDeps([53,1,2,54,6,7,8,55,0,3,56,57,58,59,60,61,51,62])),"list-item-group":()=>C(()=>import("./index-C8QhtbYw.js").then(e=>e.i),__vite__mapDeps([63,1,2,62])),loader:()=>C(()=>import("./index-C2z3vZ9k.js").then(e=>e.yl),__vite__mapDeps([1,2]))})])}destroy(){var e,t,i;this._destroyDrillInFlowItemWidgets(),this._destroySelectedFeatureWidget(),this._destroySpinner(),this._unobserveFeatureMenuObserver(),(e=this._featureMenuIntersectionObserver)==null||e.disconnect(),(t=this._drillInWidget)==null||t.destroy(),(i=this._focusAbortController)==null||i.abort()}get _hideActionText(){var t;if(!this.responsiveActionsEnabled)return!1;const e=(t=this.view)==null?void 0:t.widthBreakpoint;return e==="xsmall"||e==="small"||e==="medium"}get _featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&!!this.viewModel.selectedFeature&&this.visibleElements.featureNavigation}get _isCollapsed(){return this._collapseEnabled&&this.collapsed}get _collapseEnabled(){return this.visibleElements.collapseButton&&(this.initialDisplayMode==="list"||!!this.title&&!!this.content)}get active(){return this.viewModel.active}get content(){return this.viewModel.content}set content(e){this.viewModel.content=e}get icon(){return null}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(e){this.viewModel.featureMenuOpen=e}get featureMenuTitle(){return this.viewModel.featureMenuTitle}set featureMenuTitle(e){this.viewModel.featureMenuTitle=e}get features(){return this.viewModel.features}set features(e){this.viewModel.features=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get initialDisplayMode(){return this.viewModel.initialDisplayMode}set initialDisplayMode(e){this.viewModel.initialDisplayMode=e}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get promises(){return this.viewModel.promises}set promises(e){this.viewModel.promises=e}get selectedFeature(){return this.viewModel.selectedFeature}get selectedDrillInFeature(){const e=Array.from(this._drillInFlowItems).at(-1);if(!e)return null;const{flowType:t}=e;return t==="feature-association"||t==="feature-relationship"?e.graphic??null:null}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(e){this.viewModel.selectedFeatureIndex=e}get selectedFeatureWidget(){const{_feature:e,headingLevel:t,_drillInFlowItems:i,timeZone:o,spatialReference:r,map:a}=this,{selectedFeatureViewModel:l}=this.viewModel,u={title:!1};return l?(e?(e.viewModel=l,e.visibleElements=u):this._feature=new Xe({flowItems:i,headingLevel:t+1,timeZone:o,spatialReference:r,map:a,viewModel:l,visibleElements:u}),this._feature):null}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(e){this.viewModel.updateLocationEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}blur(){var t;const{active:e}=this.viewModel;e?(t=this._rootFlowItemNode)==null||t.blur():O.getLogger(this).warn("Features can only be blurred when currently active.")}clear(){return this.viewModel.clear()}close(){this.viewModel.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){const{active:e}=this.viewModel;e?this._focusFlowItemNode():O.getLogger(this).warn("Features can only be focused when currently active.")}next(){return this.viewModel.next()}open(e){this.removeHandles(fe);const t={collapsed:(e==null?void 0:e.collapsed)??!1};this.set(t),this.viewModel.open(e),this.addHandles(U((()=>!this.viewModel.waitingForResult),(()=>this._addSelectedFeatureIndexHandle()),{once:!0}))}previous(){return this.viewModel.previous()}triggerAction(e){return this.viewModel.triggerAction(e)}render(){return g("div",{afterCreate:this._storeRootNode,bind:this,class:this.classes(y.base,X.widget,X.panel),onkeydown:this._onMainKeydown},this._renderHeader(),this._renderContentContainer())}_renderFeatureNavigation(){return[this._renderPagination(),this.initialDisplayMode==="list"?this._renderFeaturePaginationText():this._renderFeatureMenuButton()]}_renderHeader(){return this.featureNavigationTop&&this._featureNavigationVisible?g("div",{class:y.header,key:"header-actions"},this._renderFeatureNavigation()):null}_renderFooter(){return!this.featureNavigationTop&&this._featureNavigationVisible?g("div",{class:y.footer,key:"footer-actions",slot:"footer"},this._renderFeatureNavigation()):null}_renderFeaturePaginationText(){const{messages:e,viewModel:t}=this,{featureCount:i,selectedFeatureIndex:o}=t;return g("div",{class:y.paginationText,key:"feature-pagination-text"},$(e.pageText,{index:Q(o+1),total:Q(i)}))}_renderFeatureMenuButton(){const{messages:e,viewModel:t}=this,{featureCount:i,selectedFeatureIndex:o,pendingPromisesCount:r}=t;return g("calcite-action",{appearance:"solid",bind:this,class:y.paginationMenuButton,icon:"list",key:"feature-menu-button",label:e.selectFeature,loading:r>0,onclick:this._handlePaginationMenuButton,scale:"s",text:$(e.pageText,{index:Q(o+1),total:Q(i)}),textEnabled:!0,title:e.selectFeature})}_renderPagination(){const{previous:e,next:t}=this.messagesCommon.pagination;return g("calcite-action-bar",{class:y.paginationActionBar,expandDisabled:!0,key:"pagination-action-bar",layout:"horizontal",overflowActionsDisabled:!0,scale:"s"},g("calcite-action-group",{scale:"s"},g("calcite-action",{appearance:"solid",class:y.paginationPrevious,icon:"chevron-left",iconFlipRtl:!0,label:e,onclick:this._previousFeature,scale:"s",text:e,title:e}),g("calcite-action",{appearance:"solid",icon:"chevron-right",iconFlipRtl:!0,label:t,onclick:this._nextFeature,scale:"s",text:t,title:t})))}_renderFeatureMenuItem(e){const{initialDisplayMode:t}=this,{selectedFeatureViewModel:i,featureViewModels:o}=this.viewModel,r=e===i,a=o.indexOf(e);return g("calcite-list-item",{bind:this,"data-feature-index":a,key:`feature-menu-item-${e.uid}`,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onmouseleave:this._removeActiveFeature,onmouseover:this._setActiveFeature,selected:r,onCalciteListItemSelect:this._selectFeature},g("span",{innerHTML:e.title||this.messagesCommon.untitled,slot:"content"}),t==="list"?g("calcite-icon",{flipRtl:!0,icon:"chevron-right",scale:"s",slot:"content-end"}):null)}_groupResultsByLayer(){const{featureViewModels:e}=this.viewModel,t=new Map;return e.forEach((i=>{const o=i==null?void 0:i.graphic;if(!o)return;const{layer:r,sourceLayer:a}=o,l=(_e(r)?r:null)||(_e(a)?a:null),u=t.get(l)??[];t.set(l,[...u,i])})),t}_renderFeatureMenu(){const{messages:e,viewModel:t}=this,i=this._groupResultsByLayer(),o=this.initialDisplayMode==="list"?"none":"single";return t.featureViewModels.length?g("calcite-list",{displayMode:"flat",label:e==null?void 0:e.featuresList,selectionAppearance:"icon",selectionMode:o},Array.from(i.keys(),(r=>{var u;const a=(u=i.get(r))==null?void 0:u.map((d=>this._renderFeatureMenuItem(d))),l=r?r.title??this.messagesCommon.untitled:null;return this.visibleElements.featureListLayerTitle&&l!==null?g("calcite-list-item-group",{heading:l,key:(r==null?void 0:r.uid)||"map-graphics"},a):a}))):null}_renderHeaderAction(e,t){const i=e.title||"";return e.visible?g("calcite-action",{active:e.type==="toggle"&&e.value,appearance:"solid",bind:this,"data-action-id":e.id,"data-action-uid":e.uid,disabled:e.disabled,icon:e.icon??void 0,indicator:e.indicator,key:`header-action-${t}`,loading:e.active,onclick:this._triggerHeaderAction,slot:"header-actions-end",text:i,title:i}):null}_renderHeaderActions(){return this.headerActions.map(((e,t)=>this._renderHeaderAction(e,t))).toArray()}_renderContentFeature(){const{headingLevel:e,visibleElements:t,_isCollapsed:i,_collapseEnabled:o,featureNavigationTop:r,_drillInFlowItems:a,initialDisplayMode:l,selectedFeature:u,featureMenuOpen:d}=this,{title:p,active:w}=this.viewModel,M=t.heading&&p?p:"";if(l==="list"&&!u)return null;const b=a.length===0&&(l==="list"?!!u:!d);return g("calcite-flow-item",{afterCreate:this._storeRootFlowItemNode,bind:this,class:this.classes({[y.contentFeature]:!0,[y.flowItemCollapsed]:i}),closable:t.closeButton,closed:!w,collapsed:i,collapseDirection:r?"down":"up",collapsible:o,headingLevel:e,key:"root-flow-item",selected:b,onCalciteFlowItemBack:this._handleFeatureBack,onCalciteFlowItemClose:this.close,onCalciteFlowItemToggle:this._handleCollapseToggle},M?g(Ye,{class:this.classes(y.featuresHeading,X.heading),innerHTML:M,key:"header-content",level:this.headingLevel,slot:"header-content"}):null,this._renderHeaderActions(),this._renderActionBar(),g("div",{class:this.classes(y.container,y.contentContainer)},this._renderContent()),this._renderFooter())}_renderFeatureMenuContainer(){const{viewModel:e,visibleElements:t,featureMenuTitle:i,messages:o,messagesCommon:r,initialDisplayMode:a,featureMenuOpen:l,selectedFeature:u,_collapseEnabled:d,_isCollapsed:p,featureNavigationTop:w,headingLevel:M}=this,{active:b,featureViewModels:_,pendingPromisesCount:P}=e,{featureMenuHeading:E}=t,D=i??o.selectFeature;if(a==="feature"&&!l)return null;const W=a==="list"?!u:l;return g("calcite-flow-item",{afterCreate:this._storeFeatureMenuFlowItemNode,bind:this,class:this.classes({[y.flowItemCollapsed]:p}),closable:a==="list"&&t.closeButton,closed:!b,collapsed:a==="list"&&p,collapseDirection:w?"down":"up",collapsible:a==="list"&&d,description:E?$(o.total,{total:_.length}):void 0,heading:E?D:void 0,headingLevel:M,key:"feature-menu",loading:e.waitingForContents,selected:W,onCalciteFlowItemBack:Z=>{Z.preventDefault(),this._handleFeatureMenuBack()},onCalciteFlowItemClose:this.close,onCalciteFlowItemToggle:this._handleCollapseToggle},a==="list"?this._renderHeaderActions():null,P>0?g("calcite-loader",{class:y.loader,inline:!0,key:"feature-menu-loader",label:r.loading,slot:"header-actions-end"}):null,g("div",{class:y.container},this._renderFeatureMenu()),g("div",{afterCreate:this._featureMenuIntersectionObserverCreated,bind:this,class:y.featureMenuObserver}),a==="feature"?g("calcite-button",{appearance:"transparent",onclick:this._handleFeatureMenuBack,slot:"footer-actions",width:"full"},r.back):null)}_renderContentContainer(){const e=this.initialDisplayMode==="list"?[this._renderFeatureMenuContainer(),this._renderContentFeature(),this._drillInWidget.render()]:[this._renderContentFeature(),this._drillInWidget.render(),this._renderFeatureMenuContainer()];return this.visibleElements.flow?g("calcite-flow",{key:"content-container"},e):e}_getFallbackIcon(e){const{className:t,icon:i}=e;if(i)return null;const o=et({action:e,feature:this.selectedFeature}),r={[y.icon]:!!t,[y.actionImage]:!!o};return t&&(r[t]=!0),o||t?g("span",{"aria-hidden":"true",class:this.classes(y.icon,r),key:"icon",styles:tt(o)}):null}_renderActionBar(){var e;return!this._isCollapsed&&this.visibleElements.actionBar&&((e=this.viewModel.allActions)!=null&&e.length)?g("calcite-action-bar",{expandDisabled:!0,expanded:!this._hideActionText,key:"header-action-bar",scale:"s",slot:"action-bar"},g("calcite-action-group",{afterCreate:t=>this._actionBarMenuNode=t,overlayPositioning:"fixed",scale:"s"},this._renderActions())):null}_renderActions(){return this.viewModel.allActions.toArray().map(((e,t)=>{const i=this._getActionTitle(e);return Ee(e,{key:`action-${t}`,title:i,text:i,textEnabled:!this._hideActionText,onclick:this._triggerAction,bind:this},this._getFallbackIcon(e))}))}_renderContent(){var t;const e=(t=this.viewModel)==null?void 0:t.content;return e?typeof e=="string"?g("div",{class:it.contentNode,innerHTML:e,key:e}):this.renderNodeContent(e):null}_handleCollapseToggle(){this.collapsed=!this.collapsed}async _openRelatedFeature(e){await e.viewModel.updateGeometry();const t=e.graphic,i=t==null?void 0:t.geometry;if(i==null||t==null)return;this._destroyDrillInFlowItemWidgets(),await this.viewModel.zoomTo({target:i});const o=ce(i);this.open({features:[t],location:o??void 0}),this._focusFlowItemNode()}_handlePaginationMenuButton(){this._updateFeatureMenu()}_openFeatureMenu(){this._updateFeatureMenu(!0)}_closeFeatureMenu(){this._updateFeatureMenu(!1)}_updateFeatureMenu(e=!this.featureMenuOpen){this.featureMenuOpen=e,this._focusFlowItemNode()}async _focusFlowItemNode(){var i,o;(i=this._focusAbortController)==null||i.abort(),this._focusAbortController=new AbortController;const e=this._focusAbortController.signal;await de(ke(e));const t=(o=this._rootNode)==null?void 0:o.querySelector("calcite-flow-item[selected]");ot(t)}_storeRootFlowItemNode(e){this._rootFlowItemNode=e}_storeFeatureMenuFlowItemNode(e){this._featureMenuViewportNode=e}_setActiveFeature(e){var o;const{viewModel:t}=this,i=e.currentTarget["data-feature-index"];t.activeFeature=((o=t.features)==null?void 0:o[i])||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_selectFeature(e){const t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this.initialDisplayMode==="feature"?this._handleFeatureMenuBack():this._focusFlowItemNode()}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_getActionTitle(e){const{messages:t,selectedFeature:i,messagesCommon:o}=this,{id:r}=e,a=i==null?void 0:i.attributes,l=e.title??"",u=r==="zoom-to-feature"?$(l,{messages:t}):r==="remove-selected-feature"?$(l,{messages:o}):r==="zoom-to-clustered-features"||r==="browse-clustered-features"?$(l,{messages:t}):e.title;return u&&a?$(u,a):u??""}_onMainKeydown(e){const{key:t}=e;t==="ArrowLeft"&&(e.stopPropagation(),this._handleFeatureMenuBack(),this.previous()),t==="ArrowRight"&&(e.stopPropagation(),this._handleFeatureMenuBack(),this.next())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&this._featureMenuViewportNode.scrollContentTo({top:0})}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_setTitleFromFeatureWidget(){const{selectedFeatureWidget:e,messagesCommon:t}=this,i=e==null?void 0:e.viewModel;e&&(this.viewModel.title=(i==null?void 0:i.state)==="error"?t==null?void 0:t.errorMessage:(i==null?void 0:i.title)||"")}_addSelectedFeatureIndexHandle(){const e=c((()=>{var t;return(t=this.viewModel)==null?void 0:t.selectedFeatureIndex}),((t,i)=>this._selectedFeatureIndexUpdated(t,i)));this.addHandles(e,fe)}_selectedFeatureIndexUpdated(e,t){const{featureCount:i}=this.viewModel;i&&e!==t&&e!==-1&&(this._destroyDrillInFlowItemWidgets(),this._rootFlowItemNode&&this._rootFlowItemNode.scrollContentTo({top:0}))}_triggerHeaderAction(e){const t=e.currentTarget;if(t.disabled)return;const i=t.dataset.actionUid,o=this.headerActions.find((({uid:r})=>r===i));o&&!o.disabled&&((o==null?void 0:o.type)==="toggle"&&(o.value=!o.value),this.emit("trigger-header-action",{action:o}))}_triggerAction(e){const t=e.currentTarget;if(t.disabled)return;const i=t.dataset.actionUid,{allActions:o}=this.viewModel,r=o.findIndex((l=>l.uid===i)),a=o.at(r);a&&a.type==="toggle"&&(a.value=!a.value),this.viewModel.triggerAction(r)}_createSpinner(e){e&&(this._spinner=new H({view:e}),e.ui.add(this._spinner,{key:we,position:"manual",internal:!0}))}_wireUpView(e){var t;this._destroySpinner(),e&&((t=this.visibleElements)!=null&&t.spinner)&&this._createSpinner(e)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_viewReadyChange(e,t){var i;e?this._wireUpView((i=this.viewModel)==null?void 0:i.view):t&&this.viewModel.clear()}_viewChange(e,t){e&&t&&this.viewModel.clear()}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,!e.destroyed&&e.destroy()),this._feature=null}_closeOpenActionMenu(){const{_actionBarMenuNode:e}=this;e&&(e.menuOpen=!1)}_destroyDrillInFlowItemWidgets(){this._drillInFlowItems.drain((e=>{"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),"activeCategory"in e.viewModel&&(e.viewModel.activeCategory=null),e.viewModel=null,e.destroy()}))}_toggleScreenLocationEnabled(){const{viewModel:e}=this;e&&(e.screenLocationEnabled=e.active)}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:t,waitingForResult:i}=this.viewModel;i&&t?e.show({location:t}):e.hide()}_destroySpinner(){var t,i;const{_spinner:e}=this;e&&((i=(t=e.view)==null?void 0:t.ui)==null||i.remove(e,we),e.destroy(),this._spinner=null)}_spinnerEnabledChange(e){var t;this._destroySpinner(),e&&this._createSpinner((t=this.viewModel)==null?void 0:t.view)}};s([n()],v.prototype,"_drillInFlowItems",void 0),s([n()],v.prototype,"_hideActionText",null),s([n()],v.prototype,"_featureNavigationVisible",null),s([n()],v.prototype,"_isCollapsed",null),s([n()],v.prototype,"_collapseEnabled",null),s([n({readOnly:!0})],v.prototype,"active",null),s([n()],v.prototype,"collapsed",void 0),s([n()],v.prototype,"content",null),s([n()],v.prototype,"icon",null),s([n()],v.prototype,"featureMenuOpen",null),s([n()],v.prototype,"featureMenuTitle",null),s([n()],v.prototype,"featureNavigationTop",void 0),s([n()],v.prototype,"features",null),s([n()],v.prototype,"goToOverride",null),s([n({type:j})],v.prototype,"headerActions",void 0),s([n()],v.prototype,"headingLevel",void 0),s([n()],v.prototype,"initialDisplayMode",null),s([n()],v.prototype,"location",null),s([n()],v.prototype,"label",null),s([n()],v.prototype,"map",null),s([n(),Y("esri/widgets/Features/t9n/Features")],v.prototype,"messages",void 0),s([n(),Y("esri/t9n/common")],v.prototype,"messagesCommon",void 0),s([n()],v.prototype,"promises",null),s([n()],v.prototype,"responsiveActionsEnabled",void 0),s([n({readOnly:!0})],v.prototype,"selectedFeature",null),s([n({readOnly:!0})],v.prototype,"selectedDrillInFeature",null),s([n()],v.prototype,"selectedFeatureIndex",null),s([n({readOnly:!0})],v.prototype,"selectedFeatureWidget",null),s([n()],v.prototype,"spatialReference",null),s([n()],v.prototype,"title",null),s([n()],v.prototype,"timeZone",null),s([n()],v.prototype,"updateLocationEnabled",null),s([n()],v.prototype,"view",null),s([n({type:h}),Ae(["triggerAction","trigger-action"])],v.prototype,"viewModel",void 0),s([n({type:A,nonNullable:!0})],v.prototype,"visibleElements",void 0),s([n()],v.prototype,"visible",null),v=s([T("esri.widgets.Features")],v);const k="esri-popup",S=`${k}--is-docked`,m={base:k,baseHidden:`${k}--hidden`,main:`${k}__main-container`,shadow:`${k}--shadow`,isDocked:S,isDockedTopLeft:`${S}-top-left`,isDockedTopCenter:`${S}-top-center`,isDockedTopRight:`${S}-top-right`,isDockedBottomLeft:`${S}-bottom-left`,isDockedBottomCenter:`${S}-bottom-center`,isDockedBottomRight:`${S}-bottom-right`,alignTopCenter:`${k}--aligned-top-center`,alignBottomCenter:`${k}--aligned-bottom-center`,alignTopLeft:`${k}--aligned-top-left`,alignBottomLeft:`${k}--aligned-bottom-left`,alignTopRight:`${k}--aligned-top-right`,alignBottomRight:`${k}--aligned-bottom-right`,pointer:`${k}__pointer`,pointerDirection:`${k}__pointer-direction`};let te=class extends h{constructor(e){super(e)}};te=s([T("esri.widgets.Popup.PopupViewModel")],te);let x=class extends Ie{constructor(){super(...arguments),this.actionBar=!0,this.closeButton=!0,this.collapseButton=!0,this.featureMenuHeading=!0,this.featureNavigation=!0,this.featureListLayerTitle=!0,this.heading=!0,this.spinner=!0}};s([n({type:Boolean,nonNullable:!0})],x.prototype,"actionBar",void 0),s([n({type:Boolean,nonNullable:!0})],x.prototype,"closeButton",void 0),s([n({type:Boolean,nonNullable:!0})],x.prototype,"collapseButton",void 0),s([n({type:Boolean,nonNullable:!0})],x.prototype,"featureMenuHeading",void 0),s([n({type:Boolean,nonNullable:!0})],x.prototype,"featureNavigation",void 0),s([n({type:Boolean,nonNullable:!0})],x.prototype,"featureListLayerTitle",void 0),s([n({type:Boolean,nonNullable:!0})],x.prototype,"heading",void 0),s([n({type:Boolean,nonNullable:!0})],x.prototype,"spinner",void 0),x=s([T("esri.widgets.Popup.PopupVisibleElements")],x);const yt=200,me={buttonEnabled:!0,position:"auto",breakpoint:{width:544}};let f=class extends ie{constructor(e,t){super(e,t),this._dockAction=new K({id:"popup-dock-action"}),this._featuresWidget=new v({responsiveActionsEnabled:!0}),this._containerNode=null,this._mainContainerNode=null,this._pointerOffsetInPx=16,this._focusAbortController=null,this.alignment="auto",this.dockEnabled=!1,this.headingLevel=2,this.messages=null,this.viewModel=new te,this.visibleElements=new x}initialize(){this.addHandles([c((()=>{var e,t;return[(t=(e=this.viewModel)==null?void 0:e.view)==null?void 0:t.widthBreakpoint,this.dockEnabled]}),(()=>this._handleDockIcon()),I),c((()=>{var e,t;return[this.dockEnabled,(e=this.messages)==null?void 0:e.undock,(t=this.messages)==null?void 0:t.dock]}),(()=>this._handleDockEnabled()),I),c((()=>this.dockOptions),(e=>{const{_dockAction:t}=this,i=this._featuresWidget.headerActions;i.remove(t),e.buttonEnabled&&i.add(t)}),I),c((()=>{var e;return(e=this.viewModel)==null?void 0:e.screenLocation}),(()=>this._positionContainer())),c((()=>{var e;return[(e=this.viewModel)==null?void 0:e.active,this.dockEnabled]}),(()=>this._toggleScreenLocationEnabled())),c((()=>{var e,t,i,o,r,a,l;return[(e=this.viewModel)==null?void 0:e.screenLocation,(i=(t=this.viewModel)==null?void 0:t.view)==null?void 0:i.padding,(r=(o=this.viewModel)==null?void 0:o.view)==null?void 0:r.size,(a=this.viewModel)==null?void 0:a.active,(l=this.viewModel)==null?void 0:l.location,this.alignment]}),(()=>this.reposition())),c((()=>{var e,t;return(t=(e=this.viewModel)==null?void 0:e.view)==null?void 0:t.size}),((e,t)=>this._updateDockEnabledForViewSize(e,t))),c((()=>{var e;return(e=this.viewModel)==null?void 0:e.view}),((e,t)=>this._viewChange(e,t))),c((()=>{var e,t;return(t=(e=this.viewModel)==null?void 0:e.view)==null?void 0:t.ready}),((e,t)=>this._viewReadyChange(e??!1,t??!1))),c((()=>this.viewModel),(()=>this._featuresWidget.viewModel=this.viewModel),I),c((()=>this._featureNavigationTop),(e=>this._featuresWidget.featureNavigationTop=e),I),c((()=>this.headingLevel),(e=>this._featuresWidget.headingLevel=e),I),c((()=>this.visibleElements.actionBar),(e=>this._featuresWidget.visibleElements.actionBar=!!e),I),c((()=>this.visibleElements.closeButton),(e=>this._featuresWidget.visibleElements.closeButton=!!e),I),c((()=>this.visibleElements.collapseButton),(e=>this._featuresWidget.visibleElements.collapseButton=!!e),I),c((()=>this.visibleElements.heading),(e=>this._featuresWidget.visibleElements.heading=!!e),I),c((()=>this.visibleElements.spinner),(e=>this._featuresWidget.visibleElements.spinner=!!e),I),c((()=>this.visibleElements.featureNavigation),(e=>this._featuresWidget.visibleElements.featureNavigation=!!e),I),c((()=>this.visibleElements.featureMenuHeading),(e=>this._featuresWidget.visibleElements.featureMenuHeading=!!e),I),c((()=>this.visibleElements.featureListLayerTitle),(e=>this._featuresWidget.visibleElements.featureListLayerTitle=!!e),I),st((()=>this._featuresWidget),"trigger-header-action",(e=>{e.action===this._dockAction&&(this.dockEnabled=!this.dockEnabled)}))])}destroy(){var e;this._dockAction.destroy(),this._featuresWidget&&(this._featuresWidget.viewModel=new h,this._featuresWidget.destroy()),(e=this._focusAbortController)==null||e.abort()}get _featureNavigationTop(){const{currentAlignment:e,currentDockPosition:t}=this;return e==="bottom-left"||e==="bottom-center"||e==="bottom-right"||t==="top-left"||t==="top-center"||t==="top-right"}get actions(){return this.viewModel.actions}set actions(e){this.viewModel.actions=e}get active(){return this.viewModel.active}get autoCloseEnabled(){return this.viewModel.autoCloseEnabled}set autoCloseEnabled(e){this.viewModel.autoCloseEnabled=e}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(e){this.viewModel.defaultPopupTemplateEnabled=e}get content(){return this.viewModel.content}set content(e){this.viewModel.content=e}get collapsed(){return this._featuresWidget.collapsed}set collapsed(e){this._featuresWidget.collapsed=e}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||me}set dockOptions(e){var u,d;const t={...me},i=(d=(u=this.viewModel)==null?void 0:u.view)==null?void 0:d.breakpoints,o={};i&&(o.width=i.xsmall,o.height=i.xsmall);const r={...t,...e},a={...t.breakpoint,...o},{breakpoint:l}=r;typeof l=="object"?r.breakpoint={...a,...l}:l&&(r.breakpoint=a),this._set("dockOptions",r),this._setCurrentDockPosition(),this.reposition()}get featureCount(){return this.viewModel.featureCount}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(e){this.viewModel.featureMenuOpen=e}get features(){return this.viewModel.features}set features(e){this.viewModel.features=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(e){this.viewModel.highlightEnabled=e}get icon(){return"popup"}set icon(e){this._overrideIfSome("icon",e)}get initialDisplayMode(){return this.viewModel.initialDisplayMode}set initialDisplayMode(e){this.viewModel.initialDisplayMode=e}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get promises(){return this.viewModel.promises}set promises(e){this.viewModel.promises=e}get selectedFeature(){return this.viewModel.selectedFeature}get selectedDrillInFeature(){return this._featuresWidget.selectedDrillInFeature??null}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(e){this.viewModel.selectedFeatureIndex=e}get selectedFeatureWidget(){return this._featuresWidget.selectedFeatureWidget}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(e){this.viewModel.updateLocationEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}blur(){const{active:e}=this.viewModel;e||O.getLogger(this).warn("Popup can only be blurred when currently active."),this._featuresWidget.blur()}clear(){return this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){const{active:e}=this.viewModel;e||O.getLogger(this).warn("Popup can only be focused when currently active."),this._handleFocus()}next(){return this.viewModel.next()}open(e){const t=!!e&&!!e.featureMenuOpen,i={collapsed:!!e&&!!e.collapsed,featureMenuOpen:t};this.set(i),this.viewModel.open(e),e!=null&&e.shouldFocus&&this._handleFocus(!0)}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){return this.viewModel.triggerAction(e)}render(){var w,M,b,_;const{dockEnabled:e,currentAlignment:t,currentDockPosition:i}=this,{active:o,screenLocation:r}=this.viewModel,a=o&&e,l=o&&!e,u=(M=(w=this.selectedFeature)==null?void 0:w.layer)==null?void 0:M.title,d=(_=(b=this.selectedFeature)==null?void 0:b.layer)==null?void 0:_.id,p={[m.alignTopCenter]:t==="top-center",[m.alignBottomCenter]:t==="bottom-center",[m.alignTopLeft]:t==="top-left",[m.alignBottomLeft]:t==="bottom-left",[m.alignTopRight]:t==="top-right",[m.alignBottomRight]:t==="bottom-right",[m.isDocked]:a,[m.shadow]:l,[m.isDockedTopLeft]:i==="top-left",[m.isDockedTopCenter]:i==="top-center",[m.isDockedTopRight]:i==="top-right",[m.isDockedBottomLeft]:i==="bottom-left",[m.isDockedBottomCenter]:i==="bottom-center",[m.isDockedBottomRight]:i==="bottom-right"};return g("div",{afterCreate:this._positionContainer,afterUpdate:this._positionContainer,"aria-hidden":(!o).toString(),"aria-label":le(this.title??""),"aria-modal":"false",bind:this,class:this.classes(m.base,p,{[m.baseHidden]:!r&&!e}),"data-layer-id":d,"data-layer-title":u,role:"dialog"},o?[this._renderMainContainer(),this._renderPointer()]:null)}_renderPointer(){return this.dockEnabled?null:g("div",{class:m.pointer,key:"popup-pointer",role:"presentation"},g("div",{class:this.classes(m.pointerDirection,m.shadow)}))}_renderMainContainer(){const{dockEnabled:e}=this,t={[m.shadow]:e};return g("div",{afterCreate:this._setMainContainerNode,afterUpdate:this._setMainContainerNode,bind:this,class:this.classes(m.main,X.widget,t)},this._featuresWidget.render())}_getAnimationDurationMS(){const{_containerNode:e}=this;return e?1e3*parseFloat(window.getComputedStyle(e).animationDuration):yt}async _handleFocus(e=!1){var i;(i=this._focusAbortController)==null||i.abort(),this._focusAbortController=new AbortController;const t=this._focusAbortController.signal;e&&await nt((()=>{var o;return((o=this.viewModel)==null?void 0:o.active)===!0}),{signal:t}),await de(ke(t)),await de(ye(this._getAnimationDurationMS(),t)),this._featuresWidget.focus()}_isOutsideView(e){const{popupHeight:t,popupWidth:i,screenLocation:o,side:r,view:a}=e;if(isNaN(i)||isNaN(t)||!a||!o)return!1;const l=a.padding;return r==="right"&&o.x+i/2>a.width-l.right||r==="left"&&o.x-i/2<l.left||r==="top"&&o.y-t<l.top||r==="bottom"&&o.y+t>a.height-l.bottom}_calculateAutoAlignment(e){if(e!=="auto")return e;const{_pointerOffsetInPx:t,_containerNode:i,_mainContainerNode:o,viewModel:r}=this,{screenLocation:a,view:l}=r;if(a==null||!l||!i)return"top-center";function u(Le){return parseInt(Le.replaceAll(/[^-\d.]/g,""),10)}const d=o?window.getComputedStyle(o,null):null,p=d?u(d.getPropertyValue("max-height")):0,w=d?u(d.getPropertyValue("height")):0,{height:M,width:b}=i.getBoundingClientRect(),_=b+t,P=Math.max(M,p,w)+t,E=this._isOutsideView({popupHeight:P,popupWidth:_,screenLocation:a,side:"right",view:l}),D=this._isOutsideView({popupHeight:P,popupWidth:_,screenLocation:a,side:"left",view:l}),W=this._isOutsideView({popupHeight:P,popupWidth:_,screenLocation:a,side:"top",view:l}),Z=this._isOutsideView({popupHeight:P,popupWidth:_,screenLocation:a,side:"bottom",view:l});return D?W?"bottom-right":"top-right":E?W?"bottom-left":"top-left":W?Z?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return typeof e=="function"?e.call(this):e}_getCurrentAlignment(){const{alignment:e,dockEnabled:t,_containerNode:i}=this;return!t&&this.viewModel.active&&i?this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e))):null}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){const t=["left","right"];return ge(this.container)&&t.reverse(),e==null?void 0:e.replace(/leading/gi,t[0]).replaceAll(/trailing/gi,t[1])}_callDockPosition(e){return typeof e=="function"?e.call(this):e}_getDockPosition(){var e;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition((e=this.dockOptions)==null?void 0:e.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_calculateAutoDockPosition(e){var l;if(e!=="auto")return e;const t=(l=this.viewModel)==null?void 0:l.view,i=ge(this.container)?"top-left":"top-right";if(!t)return i;const o=t.padding||{left:0,right:0},r=t.width-o.left-o.right,{breakpoints:a}=t;return a&&r<=a.xsmall?"bottom-center":i}_getDockIcon(){const e=this._getDockPosition();if(this.dockEnabled)return"minimize";switch(e){case"top-left":case"bottom-left":return"dock-left";case"top-center":return"maximize";case"bottom-center":return"dock-bottom";default:return"dock-right"}}_handleDockIcon(){this._dockAction.icon=this._getDockIcon()}_handleDockEnabled(){var e,t;this._dockAction.title=this.dockEnabled?(e=this.messages)==null?void 0:e.undock:(t=this.messages)==null?void 0:t.dock}_setMainContainerNode(e){this._mainContainerNode=e}_positionContainer(e=this._containerNode){if(e&&(this._containerNode=e),!this._containerNode)return;const{screenLocation:t}=this.viewModel,{width:i}=this._containerNode.getBoundingClientRect(),o=this._calculatePositionStyle(t,i);o&&Object.assign(this._containerNode.style,o)}_calculateFullWidth(e){const{currentAlignment:t,_pointerOffsetInPx:i}=this;return t==="top-left"||t==="bottom-left"||t==="top-right"||t==="bottom-right"?e+i:e}_calculateAlignmentPosition(e,t,i,o){const{currentAlignment:r,_pointerOffsetInPx:a}=this;if(!i)return;const{padding:l}=i,u=o/2,d=i.height-t,p=i.width-e;return r==="bottom-center"?{top:t+a-l.top,left:e-u-l.left}:r==="top-left"?{bottom:d+a-l.bottom,right:p+a-l.right}:r==="bottom-left"?{top:t+a-l.top,right:p+a-l.right}:r==="top-right"?{bottom:d+a-l.bottom,left:e+a-l.left}:r==="bottom-right"?{top:t+a-l.top,left:e+a-l.left}:r==="top-center"?{bottom:d+a-l.bottom,left:e-u-l.left}:void 0}_calculatePositionStyle(e,t){const{dockEnabled:i,view:o}=this;if(!o)return;if(i)return{left:"",top:"",right:"",bottom:""};if(e==null||!t)return;const r=this._calculateFullWidth(t),a=this._calculateAlignmentPosition(e.x,e.y,o,r);return a?{top:a.top!==void 0?`${a.top}px`:"auto",left:a.left!==void 0?`${a.left}px`:"auto",bottom:a.bottom!==void 0?`${a.bottom}px`:"auto",right:a.right!==void 0?`${a.right}px`:"auto"}:void 0}_viewChange(e,t){e&&t&&(this.close(),this.clear())}_viewReadyChange(e,t){e?this._wireUpView():t&&(this.close(),this.clear())}_wireUpView(){this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,t,i){const[o,r]=e,[a,l]=t,{width:u=0,height:d=0}=i??{};return o<=u&&a>u||o>u&&a<=u||r<=d&&l>d||r>d&&l<=d}_updateDockEnabledForViewSize(e,t){var p,w;if(!e||!t)return;const i=((w=(p=this.viewModel)==null?void 0:p.view)==null?void 0:w.padding)||{left:0,right:0,top:0,bottom:0},o=i.left+i.right,r=i.top+i.bottom,a=[],l=[];a[0]=e[0]-o,a[1]=e[1]-r,l[0]=t[0]-o,l[1]=t[1]-r;const{dockOptions:u}=this,d=u.breakpoint;this._dockingThresholdCrossed(a,l,d)&&this._setDockEnabledForViewSize(u),this._setCurrentDockPosition()}_toggleScreenLocationEnabled(){const{dockEnabled:e,viewModel:t}=this;if(!t)return;const i=t.active&&!e;t.screenLocationEnabled=i}_shouldDockAtCurrentViewSize(e){var u,d;const t=e.breakpoint,i=(d=(u=this.viewModel)==null?void 0:u.view)==null?void 0:d.ui;if(!i)return!1;const{width:o,height:r}=i;if(isNaN(o)||isNaN(r)||!t)return!1;const a=t.hasOwnProperty("width")&&o<=(t.width??0),l=t.hasOwnProperty("height")&&r<=(t.height??0);return a||l}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}};s([n()],f.prototype,"_containerNode",void 0),s([n({readOnly:!0})],f.prototype,"_featureNavigationTop",null),s([n()],f.prototype,"actions",null),s([n({readOnly:!0})],f.prototype,"active",null),s([n()],f.prototype,"alignment",void 0),s([n()],f.prototype,"autoCloseEnabled",null),s([n()],f.prototype,"defaultPopupTemplateEnabled",null),s([n()],f.prototype,"content",null),s([n()],f.prototype,"collapsed",null),s([n({readOnly:!0})],f.prototype,"currentAlignment",null),s([n({readOnly:!0})],f.prototype,"currentDockPosition",null),s([n()],f.prototype,"dockOptions",null),s([n()],f.prototype,"dockEnabled",void 0),s([n({readOnly:!0})],f.prototype,"featureCount",null),s([n()],f.prototype,"featureMenuOpen",null),s([n()],f.prototype,"features",null),s([n()],f.prototype,"goToOverride",null),s([n()],f.prototype,"headingLevel",void 0),s([n()],f.prototype,"highlightEnabled",null),s([n()],f.prototype,"icon",null),s([n()],f.prototype,"initialDisplayMode",null),s([n()],f.prototype,"location",null),s([n()],f.prototype,"label",null),s([n(),Y("esri/widgets/Popup/t9n/Popup")],f.prototype,"messages",void 0),s([n()],f.prototype,"promises",null),s([n({readOnly:!0})],f.prototype,"selectedFeature",null),s([n({readOnly:!0})],f.prototype,"selectedDrillInFeature",null),s([n()],f.prototype,"selectedFeatureIndex",null),s([n({readOnly:!0})],f.prototype,"selectedFeatureWidget",null),s([n()],f.prototype,"title",null),s([n()],f.prototype,"updateLocationEnabled",null),s([n()],f.prototype,"view",null),s([n({type:te}),Ae(["triggerAction","trigger-action"])],f.prototype,"viewModel",void 0),s([n()],f.prototype,"visible",null),s([n({type:x,nonNullable:!0})],f.prototype,"visibleElements",void 0),f=s([T("esri.widgets.Popup")],f);const Pt=f;export{Pt as default};
