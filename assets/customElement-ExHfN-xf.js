import{L as B,c as E,G as C,a as c,d as I,j as S,v as x,J as O,p as y,I as G,s as d,x as b,i as T,b as D}from"./index-C2z3vZ9k.js";import{d as $,c as P}from"./sortableComponent-DaXvZJyv.js";import{d as w}from"./debounce-DbkufipY.js";/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */function k(u){return u.tagName==="CALCITE-BLOCK"}const h={container:"container",groupContainer:"group-container",scrim:"scrim",assistiveText:"assistive-text"},m="calcite-block-group",f="calcite-block",A=T`:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:block}.container{position:relative}.assistive-text{position:absolute;inline-size:1px;block-size:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}:host([hidden]){display:none}[hidden]{display:none}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}`;function H(u){const e=u.assignedElements({flatten:!0}).filter(a=>a.matches(f));e.forEach(a=>{a.setPosition=e.indexOf(a)+1,a.setSize=e.length})}const p=class p extends B{constructor(){super(),this.dragSelector=f,this.handleSelector="calcite-sort-handle",this.mutationObserver=E("mutation",()=>{this.updateBlockItems()}),this.updateBlockItems=w(()=>{this.updateGroupItems();const{dragEnabled:e,el:a,moveToItems:s}=this;Array.from(this.el.querySelectorAll(f)).forEach(t=>{t.closest(m)===a&&(t.moveToItems=s.filter(l=>l.element!==a&&!t.contains(l.element)),t.dragHandle=e)}),this.setUpSorting()},C.nextTick),this.moveToItems=[],this.disabled=!1,this.dragEnabled=!1,this.loading=!1,this.calciteBlockGroupDragEnd=c({cancelable:!1}),this.calciteBlockGroupDragStart=c({cancelable:!1}),this.calciteBlockGroupOrderChange=c({cancelable:!1}),this.calciteBlockGroupMoveHalt=c({cancelable:!1}),this.listen("calciteInternalAssistiveTextChange",this.handleCalciteInternalAssistiveTextChange),this.listen("calciteSortHandleReorder",this.handleSortReorder),this.listen("calciteSortHandleMove",this.handleSortMove)}async setFocus(){await I(this),S(this.el)}putFailed(e){this.calciteBlockGroupMoveHalt.emit(e)}connectedCallback(){super.connectedCallback(),this.connectObserver(),this.updateBlockItems(),this.setUpSorting(),this.setParentBlockGroup()}willUpdate(e){(e.has("group")||e.has("dragEnabled")&&(this.hasUpdated||this.dragEnabled!==!1))&&this.updateBlockItems()}updated(){x(this)}disconnectedCallback(){super.disconnectedCallback(),this.disconnectObserver(),$(this)}updateGroupItems(){const{el:e,group:a}=this,s=O(e),i=a?Array.from(s.querySelectorAll(`${m}[group="${a}"]`)).filter(t=>!t.disabled&&t.dragEnabled):[];this.moveToItems=i.map(t=>({element:t,label:t.label??t.id,id:y()}))}handleCalciteInternalAssistiveTextChange(e){this.assistiveText=e.detail.message,e.stopPropagation()}handleSortReorder(e){this.parentBlockGroupEl||e.defaultPrevented||(e.preventDefault(),this.handleReorder(e))}handleSortMove(e){this.parentBlockGroupEl||e.defaultPrevented||(e.preventDefault(),this.handleMove(e))}connectObserver(){var e;(e=this.mutationObserver)==null||e.observe(this.el,{childList:!0,subtree:!0})}disconnectObserver(){var e;(e=this.mutationObserver)==null||e.disconnect()}setUpSorting(){const{dragEnabled:e}=this;e&&P(this)}onGlobalDragStart(){this.disconnectObserver()}onGlobalDragEnd(){this.connectObserver()}onDragEnd(e){this.calciteBlockGroupDragEnd.emit(e)}onDragStart(e){e.dragEl.sortHandleOpen=!1,this.calciteBlockGroupDragStart.emit(e)}onDragSort(e){this.setParentBlockGroup(),this.updateBlockItems(),this.calciteBlockGroupOrderChange.emit(e)}setParentBlockGroup(){var e;this.parentBlockGroupEl=(e=this.el.parentElement)==null?void 0:e.closest(m)}handleDefaultSlotChange(e){H(e.target)}handleMove(e){var n,v;const{moveTo:a}=e.detail,s=e.target,i=s==null?void 0:s.parentElement,t=a.element,o=Array.from(i.children).filter(k).indexOf(s),r=0;if(i){if(((n=i.canPull)==null?void 0:n.call(i,{toEl:t,fromEl:i,dragEl:s,newIndex:r,oldIndex:o}))===!1){this.calciteBlockGroupMoveHalt.emit({toEl:t,fromEl:i,dragEl:s,oldIndex:o,newIndex:r});return}if(((v=t.canPut)==null?void 0:v.call(t,{toEl:t,fromEl:i,dragEl:s,newIndex:r,oldIndex:o}))===!1){t.putFailed({toEl:t,fromEl:i,dragEl:s,oldIndex:o,newIndex:r});return}s.sortHandleOpen=!1,this.disconnectObserver(),t.prepend(s),this.updateBlockItems(),this.connectObserver(),this.calciteBlockGroupOrderChange.emit({dragEl:s,fromEl:i,toEl:t,newIndex:r,oldIndex:o})}}handleReorder(e){const{reorder:a}=e.detail,s=e.target,i=s==null?void 0:s.parentElement;if(!i)return;s.sortHandleOpen=!1;const t=Array.from(i.children).filter(k),l=t.length-1,o=t.indexOf(s);let r=o;switch(a){case"top":r=0;break;case"bottom":r=l;break;case"up":r=o===0?0:o-1;break;case"down":r=o===l?l:o+1;break}this.disconnectObserver();const n=a==="up"||a==="top"?t[r]:t[r].nextSibling;i.insertBefore(s,n),this.updateBlockItems(),this.connectObserver(),this.calciteBlockGroupOrderChange.emit({dragEl:s,fromEl:i,toEl:i,newIndex:r,oldIndex:o})}render(){const{loading:e,label:a}=this;return G({disabled:this.disabled,children:b`<div class=${d(h.container)}>${this.dragEnabled?b`<span aria-live=assertive class=${d(h.assistiveText)}>${this.assistiveText}</span>`:null}${e?b`<calcite-scrim class=${d(h.scrim)} .loading=${e}></calcite-scrim>`:null}<div .ariaBusy=${e} .ariaLabel=${a||""} class=${d(h.groupContainer)} role=group><slot @slotchange=${this.handleDefaultSlotChange}></slot></div></div>`})}};p.properties={assistiveText:[16,{},{state:!0}],moveToItems:[16,{},{state:!0}],canPull:[0,{},{attribute:!1}],canPut:[0,{},{attribute:!1}],disabled:[7,{},{reflect:!0,type:Boolean}],dragEnabled:[7,{},{reflect:!0,type:Boolean}],group:[3,{},{reflect:!0}],label:1,loading:[7,{},{reflect:!0,type:Boolean}]},p.styles=A;let g=p;D("calcite-block-group",g);export{g as BlockGroup};
