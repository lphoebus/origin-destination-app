import{L as y,c as P,u as w,a as p,d as D,v as k,f as b,J as M,p as T,I as O,s as f,n as x,x as h,i as R,G as H,b as N}from"./index-C2z3vZ9k.js";import{i as g}from"./keyed-BknSWaOu.js";import{l as m,u as U,a as v,b as L,i as C,e as G}from"./utils-BfRXXPiF.js";import{d as z,c as B}from"./sortableComponent-DaXvZJyv.js";import{S as A}from"./resources-DRBlqAoC.js";import{n as $}from"./locale-CwRicNcW.js";import{d as q}from"./debounce-DbkufipY.js";/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const u={container:"container",table:"table",scrim:"scrim",stack:"stack",tableContainer:"table-container",sticky:"sticky-pos",assistiveText:"assistive-text"},E={filterNoResults:"filter-no-results",filterActionsStart:"filter-actions-start",filterActionsEnd:"filter-actions-end"},W=R`:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:block}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}.container{position:relative;background-color:var(--calcite-list-background-color, var(--calcite-color-foreground-1))}.table-container{box-sizing:border-box;display:flex;inline-size:100%;flex-direction:column;background-color:transparent}.table-container *{box-sizing:border-box}.table{inline-size:100%}.stack{--calcite-stack-padding-inline: 0;--calcite-stack-padding-block: 0}.sticky-pos{position:sticky;inset-block-start:0px;z-index:var(--calcite-z-index-sticky);background-color:var(--calcite-list-background-color, var(--calcite-color-foreground-1))}.assistive-text{position:absolute;inline-size:1px;block-size:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}:host([hidden]){display:none}[hidden]{display:none}`,K=`${L}, ${m}`,I=class I extends y{constructor(){super(),this.dragSelector=m,this.focusableItems=[],this.handleSelector="calcite-sort-handle",this.listItems=[],this.listItemGroups=[],this.mutationObserver=P("mutation",()=>{this.willPerformFilter=!0,this.updateListItems()}),this.updateListItems=q(()=>{this.updateGroupItems();const{selectionAppearance:e,selectionMode:t,interactionMode:i,dragEnabled:s,el:a,filterEl:l,moveToItems:r,displayMode:n,scale:c}=this,d=Array.from(this.el.querySelectorAll(m));if(d.forEach(o=>{o.scale=c,o.selectionAppearance=e,o.selectionMode=t,o.interactionMode=i,o.closest(v)===a&&(o.moveToItems=r.filter(F=>F.element!==a&&!o.contains(F.element)),o.dragHandle=s,o.displayMode=n)}),this.parentListEl){this.setUpSorting();return}this.listItems=d,this.filterEnabled&&this.willPerformFilter&&(this.willPerformFilter=!1,this.dataForFilter=this.getItemData(),l&&(l.items=this.dataForFilter,this.filterAndUpdateData())),this.visibleItems=this.listItems.filter(o=>!o.closed&&!o.hidden),this.updateFilteredItems(),this.borderItems(),this.focusableItems=this.filteredItems.filter(o=>!o.disabled),this.setActiveListItem(),this.updateSelectedItems(),this.setUpSorting()},H.nextTick),this.visibleItems=[],this.willFilterEmit=!1,this.willPerformFilter=!1,this.messages=w({blocking:!0}),this.dataForFilter=[],this.hasFilterActionsEnd=!1,this.hasFilterActionsStart=!1,this.hasFilterNoResults=!1,this.moveToItems=[],this.disabled=!1,this.dragEnabled=!1,this.filterEnabled=!1,this.filteredData=[],this.filteredItems=[],this.interactionMode="interactive",this.loading=!1,this.displayMode="flat",this.scale="m",this.selectedItems=[],this.selectionAppearance="icon",this.selectionMode="none",this.calciteInternalListDefaultSlotChange=p({cancelable:!1}),this.calciteListChange=p({cancelable:!1}),this.calciteListDragEnd=p({cancelable:!1}),this.calciteListDragStart=p({cancelable:!1}),this.calciteListFilter=p({cancelable:!1}),this.calciteListMoveHalt=p({cancelable:!1}),this.calciteListOrderChange=p({cancelable:!1}),this.listen("calciteInternalListItemToggle",this.handleCalciteListItemToggle),this.listen("calciteInternalFocusPreviousItem",this.handleCalciteInternalFocusPreviousItem),this.listen("calciteInternalListItemActive",this.handleCalciteInternalListItemActive),this.listen("calciteListItemSelect",this.handleCalciteListItemSelect),this.listen("calciteInternalAssistiveTextChange",this.handleCalciteInternalAssistiveTextChange),this.listen("calciteSortHandleReorder",this.handleSortReorder),this.listen("calciteSortHandleMove",this.handleSortMove),this.listen("calciteInternalListItemSelect",this.handleCalciteInternalListItemSelect),this.listen("calciteInternalListItemSelectMultiple",this.handleCalciteInternalListItemSelectMultiple),this.listen("calciteInternalListItemChange",this.handleCalciteInternalListItemChange),this.listen("calciteInternalListItemGroupDefaultSlotChange",this.handleCalciteInternalListItemGroupDefaultSlotChange)}get hasActiveFilter(){return this.filterEnabled&&this.filterText&&this.filteredItems.length!==this.visibleItems.length}get showNoResultsContainer(){return this.filterEnabled&&this.filterText&&this.hasFilterNoResults&&this.visibleItems.length&&!this.filteredItems.length}putFailed(e){this.calciteListMoveHalt.emit(e)}async setFocus(){var e,t;return await D(this),this.filterEnabled?(e=this.filterEl)==null?void 0:e.setFocus():(t=this.focusableItems.find(i=>i.active))==null?void 0:t.setFocus()}connectedCallback(){super.connectedCallback(),this.connectObserver(),this.willPerformFilter=!0,this.updateListItems(),this.setUpSorting(),this.setParentList(),this.setListItemGroups()}async load(){this.handleInteractionModeWarning()}willUpdate(e){(e.has("filterText")||e.has("filterProps")||e.has("filterPredicate"))&&this.performFilter(),(e.has("filterEnabled")&&(this.hasUpdated||this.filterEnabled!==!1)||e.has("group")||e.has("dragEnabled")&&(this.hasUpdated||this.dragEnabled!==!1)||e.has("selectionMode")&&(this.hasUpdated||this.selectionMode!=="none")||e.has("selectionAppearance")&&(this.hasUpdated||this.selectionAppearance!=="icon")||e.has("displayMode")&&this.hasUpdated||e.has("scale")&&this.hasUpdated||e.has("filterPredicate")&&this.hasUpdated)&&this.handleListItemChange()}updated(){k(this)}disconnectedCallback(){super.disconnectedCallback(),this.disconnectObserver(),z(this)}handleListItemChange(){this.willPerformFilter=!0,this.updateListItems()}handleCalciteListItemToggle(e){this.parentListEl||(e.stopPropagation(),this.borderItems())}handleCalciteInternalFocusPreviousItem(e){if(this.parentListEl)return;e.stopPropagation();const{focusableItems:t}=this,s=t.findIndex(a=>a.active)-1;t[s]&&this.focusRow(t[s])}handleCalciteInternalListItemActive(e){if(this.parentListEl)return;e.stopPropagation();const t=e.target,{listItems:i}=this;i.forEach(s=>{s.active=s===t})}handleCalciteListItemSelect(){this.parentListEl||this.updateSelectedItems(!0)}handleCalciteInternalAssistiveTextChange(e){this.assistiveText=e.detail.message,e.stopPropagation()}handleSortReorder(e){this.parentListEl||e.defaultPrevented||(e.preventDefault(),this.handleReorder(e))}handleSortMove(e){this.parentListEl||e.defaultPrevented||(e.preventDefault(),this.handleMove(e))}handleCalciteInternalListItemSelect(e){if(this.parentListEl)return;e.stopPropagation();const t=e.target,{listItems:i,selectionMode:s}=this;t.selected&&(s==="single"||s==="single-persist")&&i.forEach(a=>a.selected=a===t),this.updateSelectedItems()}handleCalciteInternalListItemSelectMultiple(e){if(this.parentListEl)return;e.stopPropagation();const{target:t,detail:i}=e,{focusableItems:s,lastSelectedInfo:a}=this,l=t;if(i.selectMultiple&&a){const r=s.indexOf(l),n=s.indexOf(a.selectedItem),c=Math.min(n,r),d=Math.max(n,r);s.slice(c,d+1).forEach(o=>o.selected=a.selected)}else this.lastSelectedInfo={selectedItem:l,selected:l.selected}}handleCalciteInternalListItemChange(e){this.parentListEl||(e.stopPropagation(),this.updateListItems())}handleCalciteInternalListItemGroupDefaultSlotChange(e){e.stopPropagation()}connectObserver(){var e;(e=this.mutationObserver)==null||e.observe(this.el,{childList:!0,subtree:!0})}disconnectObserver(){var e;(e=this.mutationObserver)==null||e.disconnect()}setUpSorting(){const{dragEnabled:e,defaultSlotEl:t}=this;e&&(t&&U(t),B(this))}onGlobalDragStart(){this.disconnectObserver()}onGlobalDragEnd(){this.connectObserver()}onDragEnd(e){this.calciteListDragEnd.emit(e)}onDragStart(e){e.dragEl.sortHandleOpen=!1,this.calciteListDragStart.emit(e)}onDragSort(e){this.setParentList(),this.updateListItems(),this.calciteListOrderChange.emit(e)}setParentList(){var e;this.parentListEl=(e=this.el.parentElement)==null?void 0:e.closest(v)}handleDefaultSlotChange(){this.parentListEl&&this.calciteInternalListDefaultSlotChange.emit()}setListItemGroups(){this.listItemGroups=Array.from(this.el.querySelectorAll(L))}handleFilterActionsStartSlotChange(e){this.hasFilterActionsStart=b(e)}handleFilterActionsEndSlotChange(e){this.hasFilterActionsEnd=b(e)}handleFilterNoResultsSlotChange(e){this.hasFilterNoResults=b(e)}setActiveListItem(){const{focusableItems:e}=this;e.some(t=>t.active)||e[0]&&(e[0].active=!0)}async updateSelectedItems(e=!1){await this.updateComplete,this.selectedItems=this.visibleItems.filter(t=>t.selected),e&&this.calciteListChange.emit()}filterElements({el:e,filteredItems:t,visibleParents:i}){const s=!i.has(e)&&!t.includes(e);e.filterHidden=s;const a=e.parentElement.closest(K);a&&(s||i.add(a),this.filterElements({el:a,filteredItems:t,visibleParents:i}))}allParentListItemsExpanded(e){var i;const t=(i=e.parentElement)==null?void 0:i.closest(m);if(t){if(!t.expanded)return!1}else return!0;return this.allParentListItemsExpanded(t)}borderItems(){const e=this.visibleItems.filter(t=>!t.filterHidden&&this.allParentListItemsExpanded(t));e.forEach(t=>t.bordered=t!==e[e.length-1])}updateFilteredItems(){const{visibleItems:e,filteredData:t,filterText:i,filterPredicate:s}=this,a=e==null?void 0:e.filter(n=>e.every(c=>c===n||!n.contains(c))),l=s?e.filter(s):i?t.map(n=>n.el):e||[],r=new WeakSet;a.forEach(n=>this.filterElements({el:n,filteredItems:l,visibleParents:r})),this.filteredItems=l,this.willFilterEmit&&(this.willFilterEmit=!1,this.calciteListFilter.emit())}updateFilteredData(){const{filterEl:e}=this;e&&(e.filteredItems&&(this.filteredData=e.filteredItems),this.updateListItems())}async filterAndUpdateData(){var e;await((e=this.filterEl)==null?void 0:e.filter(this.filterText)),this.updateFilteredData()}get effectiveFilterProps(){return this.filterProps?this.filterProps.filter(e=>e!=="el"):["description","label","metadata","heading"]}performFilter(){const{filterEl:e,filterText:t,effectiveFilterProps:i}=this;e&&(e.value=t,e.filterProps=i,this.filterAndUpdateData())}setDefaultSlotEl(e){this.defaultSlotEl=e}setFilterEl(e){this.filterEl=e,this.performFilter()}handleFilterChange(e){e.stopPropagation();const{value:t}=e.currentTarget;this.filterText=t,this.willFilterEmit=!0,this.updateFilteredData()}getItemData(){return this.listItems.map(e=>({label:e.label,description:e.description,metadata:e.metadata,heading:this.getGroupHeading(e),el:e}))}getGroupHeading(e){return this.listItemGroups.filter(i=>i.contains(e)).map(i=>i.heading)}updateGroupItems(){const{el:e,group:t,scale:i}=this,s=M(e),a=t?Array.from(s.querySelectorAll(`${v}[group="${t}"]`)).filter(r=>!r.disabled&&r.dragEnabled):[];this.moveToItems=a.map(r=>({element:r,label:r.label??r.id,id:T()})),Array.from(this.el.querySelectorAll(L)).forEach(r=>{r.scale=i})}focusRow(e){const{focusableItems:t}=this;e&&(t.forEach(i=>i.active=i===e),e.setFocus())}isNavigable(e){var i;const t=(i=e.parentElement)==null?void 0:i.closest(m);return t?t.expanded&&this.isNavigable(t):!0}handleListKeydown(e){var a;if(e.defaultPrevented||this.parentListEl)return;const{key:t}=e,i=this.focusableItems.filter(l=>this.isNavigable(l)),s=i.findIndex(l=>l.active);if(t==="ArrowDown"){e.preventDefault();const l=e.target===this.filterEl?0:s+1;i[l]&&this.focusRow(i[l])}else if(t==="ArrowUp"){if(e.preventDefault(),s===0&&this.filterEnabled){(a=this.filterEl)==null||a.setFocus();return}const l=s-1;i[l]&&this.focusRow(i[l])}else if(t==="Home"){e.preventDefault();const l=i[0];l&&this.focusRow(l)}else if(t==="End"){e.preventDefault();const l=i[i.length-1];l&&this.focusRow(l)}}handleInteractionModeWarning(){this.interactionMode==="static"&&this.selectionMode!=="none"&&this.selectionAppearance==="border"&&console.warn('selection-appearance="border" requires interaction-mode="interactive"')}handleMove(e){var c,d;const{moveTo:t}=e.detail,i=e.target,s=i==null?void 0:i.parentElement,a=t.element,r=Array.from(s.children).filter(C).indexOf(i),n=0;if(s){if(((c=s.canPull)==null?void 0:c.call(s,{toEl:a,fromEl:s,dragEl:i,newIndex:n,oldIndex:r}))===!1){this.calciteListMoveHalt.emit({toEl:a,fromEl:s,dragEl:i,oldIndex:r,newIndex:n});return}if(((d=a.canPut)==null?void 0:d.call(a,{toEl:a,fromEl:s,dragEl:i,newIndex:n,oldIndex:r}))===!1){a.putFailed({toEl:a,fromEl:s,dragEl:i,oldIndex:r,newIndex:n});return}i.sortHandleOpen=!1,this.disconnectObserver(),a.prepend(i),G(i),this.updateListItems(),this.connectObserver(),this.calciteListOrderChange.emit({dragEl:i,fromEl:s,toEl:a,newIndex:n,oldIndex:r})}}handleReorder(e){const{reorder:t}=e.detail,i=e.target,s=i==null?void 0:i.parentElement;if(!s)return;i.sortHandleOpen=!1;const a=Array.from(s.children).filter(C),l=a.length-1,r=a.indexOf(i);let n=r;switch(t){case"top":n=0;break;case"bottom":n=l;break;case"up":n=r===0?0:r-1;break;case"down":n=r===l?l:r+1;break}this.disconnectObserver();const c=t==="up"||t==="top"?a[n]:a[n].nextSibling;s.insertBefore(i,c),this.updateListItems(),this.connectObserver(),this.calciteListOrderChange.emit({dragEl:i,fromEl:s,toEl:s,newIndex:n,oldIndex:r})}render(){const{loading:e,label:t,disabled:i,dataForFilter:s,filterEnabled:a,filterPlaceholder:l,filterText:r,filterLabel:n,hasFilterActionsStart:c,hasFilterActionsEnd:d,effectiveFilterProps:o}=this;return O({disabled:this.disabled,children:h`<div class=${f(u.container)}>${this.dragEnabled?h`<span aria-live=assertive class=${f(u.assistiveText)}>${this.assistiveText}</span>`:null}${this.renderItemAriaLive()}${e?h`<calcite-scrim class=${f(u.scrim)} .loading=${e}></calcite-scrim>`:null}<div .ariaBusy=${e} .ariaLabel=${t||""} class=${f(u.table)} @keydown=${this.handleListKeydown} role=treegrid>${a||c||d?h`<div class=${f(u.sticky)} role=rowgroup><div role=row><div role=columnheader><calcite-stack class=${f(u.stack)}><slot name=${E.filterActionsStart} @slotchange=${this.handleFilterActionsStartSlotChange} slot=${A.actionsStart}></slot><calcite-filter .ariaLabel=${l} .disabled=${i} .filterProps=${o} .items=${s} .label=${n} @calciteFilterChange=${this.handleFilterChange} .placeholder=${l} .scale=${this.scale} .value=${r} ${x(this.setFilterEl)}></calcite-filter><slot name=${E.filterActionsEnd} @slotchange=${this.handleFilterActionsEndSlotChange} slot=${A.actionsEnd}></slot></calcite-stack></div></div></div>`:null}<div class=${f(u.tableContainer)} role=rowgroup><slot @slotchange=${this.handleDefaultSlotChange} ${x(this.setDefaultSlotEl)}></slot></div></div><div aria-live=polite data-test-id=no-results-container .hidden=${!this.showNoResultsContainer}><slot name=${E.filterNoResults} @slotchange=${this.handleFilterNoResultsSlotChange}></slot></div></div>`})}renderItemAriaLive(){const{messages:e,filteredItems:t,parentListEl:i,messages:{_lang:s},numberingSystem:a}=this;return $.numberFormatOptions={locale:s,numberingSystem:a},i?null:h`<div aria-live=polite class=${f(u.assistiveText)}>${this.hasActiveFilter?g("aria-filter-enabled",h`<div>${e.filterEnabled}</div>`):null}${g("aria-item-count",h`<div>${e.total.replace("{count}",$.localize(t.length.toString()))}</div>`)}${t.length?g("aria-item-list",h`<ol>${t.map(l=>h`<li>${l.label}</li>`)}</ol>`):null}</div>`}};I.properties={assistiveText:[16,{},{state:!0}],dataForFilter:[16,{},{state:!0}],hasFilterActionsEnd:[16,{},{state:!0}],hasFilterActionsStart:[16,{},{state:!0}],hasFilterNoResults:[16,{},{state:!0}],moveToItems:[16,{},{state:!0}],hasActiveFilter:[16,{},{state:!0}],showNoResultsContainer:[16,{},{state:!0}],canPull:[0,{},{attribute:!1}],canPut:[0,{},{attribute:!1}],disabled:[7,{},{reflect:!0,type:Boolean}],dragEnabled:[7,{},{reflect:!0,type:Boolean}],filterEnabled:[7,{},{reflect:!0,type:Boolean}],filterPredicate:[0,{},{attribute:!1}],filterLabel:[3,{},{reflect:!0}],filterPlaceholder:[3,{},{reflect:!0}],filterProps:[0,{},{attribute:!1}],filterText:[3,{},{reflect:!0}],filteredData:[0,{},{attribute:!1}],filteredItems:[0,{},{attribute:!1}],group:[3,{},{reflect:!0}],interactionMode:[3,{},{reflect:!0}],label:1,loading:[7,{},{reflect:!0,type:Boolean}],messageOverrides:[0,{},{attribute:!1}],displayMode:[3,{},{reflect:!0}],numberingSystem:1,scale:[3,{},{reflect:!0}],selectedItems:[0,{},{attribute:!1}],selectionAppearance:[3,{},{reflect:!0}],selectionMode:[3,{},{reflect:!0}]},I.styles=W;let S=I;N("calcite-list",S);export{S as List};
