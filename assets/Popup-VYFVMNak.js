const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chartUtilsAm5-C94o9Q7L.js","assets/index-Bkom2Sdc.js","assets/index-CkucmIUh.css","assets/Root-i_sjdWOS.js","assets/Animation-CxUO0Jr-.js","assets/Percent-COgn7Xel.js","assets/Disposer-BLqPJqHQ.js","assets/Label-DXThgMCr.js","assets/Theme-B9_efM8T.js","assets/Tooltip-DsO4uRBd.js","assets/DefaultTheme-DkZXK6ea.js","assets/chartCommon-BCLg4ZGJ.js","assets/AnimatedTheme-MgBbLxnQ.js","assets/DarkTheme-DdbKyv4l.js","assets/ResponsiveTheme-n7racEDt.js","assets/ColorSet-Buzf3Sj9.js","assets/Scrollbar-1QEl2poz.js","assets/Button-Cvy7aQvK.js","assets/pieChart-CCXLtw0z.js","assets/Tick-BdqfPIqq.js","assets/Slice-Bpc_TI4p.js","assets/RadialLabel-DEKTmjBu.js","assets/xyChart-DZqEzPw1.js","assets/FeatureUtilityNetworkAssociationList-B73Ykyzc.js","assets/Heading-THbeZGao.js","assets/ReactiveSet-DY6kWTpY.js","assets/layerViewUtils-CKJQaxCu.js","assets/index-yqsEyyJ5.js","assets/index-Dx3YHB6R.js","assets/resources8-BgAEMfGy.js","assets/customElement-CC7CbDrX.js","assets/ExpandToggle-R92Hb7zh.js","assets/intersectsOperator-ConiyrJ4.js","assets/ProjectionTransformation-Bvt2x7E-.js","assets/Envelope2D-7paLNnHT.js","assets/Point2D-DVg-Qhcx.js","assets/Transformation2D-CNf0ySKF.js","assets/SimpleGeometryCursor-B92kdZ15.js","assets/OperatorDefinitions-DP7_WWTp.js","assets/jsonConverter-74r_fa1M.js","assets/OperatorIntersects-Q2JLMvPf.js","assets/apiConverter-C8FhisLI.js","assets/proximityOperator-BtaCys_s.js","assets/OperatorProximity-DZUGWvZs.js","assets/index-DDq8a8ZA.js"])))=>i.map(i=>d[i]);
import{kj as Rt,a$ as ht,m5 as H,fj as d,b8 as n,ba as o,bb as x,up as Ot,uq as pt,bE as h,f$ as F,ur as gt,pQ as mt,us as Dt,ko as et,lM as Nt,gV as Vt,ut as vt,fl as ae,md as z,uu as _t,aH as m,m9 as _e,oo as j,uv as St,uh as Bt,uw as Wt,t8 as ge,ux as ft,uy as wt,fA as yt,fz as bt,op as fe,na as ve,bS as Ge,hk as Mt,g8 as qe,on as Ft,uz as zt,uA as Ke,fx as Ht,fF as Fe,l5 as Ut,cn as It,pV as Ce,pU as Ct,pW as Xt,uB as Oe,uC as At,oq as jt,uD as Et,b4 as K,bf as te,fd as Xe,mp as Yt,uE as Zt,c7 as Gt,hN as qt,bD as Kt,gh as Qt,hP as Jt,iq as ei,pd as ti,bn as ii,os as tt,gf as si,aY as ni,uF as oi,uG as ri,uH as ai,gc as je,uI as Tt,ma as li,me as xt,ej as di}from"./index-Bkom2Sdc.js";import{s as Qe}from"./Heading-THbeZGao.js";import{t as ui}from"./ReactiveSet-DY6kWTpY.js";import{n as ci}from"./layerViewUtils-CKJQaxCu.js";function Ye(e){switch(e?.type){case"point":return e;case"extent":return e.center;case"polygon":{const t=Rt(e);return t?ht.fromJSON(t):null}case"multipoint":case"polyline":return e.extent?.center;default:return null}}const De="esri-feature-element-info",Ne={base:De,title:`${De}__title`,description:`${De}__description`};let q=class extends H{constructor(t,i){super(t,i),this.description=null,this.headingLevel=2,this.title=null}render(){return d("div",{class:Ne.base},this._renderTitle(),this._renderDescription())}_renderTitle(){const{title:t}=this;return t?d(Qe,{class:Ne.title,innerHTML:t,level:this.headingLevel}):null}_renderDescription(){const{description:t}=this;return t?d("div",{class:Ne.description,innerHTML:t,key:"description"}):null}};n([o()],q.prototype,"description",void 0),n([o()],q.prototype,"headingLevel",void 0),n([o()],q.prototype,"title",void 0),q=n([x("esri.widgets.Feature.support.FeatureElementInfo")],q);const hi={base:"esri-feature-attachments"};let G=class extends H{constructor(t,i){super(t,i),this._featureElementInfo=null,this.attachmentsWidget=new Ot,this.headingLevel=2,this.viewModel=new pt}initialize(){this._featureElementInfo=new q,this.addHandles([h(()=>[this.viewModel?.description,this.viewModel?.title,this.headingLevel],()=>this._setupFeatureElementInfo(),F),h(()=>this.viewModel,t=>this.attachmentsWidget.viewModel=t,F)])}destroy(){this.attachmentsWidget.viewModel=null,this.attachmentsWidget.destroy(),this._featureElementInfo?.destroy()}get description(){return this.viewModel.description}set description(t){this.viewModel.description=t}get displayType(){return this.attachmentsWidget.displayType}set displayType(t){this.attachmentsWidget.displayType=t}get graphic(){return this.viewModel.graphic}set graphic(t){this.viewModel.graphic=t}get title(){return this.viewModel.title}set title(t){this.viewModel.title=t}render(){const{attachmentsWidget:t}=this;return d("div",{class:hi.base},this._featureElementInfo?.render(),t?.render())}_setupFeatureElementInfo(){const{description:t,title:i,headingLevel:s}=this;this._featureElementInfo?.set({description:t,title:i,headingLevel:s})}};n([o({readOnly:!0})],G.prototype,"attachmentsWidget",void 0),n([o()],G.prototype,"description",null),n([o()],G.prototype,"displayType",null),n([o()],G.prototype,"graphic",null),n([o()],G.prototype,"headingLevel",void 0),n([o()],G.prototype,"title",null),n([o({type:pt})],G.prototype,"viewModel",void 0),G=n([x("esri.widgets.Feature.FeatureAttachments")],G);const Ve="esri-feature-content",Se={base:Ve,loaderContainer:`${Ve}__loader-container`,loader:`${Ve}__loader`};let ee=class extends H{constructor(t,i){super(t,i),this.viewModel=null,this._addTargetToAnchors=s=>{Array.from(s.querySelectorAll("a")).forEach(r=>{gt(r.href)&&!r.hasAttribute("target")&&r.setAttribute("target","_blank")})}}get creator(){return this.viewModel?.creator}set creator(t){this.viewModel&&(this.viewModel.creator=t)}get graphic(){return this.viewModel?.graphic}set graphic(t){this.viewModel&&(this.viewModel.graphic=t)}render(){const t=this.viewModel?.state;return d("div",{class:Se.base},t==="loading"?this._renderLoading():this._renderCreated())}_renderLoading(){return d("div",{class:Se.loaderContainer,key:"loader"},d("div",{class:Se.loader}))}_renderCreated(){const t=this.viewModel?.created;return t?t instanceof HTMLElement?d("div",{afterCreate:this._attachToNode,bind:t,key:t}):mt(t)?d("div",{key:t},!t.destroyed&&t.render()):d("div",{afterCreate:this._addTargetToAnchors,innerHTML:t,key:t}):null}_attachToNode(t){const i=this;t.appendChild(i)}};n([o()],ee.prototype,"creator",null),n([o()],ee.prototype,"graphic",null),n([o({type:Dt})],ee.prototype,"viewModel",void 0),ee=n([x("esri.widgets.Feature.FeatureContent")],ee);const pi=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function gi(e,t){if(typeof t!="string"||!t)return t;const i=pi.find(c=>c.pattern.test(t));if(!i)return t;const s=t.match(i.pattern),r=s?.[2],a=et(et(i.label,{messages:e,hierPart:r}),{appName:i.appName}),l=i.target?` target="${i.target}"`:"",u=i.target==="_blank"?' rel="noreferrer"':"";return Nt.sanitizeUrl(Vt(t)).replace(i.pattern,`<a${l} href="$1"${u}>${a}</a>`)}const Ae="esri-feature-fields",Ee={base:Ae,fieldHeader:`${Ae}__field-header`,fieldData:`${Ae}__field-data`,fieldDataDate:`${Ae}__field-data--date`};let U=class extends H{constructor(t,i){super(t,i),this._featureElementInfo=null,this.viewModel=new vt,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new q,this.addHandles(h(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),F))}destroy(){this._featureElementInfo?.destroy()}get attributes(){return this.viewModel.attributes}set attributes(t){this.viewModel.attributes=t}get description(){return this.viewModel.description}set description(t){this.viewModel.description=t}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(t){this.viewModel.expressionInfos=t}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(t){this.viewModel.fieldInfos=t}get title(){return this.viewModel.title}set title(t){this.viewModel.title=t}render(){return d("div",{class:Ee.base},this._featureElementInfo?.render(),this._renderFields())}_renderFieldInfo(t,i){const{attributes:s}=this.viewModel,r=t.fieldName||"",a=t.label||r,l=s?s[r]==null?"":s[r]:"",u=t?.fieldFormat?.type==="date-time",c=typeof l=="number"&&!u?this._forceLTR(l):gi(this.messagesURIUtils,l),_={[Ee.fieldDataDate]:u};return d("tr",{key:`fields-element-info-row-${r}-${i}`},d("th",{class:Ee.fieldHeader,innerHTML:a,key:`fields-element-info-row-header-${r}-${i}`}),d("td",{class:this.classes(Ee.fieldData,_),innerHTML:c,key:`fields-element-info-row-data-${r}-${i}`}))}_renderFields(){const{formattedFieldInfos:t}=this.viewModel;return t?.length?d("table",{class:ae.table,summary:this.messages.fieldsSummary},d("tbody",null,t.map((i,s)=>this._renderFieldInfo(i,s)))):null}_setupFeatureElementInfo(){const{description:t,title:i}=this;this._featureElementInfo?.set({description:t,title:i})}_forceLTR(t){return`&lrm;${t}`}};n([o()],U.prototype,"attributes",null),n([o()],U.prototype,"description",null),n([o()],U.prototype,"expressionInfos",null),n([o()],U.prototype,"fieldInfos",null),n([o()],U.prototype,"title",null),n([o({type:vt,nonNullable:!0})],U.prototype,"viewModel",void 0),n([o(),z("esri/widgets/Feature/t9n/Feature")],U.prototype,"messages",void 0),n([o(),z("esri/widgets/support/t9n/uriUtils")],U.prototype,"messagesURIUtils",void 0),U=n([x("esri.widgets.Feature.FeatureFields")],U);const S="esri-feature-media",N={base:S,mediaContainer:`${S}__container`,mediaItemContainer:`${S}__item-container`,mediaItem:`${S}__item`,mediaItemText:`${S}__item-text`,mediaItemTitle:`${S}__item-title`,mediaItemCaption:`${S}__item-caption`,mediaNavigation:`${S}__item-navigation`,mediaPagination:`${S}__pagination`,mediaPaginationText:`${S}__pagination-text`,mediaChart:`${S}__chart`,mediaPaginationButton:`${S}__pagination-button`,mediaPaginationIcon:`${S}__pagination-icon`,mediaChartRendered:`${S}__chart--rendered`},Be=15,ie="category",be="value",mi="rgba(50, 50, 50, 1)",vi=250,_i=500,fi=200;let D=class extends H{constructor(e,t){super(e,t),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this._chartRootMap=new WeakMap,this.viewModel=new _t,this.messages=null,this._disposeChart=i=>{this._chartRootMap.get(i)?.dispose(),this._chartRootMap.delete(i)},this._createChart=async i=>{const{destroyed:s,viewModel:r}=this;if(s||!r||!i)return;const{createRoot:a}=await m(()=>import("./chartUtilsAm5-C94o9Q7L.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])),l=await a(i);this._chartRootMap.set(i,l),await this._renderChart({mediaInfo:r.activeMediaInfo,root:l})}}initialize(){this._featureElementInfo=new q,this.addHandles([h(()=>[this.viewModel?.activeMediaInfo,this.viewModel?.activeMediaInfoIndex],()=>this._setupMediaRefreshTimer(),F),h(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),F)])}loadDependencies(){return _e({icon:()=>m(()=>import("./index-Bkom2Sdc.js").then(e=>e.zv),__vite__mapDeps([1,2]))})}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo?.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(e){this.viewModel.activeMediaInfoIndex=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(e){this.viewModel.fieldInfoMap=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(e){this.viewModel.mediaInfos=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(e){this.viewModel.relatedInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){return d("div",{bind:this,class:N.base,onkeyup:this._handleMediaKeyup},this._featureElementInfo?.render(),this._renderMedia())}_renderMedia(){const{formattedMediaInfoCount:e,activeMediaInfoIndex:t}=this.viewModel,i=this._renderMediaText();return e?d("div",{class:N.mediaContainer,key:"media-element-container"},this._renderMediaInfo(),d("div",{class:N.mediaNavigation},i,e>1?d("div",{class:N.mediaPagination},this._renderMediaPageButton("previous"),d("span",{class:N.mediaPaginationText},j(this.messages.pageText,{index:t+1,total:e})),this._renderMediaPageButton("next")):null)):null}_renderMediaText(){const{activeMediaInfo:e}=this.viewModel;if(!e)return null;const t=e&&e.title?d("div",{class:N.mediaItemTitle,innerHTML:e.title,key:"media-title"}):null,i=e&&e.caption?d("div",{class:N.mediaItemCaption,innerHTML:e.caption,key:"media-caption"}):null;return t||i?d("div",{class:N.mediaItemText,key:"media-text"},t,i):null}_renderImageMediaInfo(e){if(!e.value)return null;const{_refreshIntervalInfo:t}=this,{activeMediaInfoIndex:i,formattedMediaInfoCount:s}=this.viewModel,{value:r,refreshInterval:a,altText:l,title:u,type:c}=e,{sourceURL:_,linkURL:v}=r,p=gt(v??void 0)?"_blank":"_self",w=p==="_blank"?"noreferrer":"",b=a?t:null,M=b?b.timestamp:0,A=b?b.sourceURL:_,L=d("img",{alt:l||u,key:`media-${c}-${i}-${s}-${M}`,src:A??void 0});return(v?d("a",{href:v,rel:w,target:p,title:u},L):null)??L}_renderChartMediaInfo(e){const{activeMediaInfoIndex:t,formattedMediaInfoCount:i}=this.viewModel;return d("div",{afterCreate:this._createChart,afterRemoved:this._disposeChart,bind:this,class:N.mediaChart,key:`media-${e.type}-${t}-${i}`})}_renderMediaInfoType(){const{activeMediaInfo:e}=this.viewModel;return e?e.type==="image"?this._renderImageMediaInfo(e):e.type.includes("chart")?this._renderChartMediaInfo(e):null:null}_renderMediaInfo(){const{activeMediaInfo:e}=this.viewModel;return e?d("div",{class:N.mediaItemContainer,key:"media-container"},d("div",{class:N.mediaItem,key:"media-item-container"},this._renderMediaInfoType())):null}_renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;const t=e==="previous",i=t?this.messages.previous:this.messages.next,s=t?"chevron-left":"chevron-right",r=t?"media-previous":"media-next",a=t?this._previous:this._next;return d("button",{"aria-label":i,bind:this,class:N.mediaPaginationButton,key:r,onclick:a,tabIndex:0,title:i,type:"button"},d("calcite-icon",{class:N.mediaPaginationIcon,icon:s,scale:"s"}))}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo?.set({description:e,title:t})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){if(!this.viewModel)return;const{graphic:e,layer:t}=this.viewModel;return e?.isAggregate&&t?.featureReduction&&"renderer"in t.featureReduction?t.featureReduction.renderer:t?.renderer}async _getSeriesColors(e){const{colorAm5:t}=await m(()=>import("./chartCommon-BCLg4ZGJ.js"),__vite__mapDeps([11,12,8,6,13,4,1,2,5,14,15,7,16,17,9])),i=new Map;return e.forEach(s=>{s.color&&i.set(s,t(s.color.toCss(!0)))}),i}async _getRendererColors(){const{colorAm5:e}=await m(()=>import("./chartCommon-BCLg4ZGJ.js"),__vite__mapDeps([11,12,8,6,13,4,1,2,5,14,15,7,16,17,9])),t=new Map,i=this._getRenderer(),s="default";if(!i)return t;const r=await St(i);return r.delete(s),Array.from(r.values()).every(a=>a?.length===1)&&Array.from(r.keys()).forEach(a=>{const l=r.get(a)?.[0]?.toCss(!0);l&&t.set(a,e(l))}),t}_handleMediaKeyup(e){const{key:t}=e;t==="ArrowLeft"&&(e.stopPropagation(),this.viewModel.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.viewModel.next())}_canAnimateChart(){return!!this.viewModel&&!!this.viewModel.abilities.chartAnimation&&!Bt()}_getChartAnimationMS(){return this._canAnimateChart()?vi:0}_getChartSeriesAnimationMS(){return this._canAnimateChart()?_i:0}async _renderChart(e){const{root:t,mediaInfo:i}=e,{value:s,type:r}=i,{ResponsiveThemeAm5:a,DarkThemeAm5:l,AnimatedThemeAm5:u,ColorSetAm5:c,ThemeAm5:_,esriChartColorSet:v}=await m(async()=>{const{ResponsiveThemeAm5:k,DarkThemeAm5:Q,AnimatedThemeAm5:Y,ColorSetAm5:le,ThemeAm5:de,esriChartColorSet:ue}=await import("./chartCommon-BCLg4ZGJ.js");return{ResponsiveThemeAm5:k,DarkThemeAm5:Q,AnimatedThemeAm5:Y,ColorSetAm5:le,ThemeAm5:de,esriChartColorSet:ue}},__vite__mapDeps([11,12,8,6,13,4,1,2,5,14,15,7,16,17,9])),p=_.new(t);p.rule("ColorSet").set("colors",v),p.rule("ColorSet").set("reuse",!0);const w=[a.new(t),p];Wt(this.container)&&w.push(l.new(t)),this._canAnimateChart()&&w.push(u.new(t)),t.setThemes(w);const b=await this._getRendererColors(),M=await this._getSeriesColors(s.series),A=c.new(t,{}),L=M.get(s.series[0]),R=L?{lineSettings:{stroke:L}}:void 0,$=s.series.map((k,Q)=>{const Y=M.get(k)||b.get(k.fieldName)||A.getIndex(Q);return{[ie]:k.tooltip,[be]:k.value,columnSettings:{fill:Y,stroke:Y},...R}}).filter(k=>r!=="pie-chart"||k.value!=null&&k.value>0);await(r==="pie-chart"?this._createPieChart(e,$):this._createXYChart(e,$))}_getDirection(){return ge(this.container)?"rtl":"ltr"}async _customizeChartTooltip(e,t="horizontal"){const{colorAm5:i}=await m(()=>import("./chartCommon-BCLg4ZGJ.js"),__vite__mapDeps([11,12,8,6,13,4,1,2,5,14,15,7,16,17,9]));e.setAll({pointerOrientation:t}),e.get("background")?.setAll({stroke:i(mi)}),e.label.setAll({direction:this._getDirection(),oversizedBehavior:"wrap",maxWidth:fi})}async _createPieChart(e,t){const{TooltipAm5:i}=await m(()=>import("./chartCommon-BCLg4ZGJ.js"),__vite__mapDeps([11,12,8,6,13,4,1,2,5,14,15,7,16,17,9])),{PieChartAm5:s,PieSeriesAm5:r}=await m(async()=>{const{PieChartAm5:M,PieSeriesAm5:A}=await import("./pieChart-CCXLtw0z.js").then(L=>L.p);return{PieChartAm5:M,PieSeriesAm5:A}},__vite__mapDeps([18,5,19,1,2,7,6,8,4,15,10,20,21])),{mediaInfo:a,root:l}=e,{title:u}=a,c=5,_=a?.altText||a?.title||"",v=l.container.children.push(s.new(l,{ariaLabel:_,focusable:!0,paddingBottom:c,paddingTop:c,paddingLeft:c,paddingRight:c})),p=`{category}: {valuePercentTotal.formatNumber('0.00')}%
 ({value})`,w=i.new(l,{labelText:p}),b=v.series.push(r.new(l,{name:u,valueField:be,categoryField:ie,tooltip:w}));b.ticks.template.set("forceHidden",!0),b.labels.template.set("forceHidden",!0),b.slices.template.states.create("active",{shiftRadius:c}),await this._customizeChartTooltip(w),b.slices.template.setAll({ariaLabel:p,focusable:!0,templateField:"columnSettings"}),b.data.setAll(t),await b.appear(this._getChartSeriesAnimationMS()),await v.appear(this._getChartAnimationMS()),v.root.dom.classList.toggle(N.mediaChartRendered,!0)}_getMinSeriesValue(e){let t=0;return e.forEach(i=>t=Math.min(i.value,t)),t}async _createColumnChart(e,t,i){const{TooltipAm5:s,ScrollbarAm5:r}=await m(()=>import("./chartCommon-BCLg4ZGJ.js"),__vite__mapDeps([11,12,8,6,13,4,1,2,5,14,15,7,16,17,9])),{CategoryAxisAm5:a,AxisRendererXAm5:l,ValueAxisAm5:u,AxisRendererYAm5:c,ColumnSeriesAm5:_}=await m(async()=>{const{CategoryAxisAm5:k,AxisRendererXAm5:Q,ValueAxisAm5:Y,AxisRendererYAm5:le,ColumnSeriesAm5:de}=await import("./xyChart-DZqEzPw1.js").then(ue=>ue.x);return{CategoryAxisAm5:k,AxisRendererXAm5:Q,ValueAxisAm5:Y,AxisRendererYAm5:le,ColumnSeriesAm5:de}},__vite__mapDeps([22,7,1,2,6,8,4,5,19,17,15,10])),{mediaInfo:v,root:p}=t,{value:w,title:b}=v;e.setAll({wheelX:"panX",wheelY:"zoomX"});const M=e.xAxes.push(a.new(p,{renderer:l.new(p,{inversed:ge(this.container)}),categoryField:ie}));M.get("renderer").labels.template.setAll({forceHidden:!0});const A=e.yAxes.push(u.new(p,{renderer:c.new(p,{inside:!1}),min:this._getMinSeriesValue(w.series)}));A.get("renderer").labels.template.setAll({direction:this._getDirection()});const L="{categoryX}",R=s.new(p,{labelText:L}),$=e.series.push(_.new(p,{name:b,xAxis:M,yAxis:A,valueYField:be,categoryXField:ie,tooltip:R}));await this._customizeChartTooltip(R),$.columns.template.setAll({ariaLabel:L,focusable:!0,templateField:"columnSettings"}),w.series.length>Be&&e.set("scrollbarX",r.new(p,{orientation:"horizontal"})),M.data.setAll(i),$.data.setAll(i),await $.appear(this._getChartSeriesAnimationMS()),await e.appear(this._getChartAnimationMS())}async _createBarChart(e,t,i){const{TooltipAm5:s,ScrollbarAm5:r}=await m(()=>import("./chartCommon-BCLg4ZGJ.js"),__vite__mapDeps([11,12,8,6,13,4,1,2,5,14,15,7,16,17,9])),{CategoryAxisAm5:a,AxisRendererXAm5:l,ValueAxisAm5:u,AxisRendererYAm5:c,ColumnSeriesAm5:_}=await m(async()=>{const{CategoryAxisAm5:k,AxisRendererXAm5:Q,ValueAxisAm5:Y,AxisRendererYAm5:le,ColumnSeriesAm5:de}=await import("./xyChart-DZqEzPw1.js").then(ue=>ue.x);return{CategoryAxisAm5:k,AxisRendererXAm5:Q,ValueAxisAm5:Y,AxisRendererYAm5:le,ColumnSeriesAm5:de}},__vite__mapDeps([22,7,1,2,6,8,4,5,19,17,15,10])),{mediaInfo:v,root:p}=t,{value:w,title:b}=v;e.setAll({wheelX:"panY",wheelY:"zoomY"});const M=e.yAxes.push(a.new(p,{renderer:c.new(p,{inversed:!0}),categoryField:ie}));M.get("renderer").labels.template.setAll({forceHidden:!0});const A=e.xAxes.push(u.new(p,{renderer:l.new(p,{inside:!1,inversed:ge(this.container)}),min:this._getMinSeriesValue(w.series)}));A.get("renderer").labels.template.setAll({direction:this._getDirection()});const L="{categoryY}",R=s.new(p,{labelText:L}),$=e.series.push(_.new(p,{name:b,xAxis:A,yAxis:M,valueXField:be,categoryYField:ie,tooltip:R}));await this._customizeChartTooltip(R,"vertical"),$.columns.template.setAll({ariaLabel:L,focusable:!0,templateField:"columnSettings"}),w.series.length>Be&&e.set("scrollbarY",r.new(p,{orientation:"vertical"})),M.data.setAll(i),$.data.setAll(i),await $.appear(this._getChartSeriesAnimationMS()),await e.appear(this._getChartAnimationMS())}async _createLineChart(e,t,i){const{TooltipAm5:s,ScrollbarAm5:r}=await m(()=>import("./chartCommon-BCLg4ZGJ.js"),__vite__mapDeps([11,12,8,6,13,4,1,2,5,14,15,7,16,17,9])),{CategoryAxisAm5:a,AxisRendererXAm5:l,ValueAxisAm5:u,AxisRendererYAm5:c,LineSeriesAm5:_}=await m(async()=>{const{CategoryAxisAm5:Q,AxisRendererXAm5:Y,ValueAxisAm5:le,AxisRendererYAm5:de,LineSeriesAm5:ue}=await import("./xyChart-DZqEzPw1.js").then(Pt=>Pt.x);return{CategoryAxisAm5:Q,AxisRendererXAm5:Y,ValueAxisAm5:le,AxisRendererYAm5:de,LineSeriesAm5:ue}},__vite__mapDeps([22,7,1,2,6,8,4,5,19,17,15,10])),{root:v,mediaInfo:p}=t,{value:w,title:b}=p;e.setAll({wheelX:"panX",wheelY:"zoomX"});const M=e.xAxes.push(a.new(v,{renderer:l.new(v,{inversed:ge(this.container)}),categoryField:ie}));M.get("renderer").labels.template.setAll({forceHidden:!0});const A=e.yAxes.push(u.new(v,{renderer:c.new(v,{inside:!1}),min:this._getMinSeriesValue(w.series)}));A.get("renderer").labels.template.setAll({direction:this._getDirection()});const L="{categoryX}",R=i[0]?.lineSettings?.stroke,$=s.new(v,{getFillFromSprite:!R,labelText:L});R&&$.get("background")?.setAll({fill:R});const k=e.series.push(_.new(v,{name:b,xAxis:M,yAxis:A,valueYField:be,categoryXField:ie,tooltip:$}));k.strokes.template.setAll({templateField:"lineSettings"}),await this._customizeChartTooltip($,"vertical"),w.series.length>Be&&e.set("scrollbarX",r.new(v,{orientation:"horizontal"})),M.data.setAll(i),k.data.setAll(i),await k.appear(this._getChartSeriesAnimationMS()),await e.appear(this._getChartAnimationMS())}async _createXYChart(e,t){const{XYChartAm5:i,XYCursorAm5:s}=await m(()=>import("./xyChart-DZqEzPw1.js").then(_=>_.x),__vite__mapDeps([22,7,1,2,6,8,4,5,19,17,15,10])),{root:r,mediaInfo:a}=e,{type:l}=a,u=a?.altText||a?.title||"",c=r.container.children.push(i.new(r,{ariaLabel:u,focusable:!0,panX:!0,panY:!0}));c.set("cursor",s.new(r,{})),l==="column-chart"&&await this._createColumnChart(c,e,t),l==="bar-chart"&&await this._createBarChart(c,e,t),l==="line-chart"&&await this._createLineChart(c,e,t),c.root.dom.classList.toggle(N.mediaChartRendered,!0)}_clearMediaRefreshTimer(){const{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){const t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:e&&this._getImageSource(e,t)}}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:e}=this.viewModel;e?.type==="image"&&e?.refreshInterval>0&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){const{refreshInterval:t,value:i}=e,s=6e4*t;this._updateMediaInfoTimestamp(i.sourceURL);const r=setInterval(()=>{this._updateMediaInfoTimestamp(i.sourceURL)},s);this._refreshTimer=r}_getImageSource(e,t){const i=e.includes("?")?"&":"?",[s,r=""]=e.split("#");return`${s}${i}timestamp=${t}${r?"#":""}${r}`}};n([o()],D.prototype,"_refreshIntervalInfo",void 0),n([o()],D.prototype,"attributes",null),n([o()],D.prototype,"activeMediaInfoIndex",null),n([o()],D.prototype,"description",null),n([o()],D.prototype,"fieldInfoMap",null),n([o()],D.prototype,"layer",null),n([o()],D.prototype,"mediaInfos",null),n([o()],D.prototype,"popupTemplate",null),n([o()],D.prototype,"relatedInfos",null),n([o()],D.prototype,"title",null),n([o({type:_t})],D.prototype,"viewModel",void 0),n([o(),z("esri/widgets/Feature/t9n/Feature")],D.prototype,"messages",void 0),D=n([x("esri.widgets.Feature.FeatureMedia")],D);const it="esri-feature",st={base:`${it}-expression`,loadingSpinnerContainer:`${it}__loading-container`};let Le=class extends H{constructor(t,i){super(t,i),this._contentWidget=null,this.viewModel=new ft}initialize(){this.addHandles(h(()=>this.viewModel?.contentElementViewModel,()=>this._setupExpressionWidget(),F))}loadDependencies(){return _e({loader:()=>m(()=>import("./index-Bkom2Sdc.js").then(t=>t.zI),__vite__mapDeps([1,2]))})}destroy(){this._destroyContentWidget()}render(){const{state:t}=this.viewModel;return d("div",{class:st.base},t==="loading"?this._renderLoading():t==="disabled"?null:this._contentWidget?.render())}_renderLoading(){return d("div",{class:st.loadingSpinnerContainer,key:"loading-container"},d("calcite-loader",{inline:!0,label:""}))}_destroyContentWidget(){const{_contentWidget:t}=this;t&&(t.viewModel=null,t.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:t,contentElement:i}=this.viewModel,s=i?.type;this._destroyContentWidget();const r=t?s==="fields"?new U({viewModel:t}):s==="media"?new D({viewModel:t}):s==="text"?new ee({viewModel:t}):null:null;this._contentWidget=r,this.scheduleRender()}};n([o({type:ft})],Le.prototype,"viewModel",void 0),Le=n([x("esri.widgets.Feature.FeatureExpression")],Le);var ke;const $e="esri-feature",Me=`${$e}-relationship`,J={base:Me,listContainer:`${Me}__list`,listItem:`${Me}__list-item`,listItemHidden:`${Me}__list-item--hidden`,listContainerQuerying:`${Me}__list--querying`,featureObserver:`${$e}__feature-observer`,stickySpinnerContainer:`${$e}__sticky-loading-container`,loadingSpinnerContainer:`${$e}__loading-container`},nt={title:!0,description:!0};let P=ke=class extends H{constructor(e,t){super(e,t),this._featureElementInfo=null,this._relatedFeatureIntersectionObserverNode=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver(([i])=>{i?.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this.flowItems=null,this.flowType="feature-relationship",this.headingLevel=2,this.viewModel=new wt,this.messages=null,this.messagesCommon=null,this.visibleElements={...nt},this._increaseFeaturePage=()=>{const{state:i,showAllEnabled:s,relatedFeatures:r,featuresPerPage:a,featurePage:l}=this.viewModel;i==="ready"&&s&&r.length>=a*l&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new q,this.addHandles([h(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),F),h(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),yt(()=>this.viewModel.relatedFeatureViewModels,"change",()=>this._setupRelatedFeatureViewModels())])}loadDependencies(){return _e({chip:()=>m(()=>import("./index-Bkom2Sdc.js").then(e=>e.zw),__vite__mapDeps([1,2])),icon:()=>m(()=>import("./index-Bkom2Sdc.js").then(e=>e.zv),__vite__mapDeps([1,2])),list:()=>m(()=>import("./index-Bkom2Sdc.js").then(e=>e.zL),__vite__mapDeps([1,2])),"list-item":()=>m(()=>import("./index-Bkom2Sdc.js").then(e=>e.zV),__vite__mapDeps([1,2])),loader:()=>m(()=>import("./index-Bkom2Sdc.js").then(e=>e.zI),__vite__mapDeps([1,2])),notice:()=>m(()=>import("./index-Bkom2Sdc.js").then(e=>e.zM),__vite__mapDeps([1,2]))})}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=bt(this._featureElementInfo)}get displayShowAllButton(){const{showAllEnabled:e,featureCount:t,displayCount:i,state:s,allCategoriesCount:r}=this.viewModel;return!e&&s==="ready"&&(!!r&&(r>i||i===0)||!!t&&(t>i||i===0))}get displayListItems(){const{relatedFeatureViewModels:e,allCategoriesCount:t}=this.viewModel;return this.displayShowAllButton||!!e.length||!!t}get allItemsDescription(){const{messages:e}=this,{featureCount:t,allCategories:i,allCategoriesCount:s}=this.viewModel;return j(e?.numberRecords,{number:fe(i?s:t)})}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get title(){const{activeCategory:e,title:t}=this.viewModel;return e?.name??t}set title(e){this.viewModel.title=e}castVisibleElements(e){return{...nt,...e}}render(){const{state:e}=this.viewModel;return d("div",{class:this.classes(J.base,ae.widget)},this._featureElementInfo?.render(),e==="loading"?this._renderLoading():e==="disabled"?this._renderRelationshipNotFound():this._renderRelatedFeatures())}_selectCategory(e){const{flowItems:t,featureVisibleElements:i,viewModel:s}=this;t&&(s.activeCategory=e,s.showAllEnabled=!0,t.push(new ke({flowItems:t,featureVisibleElements:i,visibleElements:{title:!1,description:!1},viewModel:s})))}async _selectRecord(e){const{flowItems:t,featureVisibleElements:i}=this;if(!t)return;e.abilities={relationshipContent:!0};const{default:s}=await m(()=>Promise.resolve().then(()=>wi),void 0);t.push(new s({flowItems:t,flowType:this.flowType,viewModel:e,visibleElements:i}))}_showAllRecords(){const{flowItems:e}=this;if(!e)return;const{viewModel:t,featureVisibleElements:i}=this;t.showAllEnabled=!0;const s=new ke({flowItems:e,featureVisibleElements:i,visibleElements:{title:!1,description:!1},viewModel:t});e.push(s)}_renderStickyLoading(){return this.viewModel.state==="querying"?d("div",{class:J.stickySpinnerContainer,key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoadingIcon(){return d("calcite-loader",{inline:!0,label:""})}_renderLoading(){return d("div",{class:J.loadingSpinnerContainer,key:"loading-container"},this._renderLoadingIcon())}_renderShowAllIconNode(){return d("calcite-icon",{icon:"list",scale:"s",slot:"content-end"})}_renderChevronIconNode(){const e=ge(this.container)?"chevron-left":"chevron-right";return d("calcite-icon",{icon:e,scale:"s",slot:"content-end"})}_renderCategory(e){const{count:t,name:i,value:s}=e,r=fe(t);return d("calcite-list-item",{class:J.listItem,disabled:!t,key:s,label:i,onCalciteListItemSelect:()=>this._selectCategory(e)},d("calcite-chip",{label:r,scale:"s",slot:"content-end"},r),this._renderChevronIconNode())}_renderRelatedFeature(e){const{itemDescriptionFieldName:t}=this.viewModel,i=e.title;e.description=t&&e.formattedAttributes?.global[t];const s=e.state==="loading";return d("calcite-list-item",{class:this.classes(J.listItem,{[J.listItemHidden]:s}),description:ve(e.description??""),key:e.uid,label:ve(i),onCalciteListItemSelect:()=>this._selectRecord(e)},this._renderChevronIconNode())}_renderShowAllListItem(){return this.displayShowAllButton?d("calcite-list-item",{description:this.allItemsDescription,key:"show-all-item",label:this.messages?.showAll,onCalciteListItemSelect:()=>this._showAllRecords()},this._renderShowAllIconNode()):null}_renderNoRelatedFeaturesMessage(){return d("calcite-notice",{icon:"information",key:"no-related-features-message",kind:"brand",open:!0,scale:"s",width:"full"},d("div",{slot:"message"},this.messages?.noRelatedFeatures))}_renderFeatureObserver(){return d("div",{afterCreate:this._relatedFeatureIntersectionObserverCreated,bind:this,class:J.featureObserver,key:"feature-observer"})}_renderList(){const{relatedFeatureViewModels:e,categories:t}=this.viewModel;return d("calcite-list",{displayMode:"flat",label:this.messages?.relatedFeaturesList},t?.map(i=>this._renderCategory(i))??e.toArray().map(i=>this._renderRelatedFeature(i)),this._renderShowAllListItem())}_renderRelatedFeatures(){const{displayListItems:e}=this,{state:t}=this.viewModel;return d("div",{class:this.classes(J.listContainer,{[J.listContainerQuerying]:t==="querying"}),key:"list-container"},e?this._renderList():t==="ready"?this._renderNoRelatedFeaturesMessage():null,this._renderStickyLoading(),this._renderFeatureObserver())}_renderRelationshipNotFound(){return d("calcite-notice",{icon:"exclamation-mark-triangle",key:"relationship-not-found",kind:"danger",open:!0,scale:"s",width:"full"},d("div",{slot:"message"},this.messages?.relationshipNotFound))}_setupRelatedFeatureViewModels(){const{relatedFeatureViewModels:e}=this.viewModel,t="related-feature-viewmodels";this.removeHandles(t),e?.forEach(i=>{this.addHandles(h(()=>[i.title,i.state],()=>this.scheduleRender(),F),t)}),this.scheduleRender()}_setupFeatureElementInfo(){const{headingLevel:e,visibleElements:t}=this,i=t.description&&this.description,s=t.title&&this.title;this._featureElementInfo?.set({description:i,title:s,headingLevel:e})}async _handleRelatedFeatureObserverChange(){this._unobserveRelatedFeatureObserver();const{state:e,showAllEnabled:t}=this.viewModel;await Ge(0),this._relatedFeatureIntersectionObserverNode&&e==="ready"&&t&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode)}_relatedFeatureIntersectionObserverCreated(e){this._relatedFeatureIntersectionObserverNode=e}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};n([o()],P.prototype,"_relatedFeatureIntersectionObserverNode",void 0),n([o({readOnly:!0})],P.prototype,"displayShowAllButton",null),n([o({readOnly:!0})],P.prototype,"displayListItems",null),n([o({readOnly:!0})],P.prototype,"allItemsDescription",null),n([o()],P.prototype,"description",null),n([o()],P.prototype,"featureVisibleElements",void 0),n([o()],P.prototype,"flowItems",void 0),n([o()],P.prototype,"flowType",void 0),n([o()],P.prototype,"headingLevel",void 0),n([o()],P.prototype,"title",null),n([o({type:wt})],P.prototype,"viewModel",void 0),n([o(),z("esri/widgets/Feature/t9n/Feature")],P.prototype,"messages",void 0),n([o(),z("esri/t9n/common")],P.prototype,"messagesCommon",void 0),n([o()],P.prototype,"visibleElements",void 0),n([Mt("visibleElements")],P.prototype,"castVisibleElements",null),P=ke=n([x("esri.widgets.Feature.FeatureRelationship")],P);let we=class extends qe{constructor(t){super(t),this.title=!0,this.description=!0}};n([o({type:Boolean,nonNullable:!0})],we.prototype,"title",void 0),n([o({type:Boolean,nonNullable:!0})],we.prototype,"description",void 0),we=n([x("esri.widgets.Feature.FeatureUtilityNetworkAssociations.VisibleElements")],we);const Ze="esri-feature-utility-network-associations",ot=`${Ze}__loading-container`,Te={base:Ze,listContainer:`${Ze}__list`,loadingContainer:ot,loadingContainerSticky:`${ot}--sticky`};let V=class extends H{constructor(t,i){super(t,i),this._featureElementInfo=null,this.onSelectAssociationType=()=>{},this.flowType="feature-utility-network-associations",this.flowItems=null,this.parentFeatureViewModel=null,this.headingLevel=5,this.viewModel=new Ft,this.messages=null,this.messagesCommon=null,this.visibleElements=new we}initialize(){this._featureElementInfo=new q,this.addHandles([h(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),F)])}loadDependencies(){return _e({icon:()=>m(()=>import("./index-Bkom2Sdc.js").then(t=>t.zv),__vite__mapDeps([1,2])),list:()=>m(()=>import("./index-Bkom2Sdc.js").then(t=>t.zL),__vite__mapDeps([1,2])),"list-item":()=>m(()=>import("./index-Bkom2Sdc.js").then(t=>t.zV),__vite__mapDeps([1,2])),loader:()=>m(()=>import("./index-Bkom2Sdc.js").then(t=>t.zI),__vite__mapDeps([1,2])),notice:()=>m(()=>import("./index-Bkom2Sdc.js").then(t=>t.zM),__vite__mapDeps([1,2]))})}destroy(){this._featureElementInfo=bt(this._featureElementInfo)}get description(){return this.viewModel.description}set description(t){this.viewModel.description=t}get title(){return this.viewModel.title}set title(t){this.viewModel.title=t}render(){const{state:t}=this.viewModel;return d("div",{class:this.classes(Te.base,ae.widget)},this._featureElementInfo?.render(),t==="loading"?this._renderLoading():t==="disabled"?this._renderAssociationNotFound():this._renderContent())}_renderStickyLoading(){return this.viewModel.state==="querying"?d("div",{class:Te.loadingContainerSticky,key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoadingIcon(){return d("calcite-loader",{inline:!0,label:this.messagesCommon.loading})}_renderLoading(){return d("div",{class:Te.loadingContainer,key:"loading-container"},this._renderLoadingIcon())}_renderAssociationNotFound(){return d("calcite-notice",{icon:"information",key:"association-not-found",kind:"info",open:!0,scale:"s",width:"full"},d("div",{slot:"message"},this.messages?.noAssociations))}_renderAssociationType(t){const{viewModel:i}=this,s=this._getAssociationTypeTitle(t);return d("calcite-list-item",{description:ve(t.description),key:`association-type-${t.type}`,label:ve(s),value:t.type,onCalciteListItemSelect:()=>this.onSelectAssociationType({viewModel:i,listType:t,title:s})},d("calcite-icon",{flipRtl:!0,icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderAssociations(t){const{viewModel:i}=this;return i.source==="featureForm"||i.getFeatureCountForAssociationType(t.type)>0?this._renderAssociationType(t):void 0}_renderContent(){const{messages:t,viewModel:i}=this,{state:s,associationTypes:r}=i;return d("div",{class:Te.listContainer,key:"list-container"},s==="ready"?d("div",null,d("calcite-list",{displayMode:"flat",label:t?.associationsList},r.map(a=>this._renderAssociations(a)))):null,this._renderStickyLoading())}_getAssociationTypeTitle(t){const{messages:i}=this;if(t.title)return t.title;switch(t.type){case"attachment":return i.associationsAttachments;case"connectivity":return i.associationsConnectivity;case"structure":return i.associationsStructure;case"content":return i.associationsContents;case"container":return i.associationsContainer}}_setupFeatureElementInfo(){const{headingLevel:t,visibleElements:i}=this,s=i.description&&this.description,r=i.title&&this.title;this._featureElementInfo?.set({description:s,title:r,headingLevel:t})}};n([o({constructOnly:!0})],V.prototype,"onSelectAssociationType",void 0),n([o()],V.prototype,"flowType",void 0),n([o()],V.prototype,"flowItems",void 0),n([o()],V.prototype,"parentFeatureViewModel",void 0),n([o()],V.prototype,"featureVisibleElements",void 0),n([o()],V.prototype,"description",null),n([o()],V.prototype,"headingLevel",void 0),n([o()],V.prototype,"title",null),n([o({type:Ft})],V.prototype,"viewModel",void 0),n([o(),z("esri/widgets/Feature/t9n/Feature")],V.prototype,"messages",void 0),n([o(),z("esri/t9n/common")],V.prototype,"messagesCommon",void 0),n([o({type:we,nonNullable:!0})],V.prototype,"visibleElements",void 0),V=n([x("esri.widgets.Feature.FeatureUtilityNetworkAssociations")],V);const Z="esri-feature",C={base:Z,container:`${Z}__size-container`,title:`${Z}__title`,main:`${Z}__main-container`,contentNode:`${Z}__content-node`,contentNodeText:`${Z}__content-node--text`,contentElement:`${Z}__content-element`,text:`${Z}__text`,lastEditedInfo:`${Z}__last-edited-info`,loadingSpinnerContainer:`${Z}__loading-container`},Lt=e=>{const t=e;let i=class extends t{constructor(){super(...arguments),this.renderNodeContent=s=>mt(s)&&!s.destroyed?d("div",{class:C.contentNode,key:s},s.render()):s instanceof HTMLElement?d("div",{afterCreate:this._attachToNode,bind:s,class:C.contentNode,key:s}):zt(s)?d("div",{afterCreate:this._attachToNode,bind:s.domNode,class:C.contentNode,key:s}):null}_attachToNode(s){const r=this;s.appendChild(r)}};return i=n([x("esri.widgets.Feature.support.FeatureContentMixin")],i),i},rt={title:!0,content:!0,lastEditedInfo:!0};let I=class extends Lt(H){constructor(e,t){super(e,t),this._contentWidgets=[],this.flowType="feature",this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.visibleElements={...rt},this.viewModel=new Ke}initialize(){this.addHandles(h(()=>this.viewModel?.contentViewModels,()=>this._setupContentWidgets(),F))}loadDependencies(){return _e({notice:()=>m(()=>import("./index-Bkom2Sdc.js").then(e=>e.zM),__vite__mapDeps([1,2])),loader:()=>m(()=>import("./index-Bkom2Sdc.js").then(e=>e.zI),__vite__mapDeps([1,2]))})}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(e){this.viewModel.defaultPopupTemplateEnabled=e}get isTable(){return this.viewModel.isFeatureFromTable}get icon(){return"polygon"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get title(){return this.viewModel.title}castVisibleElements(e){return{...rt,...e}}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}setActiveMedia(e,t){return this.viewModel.setActiveMedia(e,t)}nextMedia(e){return this.viewModel.nextMedia(e)}previousMedia(e){return this.viewModel.previousMedia(e)}render(){const{state:e}=this.viewModel,t=d("div",{class:C.container,key:"container"},this._renderTitle(),e==="error"?this._renderError():e==="loading"?this._renderLoading():this._renderContentContainer());return d("div",{class:this.classes(C.base,ae.widget)},t)}_renderError(){const{messagesCommon:e,messages:t,visibleElements:i}=this;return d("calcite-notice",{icon:"exclamation-mark-circle",kind:"danger",open:!0,scale:"s"},i.title?d("div",{key:"error-title",slot:"title"},e.errorMessage):null,d("div",{key:"error-message",slot:"message"},t.loadingError))}_renderLoading(){return d("div",{class:C.loadingSpinnerContainer,key:"loading-container"},d("calcite-loader",{inline:!0,label:""}))}_renderContentContainer(){const{visibleElements:e}=this;return e.content?d("div",{class:C.main},[this._renderContent(),this._renderLastEditInfo()]):null}_renderTitle(){const{visibleElements:e,title:t}=this;return e.title?d(Qe,{class:C.title,innerHTML:t,level:this.headingLevel}):null}_renderContent(){const e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?d("div",{class:C.contentNode,key:`${t}-content-elements`},e.map(this._renderContentElement,this)):null;if(typeof e=="string"){const i=this._contentWidgets[0];return!i||i.destroyed?null:d("div",{class:this.classes(C.contentNode,C.contentNodeText),key:`${t}-content`},i.render())}return this.renderNodeContent(e)}_renderContentElement(e,t){const{visibleElements:i}=this;if(typeof i.content!="boolean"&&!i.content?.[e.type])return null;switch(e.type){case"attachments":return this._renderAttachments(t);case"custom":return this._renderCustom(e,t);case"fields":return this._renderFields(t);case"media":return this._renderMedia(t);case"text":return this._renderText(e,t);case"expression":return this._renderExpression(t);case"relationship":return this._renderRelationship(t);case"utility-network-associations":return this._renderAssociation(t);default:return null}}_renderAttachments(e){const t=this._contentWidgets[e];if(!t||t.destroyed)return null;const{state:i,attachmentInfos:s}=t.viewModel;return i==="loading"||s.length>0?d("div",{class:this.classes(C.contentElement),key:this._buildKey("attachments-element",e)},t.render()):null}_renderRelationship(e){const t=this._contentWidgets[e];return t&&!t.destroyed&&this.flowItems?d("div",{class:C.contentElement,key:this._buildKey("relationship-element",e)},t.render()):null}_renderAssociation(e){const t=this._contentWidgets[e];return t&&!t.destroyed&&this.flowItems?d("div",{class:C.contentElement,key:this._buildKey("utility-network-association-element",e)},t.render()):null}_renderExpression(e){const t=this._contentWidgets[e];return t&&!t.destroyed&&t.viewModel.contentElement?d("div",{class:C.contentElement,key:this._buildKey("expression-element",e)},t.render()):null}_renderCustom(e,t){const{creator:i}=e,s=this._contentWidgets[t];return!s||s.destroyed?null:i?d("div",{class:C.contentElement,key:this._buildKey("custom-element",t)},s.render()):null}_renderFields(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:d("div",{class:C.contentElement,key:this._buildKey("fields-element",e)},t.render())}_renderMedia(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:d("div",{class:C.contentElement,key:this._buildKey("media-element",e)},t.render())}_renderLastEditInfo(){const{visibleElements:e,messages:t}=this,{lastEditInfo:i}=this.viewModel;if(!i||!e.lastEditedInfo)return null;const{date:s,user:r}=i,a=i.type==="edit"?r?t.lastEditedByUser:t.lastEdited:r?t.lastCreatedByUser:t.lastCreated,l=j(a,{date:s,user:r});return d("div",{class:this.classes(C.lastEditedInfo,C.contentElement),key:"edit-info-element"},l)}_renderText(e,t){const i=e.text,s=this._contentWidgets[t];return!s||s.destroyed?null:i?d("div",{class:this.classes(C.contentElement,C.text),key:this._buildKey("text-element",t)},s.render()):null}_buildKey(e,...t){return`${e}__${this.viewModel?.graphic?.uid||"0"}-${t.join("-")}`}_destroyContentWidget(e){e&&(e.viewModel=null,!e.destroyed&&e.destroy())}_destroyContentWidgets(){this._contentWidgets.forEach(e=>this._destroyContentWidget(e)),this._contentWidgets=[]}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:e,visibleElements:t,flowItems:i,viewModel:s}=this,r=s?.content,{contentViewModels:a}=s;if(Array.isArray(r))r.forEach((l,u)=>{if(l.type==="attachments"&&(this._contentWidgets[u]=new G({displayType:l.displayType,headingLevel:t.title&&e<6?e+1:e,viewModel:a[u]})),l.type==="fields"&&(this._contentWidgets[u]=new U({viewModel:a[u]})),l.type==="media"&&(this._contentWidgets[u]=new D({viewModel:a[u]})),l.type==="text"&&(this._contentWidgets[u]=new ee({viewModel:a[u]})),l.type==="custom"&&(this._contentWidgets[u]=new ee({viewModel:a[u]})),l.type==="expression"&&(this._contentWidgets[u]=new Le({viewModel:a[u]})),l.type==="relationship"){const c=new P({flowItems:i,featureVisibleElements:t,viewModel:a[u]});this._contentWidgets[u]=c}if(l.type==="utility-network-associations"){const c=async v=>{const{viewModel:p,listType:w,title:b}=v;if(!i)return;p.activeAssociationType=w;const{default:M}=await m(()=>import("./FeatureUtilityNetworkAssociationList-B73Ykyzc.js"),__vite__mapDeps([23,1,2,24,25,26])),A=new M({viewModel:p,parentFeatureViewModel:s,listType:w,title:b,featureVisibleElements:t,description:s.title,flowItems:i});i.push(A)},_=new V({flowItems:i,onSelectAssociationType:c,parentFeatureViewModel:s,featureVisibleElements:t,viewModel:a[u]});this._contentWidgets[u]=_}},this);else{const l=a[0];l&&!l.destroyed&&(this._contentWidgets[0]=new ee({viewModel:l}))}this.scheduleRender()}};n([o()],I.prototype,"flowType",void 0),n([o()],I.prototype,"graphic",null),n([o()],I.prototype,"defaultPopupTemplateEnabled",null),n([o()],I.prototype,"flowItems",void 0),n([o()],I.prototype,"headingLevel",void 0),n([o({readOnly:!0})],I.prototype,"isTable",null),n([o()],I.prototype,"icon",null),n([o()],I.prototype,"label",null),n([o()],I.prototype,"location",null),n([o(),z("esri/widgets/Feature/t9n/Feature")],I.prototype,"messages",void 0),n([o(),z("esri/t9n/common")],I.prototype,"messagesCommon",void 0),n([o()],I.prototype,"spatialReference",null),n([o()],I.prototype,"timeZone",null),n([o({readOnly:!0})],I.prototype,"title",null),n([o()],I.prototype,"visibleElements",void 0),n([Mt("visibleElements")],I.prototype,"castVisibleElements",null),n([o()],I.prototype,"map",null),n([o()],I.prototype,"view",null),n([o({type:Ke})],I.prototype,"viewModel",void 0),I=n([x("esri.widgets.Feature")],I);const wi=Object.freeze(Object.defineProperty({__proto__:null,get default(){return I}},Symbol.toStringTag,{value:"Module"}));let ne=class extends Ht{constructor(t){super(t),this.location=null,this.screenLocationEnabled=!1,this.view=null,this.addHandles([Fe(()=>{const i=this.screenLocationEnabled?this.view:null;return i?[i.size,i.type==="3d"?i.camera:i.viewpoint]:null},()=>this.notifyChange("screenLocation")),h(()=>this.screenLocation,(i,s)=>{i!=null&&s!=null&&this.emit("view-change")})])}destroy(){this.view=null}get screenLocation(){const{location:t,view:i,screenLocationEnabled:s}=this,r=i?.spatialReference,a=r?Ut(t,r).geometry:null;return s&&a&&i?.ready?i.toScreen(a):null}};n([o()],ne.prototype,"location",void 0),n([o()],ne.prototype,"screenLocation",null),n([o()],ne.prototype,"screenLocationEnabled",void 0),n([o()],ne.prototype,"view",void 0),ne=n([x("esri.widgets.support.AnchorElementViewModel")],ne);let Ie=class extends ne{constructor(t){super(t),this.visible=!1}};n([o()],Ie.prototype,"visible",void 0),Ie=n([x("esri.widgets.Spinner.SpinnerViewModel")],Ie);const We="esri-spinner",ze={base:We,spinnerStart:`${We}--start`,spinnerFinish:`${We}--finish`};let he=class extends H{constructor(t,i){super(t,i),this._animationDelay=500,this._animationPromise=null,this.viewModel=new Ie}initialize(){this.addHandles(h(()=>this.visible,t=>this._visibleChange(t)))}destroy(){this._animationPromise=null}get location(){return this.viewModel.location}set location(t){this.viewModel.location=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}get visible(){return this.viewModel.visible}set visible(t){this.viewModel.visible=t}show(t){const{location:i,promise:s}=t??{};i&&(this.viewModel.location=i),this.visible=!0;const r=()=>this.hide();s?.catch(()=>{}).then(r)}hide(){this.visible=!1}render(){const{visible:t}=this,{screenLocation:i}=this.viewModel,s=!!i,r=t&&s,a=!t&&s,l={[ze.spinnerStart]:r,[ze.spinnerFinish]:a},u=this._getPositionStyles();return d("div",{class:this.classes(ze.base,l),styles:u})}_visibleChange(t){if(t)return void(this.viewModel.screenLocationEnabled=!0);const i=Ge(this._animationDelay);this._animationPromise=i,i.catch(()=>{}).then(()=>{this._animationPromise===i&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){const{screenLocation:t,view:i}=this.viewModel;if(i==null||t==null)return{};const{padding:s}=i;return{left:t.x-s.left+"px",top:t.y-s.top+"px"}}};n([o()],he.prototype,"location",null),n([o()],he.prototype,"view",null),n([o({type:Ie})],he.prototype,"viewModel",void 0),n([o()],he.prototype,"visible",null),he=n([x("esri.widgets.Spinner")],he);const O="esri-features",T={icon:`${O}__icon`,actionImage:`${O}__action-image`,base:O,container:`${O}__container`,contentContainer:`${O}__content-container`,contentFeature:`${O}__content-feature`,flowItemCollapsed:`${O}__flow-item--collapsed`,header:`${O}__header`,footer:`${O}__footer`,featureMenuObserver:`${O}__feature-menu-observer`,actionExit:`${O}__action--exit`,loader:`${O}__loader`,featuresHeading:`${O}__heading`,paginationText:`${O}__pagination-text`,paginationActionBar:`${O}__pagination-action-bar`,paginationMenuButton:`${O}__pagination-menu-button`,paginationPrevious:`${O}__pagination-previous`},me=It.ofType({key:"type",defaultKeyValue:"button",base:Xt,typeMap:{button:Ce,toggle:Ct}}),re=new Ce({icon:"magnifying-glass-plus",id:"zoom-to-feature",title:"{messages.zoom}",className:Oe.zoomInMagnifyingGlass}),at=new Ce({icon:"trash",id:"remove-selected-feature",title:"{messages.remove}",className:Oe.trash}),ye=new Ce({icon:"magnifying-glass-plus",id:"zoom-to-clustered-features",title:"{messages.zoom}",className:Oe.zoomInMagnifyingGlass}),oe=new Ct({icon:"table",id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:Oe.table,value:!1}),xe=re.clone();let se=class extends H{constructor(t,i){super(t,i),this.flowItems=null,this.messages=null,this.closed=!1,this.closable=!0,this.selectLastFlowItem=!0,this._handleOpenFeature=s=>{this.emit("open-feature",{feature:s})},this._handleZoomToFeature=s=>{this.emit("zoom-to-feature",{featureWidget:s})}}loadDependencies(){return Promise.all([At(),_e({action:()=>m(()=>import("./index-Bkom2Sdc.js").then(t=>t.zN),__vite__mapDeps([1,2])),"action-bar":()=>m(()=>import("./index-yqsEyyJ5.js"),__vite__mapDeps([27,1,2,28,29,30,31])),"action-group":()=>m(()=>import("./index-Dx3YHB6R.js").then(t=>t.i),__vite__mapDeps([28,1,2,29])),"flow-item":()=>m(()=>import("./index-Bkom2Sdc.js").then(t=>t.zO),__vite__mapDeps([1,2]))})])}render(){const{flowItems:t}=this,i=t?.toArray();return d(jt,null,i?.map((s,r)=>this._renderFlowItem(s,this.selectLastFlowItem&&r===i.length-1)))}_handleCloseClick(){this.emit("close")}_handleExitClick(){this.emit("exit")}_handleDrillInBackClick(){const{flowItems:t}=this,i=t?.pop();i&&("activeCategory"in i.viewModel?(i.viewModel.activeCategory=null,t?.length||(i.viewModel.showAllEnabled=!1)):"showAllEnabled"in i.viewModel&&(i.viewModel.showAllEnabled=!1),i&&(i.viewModel=null,i.destroy()))}_getExitMessage(t){switch(t.flowType){case"feature":case"feature-association":return"";case"feature-relationship":return this.messages.exitRelatedRecords;case"feature-utility-network-associations":case"feature-utility-network-association-type":return this.messages.exitAssociations}}_renderFlowItem(t,i){const{messages:s,closable:r,closed:a}=this,l="graphic"in t&&!t.isTable,u=t.flowType==="feature-association",c=this._getExitMessage(t),_=s.selectFeature;return d("calcite-flow-item",{bind:this,closable:r,closed:a,description:ve(this._getDrillInFlowItemDescription(t)??""),heading:ve(t.title??""),key:`flow-item-${t.viewModel.uid}`,selected:i,onCalciteFlowItemBack:v=>{v.preventDefault(),this._handleDrillInBackClick()},onCalciteFlowItemClose:this._handleCloseClick},d("calcite-action",{appearance:"transparent",bind:this,class:T.actionExit,icon:"move-up",key:"exit-action",onclick:this._handleExitClick,slot:"header-actions-start",text:c,title:c}),l?d("calcite-action",{appearance:"transparent",bind:this,icon:"zoom-to-object",key:"open-feature-action",onclick:()=>this._handleOpenFeature(t),slot:"header-actions-end",text:_,title:_}):null,u?d("calcite-action-bar",{expandDisabled:!0,expanded:!0,key:"header-action-bar",scale:"s",slot:"action-bar"},d("calcite-action-group",{overlayPositioning:"fixed",scale:"s"},Et(xe,{key:`action-${xe.uid}`,title:this._getActionTitle(xe),text:this._getActionTitle(xe),textEnabled:!0,onclick:()=>this._handleZoomToFeature(t),bind:this}))):null,d("div",{class:T.container},t.render()))}_getActionTitle(t){const{messages:i}=this,s=t.title??"";return t.id==="zoom-to-feature"?j(s,{messages:i}):s}_getDrillInFlowItemDescription(t){switch(t.flowType){case"feature":case"feature-association":case"feature-utility-network-associations":return t.viewModel.description??"";case"feature-relationship":return t.allItemsDescription;case"feature-utility-network-association-type":return t.description??""}}};n([o()],se.prototype,"flowItems",void 0),n([o(),z("esri/widgets/Features/t9n/Features")],se.prototype,"messages",void 0),n([o()],se.prototype,"closed",void 0),n([o()],se.prototype,"closable",void 0),n([o()],se.prototype,"selectLastFlowItem",void 0),se=n([x("esri.widgets.Features.FeaturesDrillIn")],se);const yi="OBJECTID",bi="esri.widgets.Popup.PopupViewModel",Pe=()=>te.getLogger(bi),Mi=e=>{const{event:t,view:i,viewModel:s}=e,{action:r}=t;if(!r)return Promise.reject(new K("trigger-action:missing-arguments","Event has no action"));const{disabled:a,id:l}=r;if(!l)return Promise.reject(new K("trigger-action:invalid-action","action.id is missing"));if(a)return Promise.reject(new K("trigger-action:invalid-action","Action is disabled"));if(l===re.id)return $t(s).catch(Yt);if(l===ye.id)return Ii(s);if(l===oe.id)return s.browseClusterEnabled=!s.browseClusterEnabled,s.featureMenuOpen=s.browseClusterEnabled,Promise.resolve();if(l===at.id){s.visible=!1;const{selectedFeature:u}=s;if(!u)return Promise.reject(new K(`trigger-action:${at.id}`,"selectedFeature is required",{selectedFeature:u}));const{sourceLayer:c}=u;return c?c.remove(u):i?.graphics.remove(u),Promise.resolve()}return Promise.resolve()};function kt(e){const{selectedFeature:t,location:i,view:s}=e;return s?t??i??null:null}function pe(e){return!!e&&e.isAggregate&&e.sourceLayer?.featureReduction?.type==="cluster"}async function Fi(e,t){if(t?.type!=="3d"||!e||e.declaredClass!=="esri.Graphic")return!0;const i=t.getViewForGraphic(e);if(i&&"whenGraphicBounds"in i){let s=null;try{s=await i.whenGraphicBounds(e,{useViewElevation:!0})}catch{}return!s||!s.boundingBox||s.boundingBox[0]===s.boundingBox[3]&&s.boundingBox[1]===s.boundingBox[4]&&s.boundingBox[2]===s.boundingBox[5]}return!0}async function $t(e,t){const{location:i,selectedFeature:s,view:r,zoomFactor:a}=e;await t?.viewModel?.updateGeometry();const l=t?.graphic,u=l?.geometry?l:kt(e);if(!r||!u){const p=new K("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:u,view:r});throw Pe().error(p),p}const c=r.scale/a,_=l?.geometry??e.selectedFeature?.geometry??i,v=_!=null&&_.type==="point"&&await Fi(l??s,r);re.active=!0,re.disabled=!0;try{await e.zoomTo({target:{target:u,scale:v?c:void 0}})}catch(p){if(Xe(p))return;const w=new K("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:l??s});Pe().error(w)}finally{re.active=!1,re.disabled=!1,e.zoomToLocation=null,v&&(e.location=_)}}async function Ii(e){const{selectedFeature:t,view:i}=e;if(i?.type!=="2d"){const l=new K("zoomToCluster:invalid-view","View must be 2d MapView.",{view:i});throw Pe().error(l),l}if(!t||!pe(t)){const l=new K("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw Pe().error(l),l}const[s,r]=await Je(i,t);ye.active=!0,ye.disabled=!0;const{extent:a}=await s.queryExtent(r);a&&await e.zoomTo({target:a}),ye.active=!1,ye.disabled=!1}async function Ci(e){const{view:t,selectedFeature:i}=e;if(!t||!i)return;const[s,r]=await Je(t,i),{extent:a}=await s.queryExtent(r);e.selectedClusterBoundaryFeature.geometry=a,t.graphics.add(e.selectedClusterBoundaryFeature)}async function Ai(e){const{selectedFeature:t,view:i}=e;if(!i||!t)return;const[s,r]=await Je(i,t);oe.active=!0,oe.disabled=!0;const{features:a}=await s.queryFeatures(r);oe.active=!1,oe.disabled=!1,oe.value=!0;const l={features:[t].concat(a)};e?.initialDisplayMode==="feature"&&(l.featureMenuOpen=!0),e?.open(l)}async function Je(e,t){const i=await e.whenLayerView(t.sourceLayer),s=i.createQuery(),r=t.getObjectId();return s.aggregateIds=r!=null?[r]:[],[i,s]}function Ei(e){oe.value=!1;const t=e.features.filter(i=>pe(i));t.length&&(e.features=t)}const He="location-scale-handle",Ti=()=>[re.clone()],xi=()=>[ye.clone(),oe.clone()];let Ue=null;function Li(e,t){return e==="building-scene"||e==="map-image"||e==="tile"||e==="imagery"||t==="2d"&&e==="imagery-tile"}let g=class extends Zt(ne){constructor(e){super(e),this._pendingPromises=new ui,this._fetchFeaturesController=null,this._highlightPromises={"highlight-active-feature":null,"highlight-selected-feature":null},this._selectedClusterFeature=null,this.actions=new me,this.activeFeature=null,this.autoCloseEnabled=!1,this.browseClusterEnabled=!1,this.content=null,this.defaultPopupTemplateEnabled=!1,this.featurePage=null,this.featuresPerPage=20,this.featureMenuOpen=!1,this.featureMenuTitle=null,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.initialDisplayMode="feature",this.selectedClusterBoundaryFeature=new Gt({symbol:new qt({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null,this._debouncedLocationUpdate=Kt(async t=>{const{spatialReference:i}=this,s=this.selectedFeature?.geometry?.type,r=this.location??t;if(s&&s!=="mesh"&&i&&r&&this.selectedFeature)if(s!=="point")try{const a=this.selectedFeature;let l=a.geometry;const u=this._getHighlightLayer(a),c=a.getObjectId();if(!u||!this.view)return;if(c){const p=this.view?.allLayerViews.find(M=>M.layer.uid===u.uid);if(!p||!("queryFeatures"in p))return;const w=p.createQuery();w.outSpatialReference=i,w.objectIds=[c],w.returnGeometry=!0;const{features:b}=await p.queryFeatures(w);l=b[0]?.geometry}if(!l||l.type==="mesh")return;l=Qt(l,i),Ue||(Ue=await Promise.all([m(()=>import("./intersectsOperator-ConiyrJ4.js").then(p=>p.i),__vite__mapDeps([32,33,34,35,36,37,1,2,38,39,40,41])),m(()=>import("./proximityOperator-BtaCys_s.js").then(p=>p.p),__vite__mapDeps([42,35,34,33,36,37,1,2,38,39,43,41]))]));const[_,v]=Ue;if(!_.execute(l,r)){const p=v.getNearestCoordinate(l,r).coordinate??r;this.selectedFeature===a&&(this.location=p)}}catch(a){Xe(a)||te.getLogger(this).error(a)}else this.location=Ye(this.selectedFeature.geometry)??r})}initialize(){this.addHandles([this.on("view-change",()=>this._autoClose()),h(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),h(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),h(()=>this.view?.animation?.state,e=>this._animationStateChange(e)),h(()=>this.location,e=>this._locationChange(e)),h(()=>this.selectedFeature,e=>this._selectedFeatureChange(e)),h(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),h(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),h(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",e=>Mi({event:e,viewModel:this,view:this.view})),Fe(()=>!this.waitingForResult,()=>this._waitingForResultChange(),Jt),h(()=>[this.features,this.map,this.spatialReference,this.timeZone],()=>this._updateFeatureVMs()),h(()=>this.view?.scale,()=>this._viewScaleChange()),Fe(()=>!this.visible,()=>this.browseClusterEnabled=!1),h(()=>this.browseClusterEnabled,e=>e?this.enableClusterBrowsing():this.disableClusterBrowsing())])}destroy(){this._cancelFetchingFeatures(),this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null,this.map=null,this.spatialReference=null,this.timeZone=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const e=this._get("allActions")||new me;e.removeAll();const{actions:t,defaultActions:i,defaultPopupTemplateEnabled:s,includeDefaultActions:r,selectedFeature:a}=this,l=r?i.concat(t):t,u=a&&(typeof a.getEffectivePopupTemplate=="function"&&a.getEffectivePopupTemplate(s)||a.popupTemplate),c=u?.actions;return(u?.overwriteActions?c:c?.concat(l)??l)?.filter(Boolean).forEach(v=>e.add(v)),e}get defaultActions(){const e=this._get("defaultActions")||new me;return e.removeAll(),e.addMany(pe(this.selectedFeature)?xi():Ti()),e}get featureCount(){return this.features.length}set features(e){const t=e||[];this._set("features",t);const{pendingPromisesCount:i,promiseCount:s,selectedFeatureIndex:r}=this,a=s&&t.length;this.initialDisplayMode!=="list"?a&&i&&r===-1?this.selectedFeatureIndex=0:a&&r!==-1||(this.selectedFeatureIndex=t.length?0:-1):(!a||a&&i===s)&&(this.selectedFeatureIndex=-1)}set location(e){let t=e;const i=this.spatialReference?.isWebMercator;e?.spatialReference?.isWGS84&&i&&(t=ei(e)),this._set("location",t)}get map(){return this.view?.map??null}set map(e){this._override("map",e)}get pendingPromisesCount(){return this._pendingPromises.size}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){this._pendingPromises.clear(),this.features=[],Array.isArray(e)&&e.length?(this._set("promises",e),(e=e.slice()).forEach(t=>this._pendingPromises.add(t)),e.reduce((t,i)=>t.finally(()=>i.then(s=>{this._pendingPromises.has(i)&&this._updateFeatures(s)}).finally(()=>this._pendingPromises.delete(i)).catch(()=>{})),Promise.resolve())):this._set("promises",[])}get screenLocation(){return super.screenLocation}get selectedFeature(){const{features:e,selectedFeatureIndex:t}=this;return t===-1?null:e[t]||null}get selectedFeatureIndex(){const e=this._get("selectedFeatureIndex");return typeof e=="number"?e:-1}set selectedFeatureIndex(e){const{featureCount:t}=this;(isNaN(e)||e<0||!t)&&(e=-1),this.activeFeature=null,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(e){this._override("spatialReference",e)}get state(){const{view:e,map:t}=this;return e?e.ready?"ready":"disabled":t?"ready":"disabled"}get timeZone(){return this.view?.timeZone??ti}set timeZone(e){this._overrideIfSome("timeZone",e)}get waitingForContents(){return this.featureViewModels.some(e=>e.waitingForContent)}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||this.featureCount!==0)}centerAtLocation(){const{view:e}=this,t=kt(this);return t&&e?this.callGoTo({target:{target:t,scale:e.scale}}):Promise.reject(new K("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e}))}zoomTo(e){return this.callGoTo(e)}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(e,t){const{view:i}=this;if(!i||!e)throw new K("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:i});return i.fetchPopupFeatures(e,{pointerType:t?.event?.pointerType,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:t?.signal})}open(e){const t={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...e,visible:!0},{fetchFeatures:i}=t;delete t.fetchFeatures,i&&this._setFetchFeaturesPromises(t.location);const s=["actionsMenuOpen","collapsed"];for(const r of s)delete t[r];this.set(t)}triggerAction(e){const t=this.allActions.at(e);t&&!t.disabled&&this.emit("trigger-action",{action:t})}next(){return this.selectedFeatureIndex=this._getRoundRobinIndex(this.selectedFeatureIndex+1,this.featureCount),this}previous(){return this.selectedFeatureIndex=this._getRoundRobinIndex(this.selectedFeatureIndex-1,this.featureCount),this}disableClusterBrowsing(){Ei(this),this._clearBrowsedClusterGraphics()}async enableClusterBrowsing(){const{view:e,selectedFeature:t}=this;e?.type==="2d"?pe(t)?(await Ci(this),await Ai(this)):te.getLogger(this).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",t):te.getLogger(this).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",t)}async handleViewClick(e){return this._fetchFeaturesAndOpen(e)}_getRoundRobinIndex(e,t){return(e+t)%t}_animationStateChange(e){this.zoomToLocation||(re.disabled=e==="waiting-for-target")}_clearBrowsedClusterGraphics(){const e=[this.selectedClusterBoundaryFeature,this._selectedClusterFeature].filter(ii);this.view?.graphics?.removeMany(e),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(pe(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=this.selectedFeature?[this.selectedFeature]:[])}_locationChange(e){const{selectedFeature:t,updateLocationEnabled:i,view:s}=this;s&&i&&e&&(!t||t.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>0?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>0?1:null}_setGraphicOnFeatureViewModels(){const{features:e,featureCount:t,featurePage:i,featuresPerPage:s,featureViewModels:r}=this;if(i==null)return;const a=((i-1)*s+t)%t,l=a+s;r.slice(a,l).forEach((u,c)=>{u&&(u.graphic??=e[a+c])})}async _selectedFeatureChange(e){const{location:t,updateLocationEnabled:i,view:s}=this;if(!e||!s)return;if(this.browseClusterEnabled)return this._selectedClusterFeature&&(s.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),pe(e)?void 0:(e.symbol=await tt(e),this._selectedClusterFeature=e,void s.graphics.add(this._selectedClusterFeature));const r=e.sourceLayer?.type;if(r!=="map-image"&&r!=="imagery"&&r!=="imagery-tile"||(e.symbol=await tt(e)),!i&&t||!e.geometry){if(i&&!e.geometry){await this.centerAtLocation();const a=s.center?.clone();a&&(this.location=a)}}else this.location=Ye(e.geometry)}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}async _setFetchFeaturesPromises(e){const{pendingFeatures:t}=await this._fetchFeaturesWithController({mapPoint:e});this.promises=t}_destroyFeatureVMs(){this.featureViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:e,features:t,featureViewModels:i,view:s,spatialReference:r,map:a,timeZone:l,location:u}=this;if(pe(t[0])||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!t?.length)return;const c=i.slice(),_=[];t.forEach((v,p)=>{if(!v)return;let w=null;if(c.some((b,M)=>(b&&b.graphic===v&&(w=b,c.splice(M,1)),!!w)),w)_[p]=w;else{const b=new Ke({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:r,graphic:v===e?v:null,location:u,map:a,view:s,timeZone:l});_[p]=b}}),c.forEach(v=>v&&!v.destroyed&&v.destroy()),this._set("featureViewModels",_)}async _getScreenPoint(e,t){const{spatialReference:i,view:s}=this;if(!s)return null;await s?.when();const r=e?.spatialReference;return r&&i?(await si(r,i,null,t),s.toScreen(e)):null}_cancelFetchingFeatures(){const e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null}async _projectScreenPointAndFetchFeatures({mapPoint:e,screenPoint:t,event:i,signal:s}){return this.fetchFeatures(t??await this._getScreenPoint(e??this.location,{signal:s}),{signal:s,event:i})}_fetchFeaturesWithController({mapPoint:e,screenPoint:t,event:i}){this._cancelFetchingFeatures();const s=new AbortController,{signal:r}=s;this._fetchFeaturesController=s;const a=this._projectScreenPointAndFetchFeatures({mapPoint:e,screenPoint:t,signal:r,event:i});return a.catch(()=>{}).then(()=>{this._fetchFeaturesController=null}),a}async _fetchFeaturesAndOpen(e){const{mapPoint:t,screenPoint:i}=e;this.removeHandles(He),this.addHandles([h(()=>this.view?.scale,()=>this._debouncedLocationUpdate(t).catch(r=>{Xe(r)||te.getLogger(this).error(r)})),Fe(()=>!this.visible,()=>{this.removeHandles(He)},{once:!0})],He);const{pendingFeatures:s}=await this._fetchFeaturesWithController({mapPoint:t,screenPoint:i,event:e});return{location:t??void 0,promises:s}}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}async _getLayerView(e,t){return await e.when(),e.whenLayerView(t)}_getHighlightLayer(e){const{layer:t,sourceLayer:i}=e;return i&&"layer"in i&&i.layer?i.layer:i?.type==="map-notes"||i?.type==="subtype-group"?i:t??i}_getHighlightLayerView(e,t){return t.type==="subtype-sublayer"&&t.parent&&this._mapIncludesLayer(t.parent)?this._getLayerView(e,t.parent):t&&this._mapIncludesLayer(t)?this._getLayerView(e,t):null}_getHighlightTarget(e,t,i){if(Li(t.type,i))return e;const s=e.getObjectId();if(s!=null)return s;const r=t.type==="imagery"?void 0:"objectIdField"in t?t.objectIdField||yi:null,a=e.attributes;return a&&r&&a[r]||e}_mapIncludesLayer(e){return!!this.map?.allLayers?.includes(e)}async _highlightFeature(e,t){this.removeHandles(e);const i=this[t];if(!i)return;const{highlightEnabled:s,view:r,visible:a}=this;if(!r||!s||!a)return;const l=this._getHighlightLayer(i);if(!l)return;const u=this._getHighlightLayerView(r,l);if(!u)return;this._highlightPromises[e]=u;const c=await u;if(!(c&&ci(c)&&this._highlightPromises[e]===u&&this[t]&&this.highlightEnabled))return;const _=c.highlight(this._getHighlightTarget(i,l,r.type));this.addHandles(_,e)}async _highlightActiveFeature(){return this._highlightFeature("highlight-active-feature","activeFeature")}async _highlightSelectedFeature(){return this._highlightFeature("highlight-selected-feature","selectedFeature")}_updateFeatures(e){const{features:t}=this,i=e.filter(s=>!t.includes(s));i?.length&&(this.features=t.concat(i))}};n([o()],g.prototype,"_fetchFeaturesController",void 0),n([o({type:me})],g.prototype,"actions",void 0),n([o({readOnly:!0})],g.prototype,"active",null),n([o()],g.prototype,"activeFeature",void 0),n([o({readOnly:!0})],g.prototype,"allActions",null),n([o()],g.prototype,"autoCloseEnabled",void 0),n([o()],g.prototype,"browseClusterEnabled",void 0),n([o()],g.prototype,"content",void 0),n([o({type:me,readOnly:!0})],g.prototype,"defaultActions",null),n([o({type:Boolean})],g.prototype,"defaultPopupTemplateEnabled",void 0),n([o({readOnly:!0})],g.prototype,"featureCount",null),n([o()],g.prototype,"featurePage",void 0),n([o({value:[]})],g.prototype,"features",null),n([o()],g.prototype,"featuresPerPage",void 0),n([o()],g.prototype,"featureMenuOpen",void 0),n([o()],g.prototype,"featureMenuTitle",void 0),n([o()],g.prototype,"featureViewModelAbilities",void 0),n([o({readOnly:!0})],g.prototype,"featureViewModels",void 0),n([o()],g.prototype,"highlightEnabled",void 0),n([o()],g.prototype,"includeDefaultActions",void 0),n([o()],g.prototype,"initialDisplayMode",void 0),n([o({type:ht})],g.prototype,"location",null),n([o()],g.prototype,"map",null),n([o({readOnly:!0})],g.prototype,"pendingPromisesCount",null),n([o({readOnly:!0})],g.prototype,"promiseCount",null),n([o()],g.prototype,"promises",null),n([o({readOnly:!0})],g.prototype,"selectedClusterBoundaryFeature",void 0),n([o({value:null,readOnly:!0})],g.prototype,"selectedFeature",null),n([o({value:-1})],g.prototype,"selectedFeatureIndex",null),n([o({readOnly:!0})],g.prototype,"selectedFeatureViewModel",null),n([o({type:ni})],g.prototype,"spatialReference",null),n([o({readOnly:!0})],g.prototype,"state",null),n([o()],g.prototype,"timeZone",null),n([o()],g.prototype,"title",void 0),n([o()],g.prototype,"updateLocationEnabled",void 0),n([o()],g.prototype,"view",void 0),n([o()],g.prototype,"visible",void 0),n([o({readOnly:!0})],g.prototype,"waitingForContents",null),n([o({readOnly:!0})],g.prototype,"waitingForResult",null),n([o()],g.prototype,"zoomFactor",void 0),n([o()],g.prototype,"zoomToLocation",void 0),n([o()],g.prototype,"centerAtLocation",null),g=n([x("esri.widgets.Features.FeaturesViewModel")],g);let W=class extends qe{constructor(){super(...arguments),this.actionBar=!0,this.closeButton=!0,this.collapseButton=!1,this.featureMenuHeading=!0,this.featureNavigation=!0,this.featureListLayerTitle=!0,this.flow=!0,this.heading=!0,this.spinner=!0}};n([o({type:Boolean,nonNullable:!0})],W.prototype,"actionBar",void 0),n([o({type:Boolean,nonNullable:!0})],W.prototype,"closeButton",void 0),n([o({type:Boolean,nonNullable:!0})],W.prototype,"collapseButton",void 0),n([o({type:Boolean,nonNullable:!0})],W.prototype,"featureMenuHeading",void 0),n([o({type:Boolean,nonNullable:!0})],W.prototype,"featureNavigation",void 0),n([o({type:Boolean,nonNullable:!0})],W.prototype,"featureListLayerTitle",void 0),n([o({type:Boolean,nonNullable:!0})],W.prototype,"flow",void 0),n([o({type:Boolean,nonNullable:!0})],W.prototype,"heading",void 0),n([o({type:Boolean,nonNullable:!0})],W.prototype,"spinner",void 0),W=n([x("esri.widgets.Features.FeaturesVisibleElements")],W);const lt="selected-index",ki=0,dt="features-spinner";function ut(e){return e?.declaredClass.startsWith("esri.layers.")??!1}let f=class extends Lt(H){constructor(e,t){super(e,t),this._featureMenuIntersectionObserverCallback=([i])=>{i?.isIntersecting&&this.viewModel.featurePage!=null&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._featureMenuIntersectionObserverNode=null,this._spinner=null,this._feature=null,this._focusAbortController=null,this._drillInFlowItems=new It,this._drillInWidget=new se({flowItems:this._drillInFlowItems}),this._rootNode=null,this._rootFlowItemNode=null,this._featureMenuViewportNode=null,this._actionBarMenuNode=null,this.collapsed=!1,this.featureNavigationTop=!1,this.headerActions=new me,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.responsiveActionsEnabled=!1,this.viewModel=new g,this.visibleElements=new W,this._previousFeature=()=>{this.viewModel.previous()},this._nextFeature=()=>{this.viewModel.next()},this._handleFeatureBack=()=>{this.initialDisplayMode==="list"?(this.selectedFeatureIndex=-1,this._focusFlowItemNode()):this._openFeatureMenu()},this._handleFeatureMenuBack=()=>{this.initialDisplayMode==="list"?(this.selectedFeatureIndex=-1,this._focusFlowItemNode()):this.featureMenuOpen&&this._closeFeatureMenu()},this._storeRootNode=i=>{this._rootNode=i},this._displaySpinnerThrottled=oi(()=>this._displaySpinner(),ki),this._addSelectedFeatureIndexHandle(),this.addHandles([this._displaySpinnerThrottled,h(()=>this.viewModel?.active,()=>this._toggleScreenLocationEnabled()),h(()=>this.viewModel?.active,i=>this._drillInWidget.closed=!i),h(()=>this.visibleElements?.closeButton,i=>this._drillInWidget.closable=i),h(()=>this.visibleElements?.spinner,i=>this._spinnerEnabledChange(i)),h(()=>this.viewModel?.view,(i,s)=>this._viewChange(i,s)),h(()=>this.viewModel?.view?.ready,(i,s)=>this._viewReadyChange(i??!1,s??!1)),h(()=>[this.viewModel?.waitingForResult,this.viewModel?.location],()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),h(()=>this.viewModel?.screenLocation,()=>this._closeOpenActionMenu()),h(()=>this.selectedFeatureWidget?.viewModel,()=>this._destroyDrillInFlowItemWidgets()),h(()=>this.featureMenuOpen,()=>this._drillInWidget.selectLastFlowItem=this.initialDisplayMode==="list"||!this.featureMenuOpen,F),h(()=>{const i=this.selectedFeatureWidget?.viewModel;return[i?.title,i?.state]},()=>this._setTitleFromFeatureWidget()),h(()=>{const i=this.selectedFeatureWidget?.viewModel;return[i?.content,i?.state]},()=>this._setContentFromFeatureWidget()),h(()=>this.viewModel?.featureViewModels,()=>this._featureMenuViewportScrollTop()),h(()=>this._drillInFlowItems.length,()=>this._focusFlowItemNode()),this._drillInWidget.on("close",()=>this.close()),this._drillInWidget.on("exit",()=>this._destroyDrillInFlowItemWidgets()),this._drillInWidget.on("open-feature",({feature:i})=>this._openRelatedFeature(i)),this._drillInWidget.on("zoom-to-feature",({featureWidget:i})=>$t(this.viewModel,i))])}loadDependencies(){return Promise.all([At(),_e({action:()=>m(()=>import("./index-Bkom2Sdc.js").then(e=>e.zN),__vite__mapDeps([1,2])),"action-bar":()=>m(()=>import("./index-yqsEyyJ5.js"),__vite__mapDeps([27,1,2,28,29,30,31])),"action-group":()=>m(()=>import("./index-Dx3YHB6R.js").then(e=>e.i),__vite__mapDeps([28,1,2,29])),button:()=>m(()=>import("./index-Bkom2Sdc.js").then(e=>e.zQ),__vite__mapDeps([1,2])),icon:()=>m(()=>import("./index-Bkom2Sdc.js").then(e=>e.zv),__vite__mapDeps([1,2])),flow:()=>m(()=>import("./index-Bkom2Sdc.js").then(e=>e.zP),__vite__mapDeps([1,2])),"flow-item":()=>m(()=>import("./index-Bkom2Sdc.js").then(e=>e.zO),__vite__mapDeps([1,2])),list:()=>m(()=>import("./index-Bkom2Sdc.js").then(e=>e.zL),__vite__mapDeps([1,2])),"list-item":()=>m(()=>import("./index-Bkom2Sdc.js").then(e=>e.zV),__vite__mapDeps([1,2])),"list-item-group":()=>m(()=>import("./index-DDq8a8ZA.js").then(e=>e.i),__vite__mapDeps([44,1,2])),loader:()=>m(()=>import("./index-Bkom2Sdc.js").then(e=>e.zI),__vite__mapDeps([1,2]))})])}destroy(){this._destroyDrillInFlowItemWidgets(),this._destroySelectedFeatureWidget(),this._destroySpinner(),this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver?.disconnect(),this._drillInWidget?.destroy(),this._focusAbortController?.abort()}get _hideActionText(){if(!this.responsiveActionsEnabled)return!1;const e=this.view?.widthBreakpoint;return e==="xsmall"||e==="small"||e==="medium"}get _featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&!!this.viewModel.selectedFeature&&this.visibleElements.featureNavigation}get _isCollapsed(){return this._collapseEnabled&&this.collapsed}get _collapseEnabled(){return this.visibleElements.collapseButton&&(this.initialDisplayMode==="list"||!!this.title&&!!this.content)}get active(){return this.viewModel.active}get content(){return this.viewModel.content}set content(e){this.viewModel.content=e}get icon(){return null}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(e){this.viewModel.featureMenuOpen=e}get featureMenuTitle(){return this.viewModel.featureMenuTitle}set featureMenuTitle(e){this.viewModel.featureMenuTitle=e}get features(){return this.viewModel.features}set features(e){this.viewModel.features=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get initialDisplayMode(){return this.viewModel.initialDisplayMode}set initialDisplayMode(e){this.viewModel.initialDisplayMode=e}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get promises(){return this.viewModel.promises}set promises(e){this.viewModel.promises=e}get selectedFeature(){return this.viewModel.selectedFeature}get selectedDrillInFeature(){const e=Array.from(this._drillInFlowItems).at(-1);if(!e)return null;const{flowType:t}=e;return t==="feature-association"||t==="feature-relationship"?e.graphic??null:null}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(e){this.viewModel.selectedFeatureIndex=e}get selectedFeatureWidget(){const{_feature:e,headingLevel:t,_drillInFlowItems:i,timeZone:s,spatialReference:r,map:a}=this,{selectedFeatureViewModel:l}=this.viewModel,u={title:!1};return l?(e?(e.viewModel=l,e.visibleElements=u):this._feature=new I({flowItems:i,headingLevel:t+1,timeZone:s,spatialReference:r,map:a,viewModel:l,visibleElements:u}),this._feature):null}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(e){this.viewModel.updateLocationEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}blur(){const{active:e}=this.viewModel;e?this._rootFlowItemNode?.blur():te.getLogger(this).warn("Features can only be blurred when currently active.")}clear(){return this.viewModel.clear()}close(){this.viewModel.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){const{active:e}=this.viewModel;e?this._focusFlowItemNode():te.getLogger(this).warn("Features can only be focused when currently active.")}next(){return this.viewModel.next()}open(e){this.removeHandles(lt);const t={collapsed:e?.collapsed??!1};this.set(t),this.viewModel.open(e),this.addHandles(Fe(()=>!this.viewModel.waitingForResult,()=>this._addSelectedFeatureIndexHandle(),{once:!0}))}previous(){return this.viewModel.previous()}triggerAction(e){return this.viewModel.triggerAction(e)}render(){return d("div",{afterCreate:this._storeRootNode,bind:this,class:this.classes(T.base,ae.widget,ae.panel),onkeydown:this._onMainKeydown},this._renderHeader(),this._renderContentContainer())}_renderFeatureNavigation(){return[this._renderPagination(),this.initialDisplayMode==="list"?this._renderFeaturePaginationText():this._renderFeatureMenuButton()]}_renderHeader(){return this.featureNavigationTop&&this._featureNavigationVisible?d("div",{class:T.header,key:"header-actions"},this._renderFeatureNavigation()):null}_renderFooter(){return!this.featureNavigationTop&&this._featureNavigationVisible?d("div",{class:T.footer,key:"footer-actions",slot:"footer"},this._renderFeatureNavigation()):null}_renderFeaturePaginationText(){const{messages:e,viewModel:t}=this,{featureCount:i,selectedFeatureIndex:s}=t;return d("div",{class:T.paginationText,key:"feature-pagination-text"},j(e.pageText,{index:fe(s+1),total:fe(i)}))}_renderFeatureMenuButton(){const{messages:e,viewModel:t}=this,{featureCount:i,selectedFeatureIndex:s,pendingPromisesCount:r}=t;return d("calcite-action",{appearance:"solid",bind:this,class:T.paginationMenuButton,icon:"list",key:"feature-menu-button",label:e.selectFeature,loading:r>0,onclick:this._handlePaginationMenuButton,scale:"s",text:j(e.pageText,{index:fe(s+1),total:fe(i)}),textEnabled:!0,title:e.selectFeature})}_renderPagination(){const{previous:e,next:t}=this.messagesCommon.pagination;return d("calcite-action-bar",{class:T.paginationActionBar,expandDisabled:!0,key:"pagination-action-bar",layout:"horizontal",overflowActionsDisabled:!0,scale:"s"},d("calcite-action-group",{scale:"s"},d("calcite-action",{appearance:"solid",class:T.paginationPrevious,icon:"chevron-left",iconFlipRtl:!0,label:e,onclick:this._previousFeature,scale:"s",text:e,title:e}),d("calcite-action",{appearance:"solid",icon:"chevron-right",iconFlipRtl:!0,label:t,onclick:this._nextFeature,scale:"s",text:t,title:t})))}_renderFeatureMenuItem(e){const{initialDisplayMode:t}=this,{selectedFeatureViewModel:i,featureViewModels:s}=this.viewModel,r=e===i,a=s.indexOf(e);return d("calcite-list-item",{bind:this,"data-feature-index":a,key:`feature-menu-item-${e.uid}`,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onmouseleave:this._removeActiveFeature,onmouseover:this._setActiveFeature,selected:r,onCalciteListItemSelect:this._selectFeature},d("span",{innerHTML:e.title||this.messagesCommon.untitled,slot:"content"}),t==="list"?d("calcite-icon",{flipRtl:!0,icon:"chevron-right",scale:"s",slot:"content-end"}):null)}_groupResultsByLayer(){const{featureViewModels:e}=this.viewModel,t=new Map;return e.forEach(i=>{const s=i?.graphic;if(!s)return;const{layer:r,sourceLayer:a}=s,l=(ut(r)?r:null)||(ut(a)?a:null),u=t.get(l)??[];t.set(l,[...u,i])}),t}_renderFeatureMenu(){const{messages:e,viewModel:t}=this,i=this._groupResultsByLayer(),s=this.initialDisplayMode==="list"?"none":"single";return t.featureViewModels.length?d("calcite-list",{displayMode:"flat",label:e?.featuresList,selectionAppearance:"icon",selectionMode:s},Array.from(i.keys(),r=>{const a=i.get(r)?.map(u=>this._renderFeatureMenuItem(u)),l=r?r.title??this.messagesCommon.untitled:null;return this.visibleElements.featureListLayerTitle&&l!==null?d("calcite-list-item-group",{heading:l,key:r?.uid||"map-graphics"},a):a})):null}_renderHeaderAction(e,t){const i=e.title||"";return e.visible?d("calcite-action",{active:e.type==="toggle"&&e.value,appearance:"solid",bind:this,"data-action-id":e.id,"data-action-uid":e.uid,disabled:e.disabled,icon:e.icon??void 0,indicator:e.indicator,key:`header-action-${t}`,loading:e.active,onclick:this._triggerHeaderAction,slot:"header-actions-end",text:i,title:i}):null}_renderHeaderActions(){return this.headerActions.map((e,t)=>this._renderHeaderAction(e,t)).toArray()}_renderContentFeature(){const{headingLevel:e,visibleElements:t,_isCollapsed:i,_collapseEnabled:s,featureNavigationTop:r,_drillInFlowItems:a,initialDisplayMode:l,selectedFeature:u,featureMenuOpen:c}=this,{title:_,active:v}=this.viewModel,p=t.heading&&_?_:"";if(l==="list"&&!u)return null;const w=a.length===0&&(l==="list"?!!u:!c);return d("calcite-flow-item",{afterCreate:this._storeRootFlowItemNode,bind:this,class:this.classes({[T.contentFeature]:!0,[T.flowItemCollapsed]:i}),closable:t.closeButton,closed:!v,collapsed:i,collapseDirection:r?"down":"up",collapsible:s,headingLevel:e,key:"root-flow-item",selected:w,onCalciteFlowItemBack:this._handleFeatureBack,onCalciteFlowItemClose:this.close,onCalciteFlowItemToggle:this._handleCollapseToggle},p?d(Qe,{class:this.classes(T.featuresHeading,ae.heading),innerHTML:p,key:"header-content",level:this.headingLevel,slot:"header-content"}):null,this._renderHeaderActions(),this._renderActionBar(),d("div",{class:this.classes(T.container,T.contentContainer)},this._renderContent()),this._renderFooter())}_renderFeatureMenuContainer(){const{viewModel:e,visibleElements:t,featureMenuTitle:i,messages:s,messagesCommon:r,initialDisplayMode:a,featureMenuOpen:l,selectedFeature:u,_collapseEnabled:c,_isCollapsed:_,featureNavigationTop:v,headingLevel:p}=this,{active:w,featureViewModels:b,pendingPromisesCount:M}=e,{featureMenuHeading:A}=t,L=i??s.selectFeature;if(a==="feature"&&!l)return null;const R=a==="list"?!u:l;return d("calcite-flow-item",{afterCreate:this._storeFeatureMenuFlowItemNode,bind:this,class:this.classes({[T.flowItemCollapsed]:_}),closable:a==="list"&&t.closeButton,closed:!w,collapsed:a==="list"&&_,collapseDirection:v?"down":"up",collapsible:a==="list"&&c,description:A?j(s.total,{total:b.length}):void 0,heading:A?L:void 0,headingLevel:p,key:"feature-menu",loading:e.waitingForContents,selected:R,onCalciteFlowItemBack:$=>{$.preventDefault(),this._handleFeatureMenuBack()},onCalciteFlowItemClose:this.close,onCalciteFlowItemToggle:this._handleCollapseToggle},a==="list"?this._renderHeaderActions():null,M>0?d("calcite-loader",{class:T.loader,inline:!0,key:"feature-menu-loader",label:r.loading,slot:"header-actions-end"}):null,d("div",{class:T.container},this._renderFeatureMenu()),d("div",{afterCreate:this._featureMenuIntersectionObserverCreated,bind:this,class:T.featureMenuObserver}),a==="feature"?d("calcite-button",{appearance:"transparent",onclick:this._handleFeatureMenuBack,slot:"footer-actions",width:"full"},r.back):null)}_renderContentContainer(){const e=this.initialDisplayMode==="list"?[this._renderFeatureMenuContainer(),this._renderContentFeature(),this._drillInWidget.render()]:[this._renderContentFeature(),this._drillInWidget.render(),this._renderFeatureMenuContainer()];return this.visibleElements.flow?d("calcite-flow",{key:"content-container"},e):e}_getFallbackIcon(e){const{className:t,icon:i}=e;if(i)return null;const s=ri({action:e,feature:this.selectedFeature}),r={[T.icon]:!!t,[T.actionImage]:!!s};return t&&(r[t]=!0),s||t?d("span",{"aria-hidden":"true",class:this.classes(T.icon,r),key:"icon",styles:ai(s)}):null}_renderActionBar(){return!this._isCollapsed&&this.visibleElements.actionBar&&this.viewModel.allActions?.length?d("calcite-action-bar",{expandDisabled:!0,expanded:!this._hideActionText,key:"header-action-bar",scale:"s",slot:"action-bar"},d("calcite-action-group",{afterCreate:e=>this._actionBarMenuNode=e,overlayPositioning:"fixed",scale:"s"},this._renderActions())):null}_renderActions(){return this.viewModel.allActions.toArray().map((e,t)=>{const i=this._getActionTitle(e);return Et(e,{key:`action-${t}`,title:i,text:i,textEnabled:!this._hideActionText,onclick:this._triggerAction,bind:this},this._getFallbackIcon(e))})}_renderContent(){const e=this.viewModel?.content;return e?typeof e=="string"?d("div",{class:C.contentNode,innerHTML:e,key:e}):this.renderNodeContent(e):null}_handleCollapseToggle(){this.collapsed=!this.collapsed}async _openRelatedFeature(e){await e.viewModel.updateGeometry();const t=e.graphic,i=t?.geometry;if(i==null||t==null)return;this._destroyDrillInFlowItemWidgets(),await this.viewModel.zoomTo({target:i});const s=Ye(i);this.open({features:[t],location:s??void 0}),this._focusFlowItemNode()}_handlePaginationMenuButton(){this._updateFeatureMenu()}_openFeatureMenu(){this._updateFeatureMenu(!0)}_closeFeatureMenu(){this._updateFeatureMenu(!1)}_updateFeatureMenu(e=!this.featureMenuOpen){this.featureMenuOpen=e,this._focusFlowItemNode()}async _focusFlowItemNode(){this._focusAbortController?.abort(),this._focusAbortController=new AbortController;const e=this._focusAbortController.signal;await je(Tt(e));const t=this._rootNode?.querySelector("calcite-flow-item[selected]");li(t)}_storeRootFlowItemNode(e){this._rootFlowItemNode=e}_storeFeatureMenuFlowItemNode(e){this._featureMenuViewportNode=e}_setActiveFeature(e){const{viewModel:t}=this,i=e.currentTarget["data-feature-index"];t.activeFeature=t.features?.[i]||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_selectFeature(e){const t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this.initialDisplayMode==="feature"?this._handleFeatureMenuBack():this._focusFlowItemNode()}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_getActionTitle(e){const{messages:t,selectedFeature:i,messagesCommon:s}=this,{id:r}=e,a=i?.attributes,l=e.title??"",u=r==="zoom-to-feature"?j(l,{messages:t}):r==="remove-selected-feature"?j(l,{messages:s}):r==="zoom-to-clustered-features"||r==="browse-clustered-features"?j(l,{messages:t}):e.title;return u&&a?j(u,a):u??""}_onMainKeydown(e){const{key:t}=e;t==="ArrowLeft"&&(e.stopPropagation(),this._handleFeatureMenuBack(),this.previous()),t==="ArrowRight"&&(e.stopPropagation(),this._handleFeatureMenuBack(),this.next())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode?.scrollContentTo({top:0})}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_setTitleFromFeatureWidget(){const{selectedFeatureWidget:e,messagesCommon:t}=this,i=e?.viewModel;e&&(this.viewModel.title=i?.state==="error"?t?.errorMessage:i?.title||"")}_addSelectedFeatureIndexHandle(){const e=h(()=>this.viewModel?.selectedFeatureIndex,(t,i)=>this._selectedFeatureIndexUpdated(t,i));this.addHandles(e,lt)}_selectedFeatureIndexUpdated(e,t){const{featureCount:i}=this.viewModel;i&&e!==t&&e!==-1&&(this._destroyDrillInFlowItemWidgets(),this._rootFlowItemNode?.scrollContentTo({top:0}))}_triggerHeaderAction(e){const t=e.currentTarget;if(t.disabled)return;const i=t.dataset.actionUid,s=this.headerActions.find(({uid:r})=>r===i);s&&!s.disabled&&(s?.type==="toggle"&&(s.value=!s.value),this.emit("trigger-header-action",{action:s}))}_triggerAction(e){const t=e.currentTarget;if(t.disabled)return;const i=t.dataset.actionUid,{allActions:s}=this.viewModel,r=s.findIndex(l=>l.uid===i),a=s.at(r);a&&a.type==="toggle"&&(a.value=!a.value),this.viewModel.triggerAction(r)}_createSpinner(e){e&&(this._spinner=new he({view:e}),e.ui.add(this._spinner,{key:dt,position:"manual",internal:!0}))}_wireUpView(e){this._destroySpinner(),e&&this.visibleElements?.spinner&&this._createSpinner(e)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_viewReadyChange(e,t){e?this._wireUpView(this.viewModel?.view):t&&this.viewModel.clear()}_viewChange(e,t){e&&t&&this.viewModel.clear()}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,!e.destroyed&&e.destroy()),this._feature=null}_closeOpenActionMenu(){const{_actionBarMenuNode:e}=this;e&&(e.menuOpen=!1)}_destroyDrillInFlowItemWidgets(){this._drillInFlowItems.drain(e=>{"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),"activeCategory"in e.viewModel&&(e.viewModel.activeCategory=null),e.viewModel=null,e.destroy()})}_toggleScreenLocationEnabled(){const{viewModel:e}=this;e&&(e.screenLocationEnabled=e.active)}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:t,waitingForResult:i}=this.viewModel;i&&t?e.show({location:t}):e.hide()}_destroySpinner(){const{_spinner:e}=this;e&&(e.view?.ui?.remove(e,dt),e.destroy(),this._spinner=null)}_spinnerEnabledChange(e){this._destroySpinner(),e&&this._createSpinner(this.viewModel?.view)}};n([o()],f.prototype,"_drillInFlowItems",void 0),n([o()],f.prototype,"_hideActionText",null),n([o()],f.prototype,"_featureNavigationVisible",null),n([o()],f.prototype,"_isCollapsed",null),n([o()],f.prototype,"_collapseEnabled",null),n([o({readOnly:!0})],f.prototype,"active",null),n([o()],f.prototype,"collapsed",void 0),n([o()],f.prototype,"content",null),n([o()],f.prototype,"icon",null),n([o()],f.prototype,"featureMenuOpen",null),n([o()],f.prototype,"featureMenuTitle",null),n([o()],f.prototype,"featureNavigationTop",void 0),n([o()],f.prototype,"features",null),n([o()],f.prototype,"goToOverride",null),n([o({type:me})],f.prototype,"headerActions",void 0),n([o()],f.prototype,"headingLevel",void 0),n([o()],f.prototype,"initialDisplayMode",null),n([o()],f.prototype,"location",null),n([o()],f.prototype,"label",null),n([o()],f.prototype,"map",null),n([o(),z("esri/widgets/Features/t9n/Features")],f.prototype,"messages",void 0),n([o(),z("esri/t9n/common")],f.prototype,"messagesCommon",void 0),n([o()],f.prototype,"promises",null),n([o()],f.prototype,"responsiveActionsEnabled",void 0),n([o({readOnly:!0})],f.prototype,"selectedFeature",null),n([o({readOnly:!0})],f.prototype,"selectedDrillInFeature",null),n([o()],f.prototype,"selectedFeatureIndex",null),n([o({readOnly:!0})],f.prototype,"selectedFeatureWidget",null),n([o()],f.prototype,"spatialReference",null),n([o()],f.prototype,"title",null),n([o()],f.prototype,"timeZone",null),n([o()],f.prototype,"updateLocationEnabled",null),n([o()],f.prototype,"view",null),n([o({type:g}),xt(["triggerAction","trigger-action"])],f.prototype,"viewModel",void 0),n([o({type:W,nonNullable:!0})],f.prototype,"visibleElements",void 0),n([o()],f.prototype,"visible",null),f=n([x("esri.widgets.Features")],f);const B="esri-popup",ce=`${B}--is-docked`,E={base:B,baseHidden:`${B}--hidden`,main:`${B}__main-container`,shadow:`${B}--shadow`,isDocked:ce,isDockedTopLeft:`${ce}-top-left`,isDockedTopCenter:`${ce}-top-center`,isDockedTopRight:`${ce}-top-right`,isDockedBottomLeft:`${ce}-bottom-left`,isDockedBottomCenter:`${ce}-bottom-center`,isDockedBottomRight:`${ce}-bottom-right`,alignTopCenter:`${B}--aligned-top-center`,alignBottomCenter:`${B}--aligned-bottom-center`,alignTopLeft:`${B}--aligned-top-left`,alignBottomLeft:`${B}--aligned-bottom-left`,alignTopRight:`${B}--aligned-top-right`,alignBottomRight:`${B}--aligned-bottom-right`,pointer:`${B}__pointer`,pointerDirection:`${B}__pointer-direction`};let Re=class extends g{constructor(e){super(e)}};Re=n([x("esri.widgets.Popup.PopupViewModel")],Re);let X=class extends qe{constructor(){super(...arguments),this.actionBar=!0,this.closeButton=!0,this.collapseButton=!0,this.featureMenuHeading=!0,this.featureNavigation=!0,this.featureListLayerTitle=!0,this.heading=!0,this.spinner=!0}};n([o({type:Boolean,nonNullable:!0})],X.prototype,"actionBar",void 0),n([o({type:Boolean,nonNullable:!0})],X.prototype,"closeButton",void 0),n([o({type:Boolean,nonNullable:!0})],X.prototype,"collapseButton",void 0),n([o({type:Boolean,nonNullable:!0})],X.prototype,"featureMenuHeading",void 0),n([o({type:Boolean,nonNullable:!0})],X.prototype,"featureNavigation",void 0),n([o({type:Boolean,nonNullable:!0})],X.prototype,"featureListLayerTitle",void 0),n([o({type:Boolean,nonNullable:!0})],X.prototype,"heading",void 0),n([o({type:Boolean,nonNullable:!0})],X.prototype,"spinner",void 0),X=n([x("esri.widgets.Popup.PopupVisibleElements")],X);const $i=200,ct={buttonEnabled:!0,position:"auto",breakpoint:{width:544}};let y=class extends H{constructor(e,t){super(e,t),this._dockAction=new Ce({id:"popup-dock-action"}),this._featuresWidget=new f({responsiveActionsEnabled:!0}),this._containerNode=null,this._mainContainerNode=null,this._pointerOffsetInPx=16,this._focusAbortController=null,this.alignment="auto",this.dockEnabled=!1,this.headingLevel=2,this.messages=null,this.viewModel=new Re,this.visibleElements=new X}initialize(){this.addHandles([h(()=>[this.viewModel?.view?.widthBreakpoint,this.dockEnabled],()=>this._handleDockIcon(),F),h(()=>[this.dockEnabled,this.messages?.undock,this.messages?.dock],()=>this._handleDockEnabled(),F),h(()=>this.dockOptions,e=>{const{_dockAction:t}=this,i=this._featuresWidget.headerActions;i.remove(t),e.buttonEnabled&&i.add(t)},F),h(()=>this.viewModel?.screenLocation,()=>this._positionContainer()),h(()=>[this.viewModel?.active,this.dockEnabled],()=>this._toggleScreenLocationEnabled()),h(()=>[this.viewModel?.screenLocation,this.viewModel?.view?.padding,this.viewModel?.view?.size,this.viewModel?.active,this.viewModel?.location,this.alignment],()=>this.reposition()),h(()=>this.viewModel?.view?.size,(e,t)=>this._updateDockEnabledForViewSize(e,t)),h(()=>this.viewModel?.view,(e,t)=>this._viewChange(e,t)),h(()=>this.viewModel?.view?.ready,(e,t)=>this._viewReadyChange(e??!1,t??!1)),h(()=>this.viewModel,()=>this._featuresWidget.viewModel=this.viewModel,F),h(()=>this._featureNavigationTop,e=>this._featuresWidget.featureNavigationTop=e,F),h(()=>this.headingLevel,e=>this._featuresWidget.headingLevel=e,F),h(()=>this.visibleElements.actionBar,e=>this._featuresWidget.visibleElements.actionBar=!!e,F),h(()=>this.visibleElements.closeButton,e=>this._featuresWidget.visibleElements.closeButton=!!e,F),h(()=>this.visibleElements.collapseButton,e=>this._featuresWidget.visibleElements.collapseButton=!!e,F),h(()=>this.visibleElements.heading,e=>this._featuresWidget.visibleElements.heading=!!e,F),h(()=>this.visibleElements.spinner,e=>this._featuresWidget.visibleElements.spinner=!!e,F),h(()=>this.visibleElements.featureNavigation,e=>this._featuresWidget.visibleElements.featureNavigation=!!e,F),h(()=>this.visibleElements.featureMenuHeading,e=>this._featuresWidget.visibleElements.featureMenuHeading=!!e,F),h(()=>this.visibleElements.featureListLayerTitle,e=>this._featuresWidget.visibleElements.featureListLayerTitle=!!e,F),yt(()=>this._featuresWidget,"trigger-header-action",e=>{e.action===this._dockAction&&(this.dockEnabled=!this.dockEnabled)})])}destroy(){this._dockAction.destroy(),this._featuresWidget&&(this._featuresWidget.viewModel=new g,this._featuresWidget.destroy()),this._focusAbortController?.abort()}get _featureNavigationTop(){const{currentAlignment:e,currentDockPosition:t}=this;return e==="bottom-left"||e==="bottom-center"||e==="bottom-right"||t==="top-left"||t==="top-center"||t==="top-right"}get actions(){return this.viewModel.actions}set actions(e){this.viewModel.actions=e}get active(){return this.viewModel.active}get autoCloseEnabled(){return this.viewModel.autoCloseEnabled}set autoCloseEnabled(e){this.viewModel.autoCloseEnabled=e}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(e){this.viewModel.defaultPopupTemplateEnabled=e}get content(){return this.viewModel.content}set content(e){this.viewModel.content=e}get collapsed(){return this._featuresWidget.collapsed}set collapsed(e){this._featuresWidget.collapsed=e}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||ct}set dockOptions(e){const t={...ct},i=this.viewModel?.view?.breakpoints,s={};i&&(s.width=i.xsmall,s.height=i.xsmall);const r={...t,...e},a={...t.breakpoint,...s},{breakpoint:l}=r;typeof l=="object"?r.breakpoint={...a,...l}:l&&(r.breakpoint=a),this._set("dockOptions",r),this._setCurrentDockPosition(),this.reposition()}get featureCount(){return this.viewModel.featureCount}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(e){this.viewModel.featureMenuOpen=e}get features(){return this.viewModel.features}set features(e){this.viewModel.features=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(e){this.viewModel.highlightEnabled=e}get icon(){return"popup"}set icon(e){this._overrideIfSome("icon",e)}get initialDisplayMode(){return this.viewModel.initialDisplayMode}set initialDisplayMode(e){this.viewModel.initialDisplayMode=e}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get promises(){return this.viewModel.promises}set promises(e){this.viewModel.promises=e}get selectedFeature(){return this.viewModel.selectedFeature}get selectedDrillInFeature(){return this._featuresWidget.selectedDrillInFeature??null}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(e){this.viewModel.selectedFeatureIndex=e}get selectedFeatureWidget(){return this._featuresWidget.selectedFeatureWidget}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(e){this.viewModel.updateLocationEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}blur(){const{active:e}=this.viewModel;e||te.getLogger(this).warn("Popup can only be blurred when currently active."),this._featuresWidget.blur()}clear(){return this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){const{active:e}=this.viewModel;e||te.getLogger(this).warn("Popup can only be focused when currently active."),this._handleFocus()}next(){return this.viewModel.next()}open(e){const t=!!e&&!!e.featureMenuOpen,i={collapsed:!!e&&!!e.collapsed,featureMenuOpen:t};this.set(i),this.viewModel.open(e),e?.shouldFocus&&this._handleFocus(!0)}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){return this.viewModel.triggerAction(e)}render(){const{dockEnabled:e,currentAlignment:t,currentDockPosition:i}=this,{active:s,screenLocation:r}=this.viewModel,a=s&&e,l=s&&!e,u=this.selectedFeature?.layer?.title,c=this.selectedFeature?.layer?.id,_={[E.alignTopCenter]:t==="top-center",[E.alignBottomCenter]:t==="bottom-center",[E.alignTopLeft]:t==="top-left",[E.alignBottomLeft]:t==="bottom-left",[E.alignTopRight]:t==="top-right",[E.alignBottomRight]:t==="bottom-right",[E.isDocked]:a,[E.shadow]:l,[E.isDockedTopLeft]:i==="top-left",[E.isDockedTopCenter]:i==="top-center",[E.isDockedTopRight]:i==="top-right",[E.isDockedBottomLeft]:i==="bottom-left",[E.isDockedBottomCenter]:i==="bottom-center",[E.isDockedBottomRight]:i==="bottom-right"};return d("div",{afterCreate:this._positionContainer,afterUpdate:this._positionContainer,"aria-hidden":(!s).toString(),"aria-label":ve(this.title??""),"aria-modal":"false",bind:this,class:this.classes(E.base,_,{[E.baseHidden]:!r&&!e}),"data-layer-id":c,"data-layer-title":u,role:"dialog"},s?[this._renderMainContainer(),this._renderPointer()]:null)}_renderPointer(){return this.dockEnabled?null:d("div",{class:E.pointer,key:"popup-pointer",role:"presentation"},d("div",{class:this.classes(E.pointerDirection,E.shadow)}))}_renderMainContainer(){const{dockEnabled:e}=this,t={[E.shadow]:e};return d("div",{afterCreate:this._setMainContainerNode,afterUpdate:this._setMainContainerNode,bind:this,class:this.classes(E.main,ae.widget,t)},this._featuresWidget.render())}_getAnimationDurationMS(){const{_containerNode:e}=this;return e?1e3*parseFloat(window.getComputedStyle(e).animationDuration):$i}async _handleFocus(e=!1){this._focusAbortController?.abort(),this._focusAbortController=new AbortController;const t=this._focusAbortController.signal;e&&await di(()=>this.viewModel?.active===!0,{signal:t}),await je(Tt(t)),await je(Ge(this._getAnimationDurationMS(),t)),this._featuresWidget.focus()}_isOutsideView(e){const{popupHeight:t,popupWidth:i,screenLocation:s,side:r,view:a}=e;if(isNaN(i)||isNaN(t)||!a||!s)return!1;const l=a.padding;return r==="right"&&s.x+i/2>a.width-l.right||r==="left"&&s.x-i/2<l.left||r==="top"&&s.y-t<l.top||r==="bottom"&&s.y+t>a.height-l.bottom}_calculateAutoAlignment(e){if(e!=="auto")return e;const{_pointerOffsetInPx:t,_containerNode:i,_mainContainerNode:s,viewModel:r}=this,{screenLocation:a,view:l}=r;if(a==null||!l||!i)return"top-center";function u(k){return parseInt(k.replaceAll(/[^-\d.]/g,""),10)}const c=s?window.getComputedStyle(s,null):null,_=c?u(c.getPropertyValue("max-height")):0,v=c?u(c.getPropertyValue("height")):0,{height:p,width:w}=i.getBoundingClientRect(),b=w+t,M=Math.max(p,_,v)+t,A=this._isOutsideView({popupHeight:M,popupWidth:b,screenLocation:a,side:"right",view:l}),L=this._isOutsideView({popupHeight:M,popupWidth:b,screenLocation:a,side:"left",view:l}),R=this._isOutsideView({popupHeight:M,popupWidth:b,screenLocation:a,side:"top",view:l}),$=this._isOutsideView({popupHeight:M,popupWidth:b,screenLocation:a,side:"bottom",view:l});return L?R?"bottom-right":"top-right":A?R?"bottom-left":"top-left":R?$?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return typeof e=="function"?e.call(this):e}_getCurrentAlignment(){const{alignment:e,dockEnabled:t,_containerNode:i}=this;return!t&&this.viewModel.active&&i?this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e))):null}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){const t=["left","right"];return ge(this.container)&&t.reverse(),e?.replaceAll(/leading/gi,t[0]).replaceAll(/trailing/gi,t[1])}_callDockPosition(e){return typeof e=="function"?e.call(this):e}_getDockPosition(){return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(this.dockOptions?.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_calculateAutoDockPosition(e){if(e!=="auto")return e;const t=this.viewModel?.view,i=ge(this.container)?"top-left":"top-right";if(!t)return i;const s=t.padding||{left:0,right:0},r=t.width-s.left-s.right,{breakpoints:a}=t;return a&&r<=a.xsmall?"bottom-center":i}_getDockIcon(){const e=this._getDockPosition();if(this.dockEnabled)return"minimize";switch(e){case"top-left":case"bottom-left":return"dock-left";case"top-center":return"maximize";case"bottom-center":return"dock-bottom";default:return"dock-right"}}_handleDockIcon(){this._dockAction.icon=this._getDockIcon()}_handleDockEnabled(){this._dockAction.title=this.dockEnabled?this.messages?.undock:this.messages?.dock}_setMainContainerNode(e){this._mainContainerNode=e}_positionContainer(e=this._containerNode){if(e&&(this._containerNode=e),!this._containerNode)return;const{screenLocation:t}=this.viewModel,{width:i}=this._containerNode.getBoundingClientRect(),s=this._calculatePositionStyle(t,i);s&&Object.assign(this._containerNode.style,s)}_calculateFullWidth(e){const{currentAlignment:t,_pointerOffsetInPx:i}=this;return t==="top-left"||t==="bottom-left"||t==="top-right"||t==="bottom-right"?e+i:e}_calculateAlignmentPosition(e,t,i,s){const{currentAlignment:r,_pointerOffsetInPx:a}=this;if(!i)return;const{padding:l}=i,u=s/2,c=i.height-t,_=i.width-e;return r==="bottom-center"?{top:t+a-l.top,left:e-u-l.left}:r==="top-left"?{bottom:c+a-l.bottom,right:_+a-l.right}:r==="bottom-left"?{top:t+a-l.top,right:_+a-l.right}:r==="top-right"?{bottom:c+a-l.bottom,left:e+a-l.left}:r==="bottom-right"?{top:t+a-l.top,left:e+a-l.left}:r==="top-center"?{bottom:c+a-l.bottom,left:e-u-l.left}:void 0}_calculatePositionStyle(e,t){const{dockEnabled:i,view:s}=this;if(!s)return;if(i)return{left:"",top:"",right:"",bottom:""};if(e==null||!t)return;const r=this._calculateFullWidth(t),a=this._calculateAlignmentPosition(e.x,e.y,s,r);return a?{top:a.top!==void 0?`${a.top}px`:"auto",left:a.left!==void 0?`${a.left}px`:"auto",bottom:a.bottom!==void 0?`${a.bottom}px`:"auto",right:a.right!==void 0?`${a.right}px`:"auto"}:void 0}_viewChange(e,t){e&&t&&(this.close(),this.clear())}_viewReadyChange(e,t){e?this._wireUpView():t&&(this.close(),this.clear())}_wireUpView(){this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,t,i){const[s,r]=e,[a,l]=t,{width:u=0,height:c=0}=i??{};return s<=u&&a>u||s>u&&a<=u||r<=c&&l>c||r>c&&l<=c}_updateDockEnabledForViewSize(e,t){if(!e||!t)return;const i=this.viewModel?.view?.padding||{left:0,right:0,top:0,bottom:0},s=i.left+i.right,r=i.top+i.bottom,a=[],l=[];a[0]=e[0]-s,a[1]=e[1]-r,l[0]=t[0]-s,l[1]=t[1]-r;const{dockOptions:u}=this,c=u.breakpoint;this._dockingThresholdCrossed(a,l,c)&&this._setDockEnabledForViewSize(u),this._setCurrentDockPosition()}_toggleScreenLocationEnabled(){const{dockEnabled:e,viewModel:t}=this;if(!t)return;const i=t.active&&!e;t.screenLocationEnabled=i}_shouldDockAtCurrentViewSize(e){const t=e.breakpoint,i=this.viewModel?.view?.ui;if(!i)return!1;const{width:s,height:r}=i;if(isNaN(s)||isNaN(r)||!t)return!1;const a=t.hasOwnProperty("width")&&s<=(t.width??0),l=t.hasOwnProperty("height")&&r<=(t.height??0);return a||l}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}};n([o()],y.prototype,"_containerNode",void 0),n([o({readOnly:!0})],y.prototype,"_featureNavigationTop",null),n([o()],y.prototype,"actions",null),n([o({readOnly:!0})],y.prototype,"active",null),n([o()],y.prototype,"alignment",void 0),n([o()],y.prototype,"autoCloseEnabled",null),n([o()],y.prototype,"defaultPopupTemplateEnabled",null),n([o()],y.prototype,"content",null),n([o()],y.prototype,"collapsed",null),n([o({readOnly:!0})],y.prototype,"currentAlignment",null),n([o({readOnly:!0})],y.prototype,"currentDockPosition",null),n([o()],y.prototype,"dockOptions",null),n([o()],y.prototype,"dockEnabled",void 0),n([o({readOnly:!0})],y.prototype,"featureCount",null),n([o()],y.prototype,"featureMenuOpen",null),n([o()],y.prototype,"features",null),n([o()],y.prototype,"goToOverride",null),n([o()],y.prototype,"headingLevel",void 0),n([o()],y.prototype,"highlightEnabled",null),n([o()],y.prototype,"icon",null),n([o()],y.prototype,"initialDisplayMode",null),n([o()],y.prototype,"location",null),n([o()],y.prototype,"label",null),n([o(),z("esri/widgets/Popup/t9n/Popup")],y.prototype,"messages",void 0),n([o()],y.prototype,"promises",null),n([o({readOnly:!0})],y.prototype,"selectedFeature",null),n([o({readOnly:!0})],y.prototype,"selectedDrillInFeature",null),n([o()],y.prototype,"selectedFeatureIndex",null),n([o({readOnly:!0})],y.prototype,"selectedFeatureWidget",null),n([o()],y.prototype,"title",null),n([o()],y.prototype,"updateLocationEnabled",null),n([o()],y.prototype,"view",null),n([o({type:Re}),xt(["triggerAction","trigger-action"])],y.prototype,"viewModel",void 0),n([o()],y.prototype,"visible",null),n([o({type:X,nonNullable:!0})],y.prototype,"visibleElements",void 0),y=n([x("esri.widgets.Popup")],y);const Pi=y,Gi=Object.freeze(Object.defineProperty({__proto__:null,default:Pi},Symbol.toStringTag,{value:"Module"}));export{wi as F,Gi as P,we as s};
